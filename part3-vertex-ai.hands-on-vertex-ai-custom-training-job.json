{"version":3,"kind":"Article","sha256":"0da348794fdb163b272d707627bd6322b4f3354a4f96c66bd3eb96a8ab28533c","slug":"part3-vertex-ai.hands-on-vertex-ai-custom-training-job","location":"/part3-vertex-ai/01-hands-on-vertex-ai-custom-training-job.md","dependencies":[],"frontmatter":{"title":"Hands-On 01: Vertex AI Custom Training Jobs","content_includes_title":false,"authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/blob/main/part3-vertex-ai/01-hands-on-vertex-ai-custom-training-job.md","edit_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/edit/main/part3-vertex-ai/01-hands-on-vertex-ai-custom-training-job.md","thumbnail":"/gcp-tutorial-aims/build/gcloud-submit-vertex-92687fb21f1d371d7a38e954f040b45a.png","exports":[{"format":"md","filename":"01-hands-on-vertex-ai-custom-training-job.md","url":"/gcp-tutorial-aims/build/01-hands-on-vertex-a-8132da9b9a5c7d021355b3617b39c7b4.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vZ8Qb9ZinE"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"TBl1xuH4KR"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"In the previous hands-on session, we ran the Gemma 1B fine-tuning experiment on a raw GCP VM. We had to provision the VM, SSH in, set up the environment, and manually manage the entire process. In this session we will run the exact same experiment as a ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FqtQ6Sh5h2"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Vertex AI Custom Training Job","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NOZtFsBzvt"}],"key":"UIgh4EusVr"},{"type":"text","value":", where Vertex AI handles all the infrastructure for us. We submit a ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uQ5uJ8akIC"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"job spec","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"cp3o2SNPF3"}],"key":"fZYUI092LJ"},{"type":"text","value":", Vertex AI provisions the hardware, runs the job, and terminates everything automatically when done.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WlJImlf7Wa"}],"key":"jbOhx5pkdq"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Learning Objectives","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fsE3WDkA1M"}],"identifier":"learning-objectives","label":"Learning Objectives","html_id":"learning-objectives","implicit":true,"key":"EYkkMxlHmb"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"By the end of this session, you will be able to:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"opH9uC4rkb"}],"key":"PgqjfxKHcW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Enable the Vertex AI API and set up the required permissions","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"NZxCS4R4G6"}],"key":"wAGHWrKzW3"}],"key":"uk3hR3GrBa"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Write a Vertex AI Custom Training Job config file","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"rdjY3BYXup"}],"key":"NsertN1a8s"}],"key":"r3fqKqEn0m"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Submit and monitor a training job using the ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"u3xNbJHcEr"},{"type":"inlineCode","value":"gcloud","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"aCn9vFqVPn"},{"type":"text","value":" CLI","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"KT6zcbqidy"}],"key":"a0sx8Q0y0q"}],"key":"tgkiFHXzT2"}],"key":"w3YgVzlF5T"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"QCK4uZPYau"}],"key":"KYw4LckPnl"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"This hands-on uses the same fine-tuning experiment from the previous session. If you want to understand the experiment in detail, including the model, dataset, and training code, refer back to ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"C57Qs9NpSb"},{"type":"link","url":"/part2-running-experiments-on-gcp-vms/hands-on-running-ai-experiments-on-gcp-vms","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Hands-On: Fine-Tuning Gemma 1B on a GCP VM","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"GKvyqN528G"}],"urlSource":"../part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md","dataUrl":"/part2-running-experiments-on-gcp-vms.hands-on-running-ai-experiments-on-gcp-vms.json","internal":true,"protocol":"file","key":"h2meAOtSgt"},{"type":"text","value":".","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"BKxpKwCTl7"}],"key":"mM9aWFGxX7"}],"key":"j42xvH1Rl4"},{"type":"heading","depth":2,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"cRWoAK1cqj"}],"identifier":"prerequisites","label":"Prerequisites","html_id":"prerequisites","implicit":true,"key":"HzTRl9GTfp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":21,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"gcloud","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"rGVt2YqygV"},{"type":"text","value":" CLI installed and configured on your local machine","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"vXWSm9L4aY"}],"key":"E0GswTS8kR"}],"key":"kTUovmAaXt"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A WandB account and API key","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"J1NAvIJDtz"}],"key":"DKPl5fjZ1v"}],"key":"TvqvhcgQHl"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A HuggingFace account and API token with the Gemma 3 1B model license agreement accepted.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"SvQQf6Rk1l"}],"key":"vyA9fEnQFr"}],"key":"Fh7ati8rEu"}],"key":"jLNa2wUqze"},{"type":"thematicBreak","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"raHDi4bS5q"},{"type":"heading","depth":2,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Step 1: Enable the Vertex AI API","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"oBhQGTSw8g"}],"identifier":"step-1-enable-the-vertex-ai-api","label":"Step 1: Enable the Vertex AI API","html_id":"step-1-enable-the-vertex-ai-api","implicit":true,"key":"y2l0G2LkwC"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Run this from your local machine to enable the Vertex AI API:","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"guGgaivrwq"}],"key":"DCh5QtQhGu"},{"type":"code","lang":"bash","value":"export PROJECT_ID=$(gcloud config get-value project)\n\ngcloud services enable aiplatform.googleapis.com \\\n    --project=${PROJECT_ID}","key":"gPXSi01pai"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"Verify it has been enabled:","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"KgiawbTD3y"}],"key":"VaJdCpKY0c"},{"type":"code","lang":"bash","value":"gcloud services list --enabled \\\n    --filter=\"name:aiplatform.googleapis.com\" \\\n    --project=${PROJECT_ID}","key":"OVwa3werq8"},{"type":"heading","depth":2,"position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"children":[{"type":"text","value":"Step 2: Grant the Required Permissions","position":{"start":{"line":45,"column":1},"end":{"line":45,"column":1}},"key":"wmnN3R3p9v"}],"identifier":"step-2-grant-the-required-permissions","label":"Step 2: Grant the Required Permissions","html_id":"step-2-grant-the-required-permissions","implicit":true,"key":"ZYNx143Qsg"},{"type":"paragraph","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"Vertex AI training jobs run under a service account. Grant it the permissions it needs to read and write to GCS.","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"GzndJSh8dG"}],"key":"FW5JTCLZ59"},{"type":"code","lang":"bash","value":"export SERVICE_ACCOUNT=$(gcloud iam service-accounts list \\\n    --filter=\"displayName:Compute Engine default service account\" \\\n    --format=\"value(email)\" \\\n    --project=${PROJECT_ID})\n\ngcloud projects add-iam-policy-binding ${PROJECT_ID} \\\n    --member=\"serviceAccount:${SERVICE_ACCOUNT}\" \\\n    --role=\"roles/storage.admin\"\n\ngcloud projects add-iam-policy-binding ${PROJECT_ID} \\\n    --member=\"serviceAccount:${SERVICE_ACCOUNT}\" \\\n    --role=\"roles/aiplatform.user\"","key":"u0S5cfangT"},{"type":"heading","depth":2,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Step 3: Create the Job Config","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"KxfvPlq0Ic"}],"identifier":"step-3-create-the-job-config","label":"Step 3: Create the Job Config","html_id":"step-3-create-the-job-config","implicit":true,"key":"L4jCBtkeRj"},{"type":"paragraph","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"Vertex AI Custom Training Jobs are defined by a YAML config file that specifies the machine type, container image, and the command to run. Create a file called ","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"gISie1AKpu"},{"type":"inlineCode","value":"vertex_job.yaml","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"lsMRTsePIu"},{"type":"text","value":" in your project folder.","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"fZBjMLdLWM"}],"key":"DDGXnUJAgC"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"Paste the following code, replacing the placeholder values for the environment variables (","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"inTsNMsFHO"},{"type":"inlineCode","value":"YOUR_HF_TOKEN","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"v8LvdAtj55"},{"type":"text","value":", ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"g5PsRqlney"},{"type":"inlineCode","value":"YOUR_WANDB_API_KEY","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"xweck2uAXc"},{"type":"text","value":", ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"hsiqFp37QJ"},{"type":"inlineCode","value":"YOUR_WANDB_PROJECT","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"qrLh3HP9Ub"},{"type":"text","value":", ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"AULKf4amG0"},{"type":"inlineCode","value":"YOUR_GCS_BUCKET_NAME","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"RbrlebSQ9N"},{"type":"text","value":") with the actual values.","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"kFILFuGEWe"}],"key":"GH9MOP66Gc"},{"type":"code","lang":"yaml","value":"workerPoolSpecs:\n  - machineSpec:\n      machineType: g2-standard-4\n      acceleratorType: NVIDIA_L4\n      acceleratorCount: 1\n    replicaCount: 1\n    containerSpec:\n      imageUri: us-docker.pkg.dev/deeplearning-platform-release/gcr.io/pytorch-gpu.2-0.py310\n      command:\n        - bash\n        - -c\n      args:\n        - |\n          curl -LsSf https://astral.sh/uv/install.sh | sh &&\n          source $HOME/.local/bin/env &&\n          git clone https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git &&\n          cd finetuning-gemma-1b-aims-gcp-tutorial &&\n          uv sync &&\n          uv run python -m scripts.run_train data.source=gcs data.max_train_samples=10000 training.num_epochs=2 training.batch_size=8 experiment_id=exp_lora_r8_vertex\n          gsutil -m cp -r outputs/ gs://$BUCKET_NAME/runs/exp_lora_r8_vertex\n      env:\n        - name: HF_TOKEN\n          value: <YOUR_HF_TOKEN>\n        - name: WANDB_API_KEY\n          value: <YOUR_WANDB_API_KEY>\n        - name: WANDB_PROJECT\n          value: <YOUR_WANDB_PROJECT>\n        - name: BUCKET_NAME\n          value: <YOUR_GCS_BUCKET_NAME>","key":"utIejcvcJj"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"This configuration does the following:","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"qnGTppLXAI"}],"key":"gTxaTYQ9p1"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":104,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Automatically spins up a Google Cloud VM equipped with an ","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"Vz9dr1fUTE"},{"type":"strong","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"NVIDIA L4 GPU","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"fAuVWKu9fY"}],"key":"BBsWAKiF5h"},{"type":"text","value":" and the necessary CUDA drivers.","position":{"start":{"line":104,"column":1},"end":{"line":104,"column":1}},"key":"CdazH2ituH"}],"key":"niYvtYSJgD"}],"key":"gsvooT9UJo"},{"type":"listItem","spread":true,"position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Automates environment setup: clones the training code, installs the ","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"u6ry6HXRC7"},{"type":"inlineCode","value":"uv","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"FuGK8E6bAF"},{"type":"text","value":" package manager, and installs all Python dependencies.","position":{"start":{"line":105,"column":1},"end":{"line":105,"column":1}},"key":"p5gmJxtNVz"}],"key":"hxVrcnptfw"}],"key":"ymyIy0r0JL"},{"type":"listItem","spread":true,"position":{"start":{"line":106,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Runs the Gemma 1B fine-tuning script and automatically persists the resulting model weights and logs to your GCS bucket.","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"R1z6ANfC23"}],"key":"K2mNGcl0wi"}],"key":"NQvdmSwQMr"}],"key":"CLmY0vqSFy"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Why this container image?","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"ucuB55KXPY"}],"key":"IQvIoeEMYX"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"wiiUqzZemK"},{"type":"inlineCode","value":"pytorch-gpu.2-0.py310","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"sMcY0J7hxS"},{"type":"text","value":" image comes with PyTorch, CUDA, and common ML libraries pre-installed. This means ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"nCNAAlJ4jR"},{"type":"inlineCode","value":"uv sync","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"qJzZwBJ05c"},{"type":"text","value":" only needs to install your smaller dependencies like ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"dHPllgNleF"},{"type":"inlineCode","value":"transformers","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"RJIDUXiL3K"},{"type":"text","value":", ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"SbiWNHG5ay"},{"type":"inlineCode","value":"peft","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"Y5iQip8P92"},{"type":"text","value":", and ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"J5ilzx9702"},{"type":"inlineCode","value":"wandb","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"sOCpJubyw0"},{"type":"text","value":", rather than downloading PyTorch (873MB) and CUDA libraries from scratch on every run.","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"Vj4YNBYN9E"}],"key":"luJOwvIvbi"}],"key":"mCPFcjefAI"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Why ","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"KTszaqwhFw"},{"type":"inlineCode","value":"gsutil cp","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"krIP5BprNG"},{"type":"text","value":" command at the end?","position":{"start":{"line":113,"column":1},"end":{"line":113,"column":1}},"key":"lLCy5pKXrB"}],"key":"Cmc1Bi7mZ3"},{"type":"paragraph","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"children":[{"type":"text","value":"HuggingFace Trainer saves checkpoints locally inside the container, which is ephemeral and lost when the job finishes. The ","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"gIUTSVUTaY"},{"type":"inlineCode","value":"gsutil cp","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"YYJIW1wrX9"},{"type":"text","value":" command at the end explicitly syncs the local ","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"AaL3zqDBvc"},{"type":"inlineCode","value":"outputs/","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"vf0StY9Q1x"},{"type":"text","value":" directory to GCS after training completes, ensuring your checkpoints persist. This is the standard pattern for persisting outputs from Vertex AI training jobs when using HuggingFace Trainer.","position":{"start":{"line":115,"column":1},"end":{"line":115,"column":1}},"key":"Vd0vf5aGpA"}],"key":"IDlfiA0l16"}],"key":"CxfuPj6zow"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"ZmNMQz78og"}],"key":"YqzTfl9rkj"},{"type":"paragraph","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"children":[{"type":"text","value":"Do not commit the ","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"TR7xLTdOfK"},{"type":"inlineCode","value":"vertex_job.yaml","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"Qb23UZMjHt"},{"type":"text","value":" file to GitHub with your API keys in it. Add it to .gitignore to keep your credentials safe.","position":{"start":{"line":119,"column":1},"end":{"line":119,"column":1}},"key":"Zk7dKDeNke"}],"key":"EOpmSgMI04"}],"key":"CWCvEyZQKa"},{"type":"heading","depth":2,"position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"children":[{"type":"text","value":"Step 4: Submit the Training Job","position":{"start":{"line":122,"column":1},"end":{"line":122,"column":1}},"key":"N60jW3J2qd"}],"identifier":"step-4-submit-the-training-job","label":"Step 4: Submit the Training Job","html_id":"step-4-submit-the-training-job","implicit":true,"key":"IceBrADPJJ"},{"type":"paragraph","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"This command uses the ","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"iLUFyTEaYc"},{"type":"inlineCode","value":"gcloud","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"MAcDgE45ZB"},{"type":"text","value":" CLI to submit a ","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"KeCHXdbbnb"},{"type":"strong","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"children":[{"type":"text","value":"Vertex AI Custom Training Job","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"gz0Ah5HgJL"}],"key":"SIU6dgfUC6"},{"type":"text","value":" based on the specifications in ","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"Mvx7r2QLsd"},{"type":"inlineCode","value":"vertex_job.yaml","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"V3lnD7uFwz"},{"type":"text","value":".","position":{"start":{"line":124,"column":1},"end":{"line":124,"column":1}},"key":"UzD4w2p6pg"}],"key":"e7P8UjWThI"},{"type":"code","lang":"bash","value":"export REGION=\"europe-west4\" # change to any region you want\nexport AIMSUSERNAME=\"<YOUR_AIMS_USERNAME>\"\nexport JOB_NAME=\"${AIMSUSERNAME}-gemma-finetune-$(date +%Y%m%d%H%M%S)\"\n\ngcloud ai custom-jobs create \\\n    --region=${REGION} \\\n    --display-name=${JOB_NAME} \\\n    --config=vertex_job.yaml \\\n    --project=${PROJECT_ID}","key":"fmvLo1w7hz"},{"type":"paragraph","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"children":[{"type":"text","value":"You should see an output confirming that the job was successfully created with a job ID.","position":{"start":{"line":138,"column":1},"end":{"line":138,"column":1}},"key":"PFc3PZ5cV1"}],"key":"rMJUGcL7d9"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/gcloud-submit-vertex-92687fb21f1d371d7a38e954f040b45a.png","alt":"Custom Vertex AI training job submitted","align":"center","key":"qMcTKoL2tu","urlSource":"./images/gcloud-submit-vertexai-custom-training-job.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"children":[{"type":"text","value":"Screenshot: Terminal output showing successfully Vertex AI training job creation with job ID","position":{"start":{"line":144,"column":1},"end":{"line":144,"column":1}},"key":"yEcMu86zGw"}],"key":"ishVNmeiWu"}],"key":"iy1BaPzIPP"}],"enumerator":"1","key":"SDXAGLfmRH"},{"type":"heading","depth":2,"position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"children":[{"type":"text","value":"Step 5: Monitor the Job","position":{"start":{"line":147,"column":1},"end":{"line":147,"column":1}},"key":"m2Jza4hYBG"}],"identifier":"step-5-monitor-the-job","label":"Step 5: Monitor the Job","html_id":"step-5-monitor-the-job","implicit":true,"key":"J6dWgXIGM9"},{"type":"paragraph","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"children":[{"type":"text","value":"Check the job status from the CLI:","position":{"start":{"line":149,"column":1},"end":{"line":149,"column":1}},"key":"OfkXG1quPD"}],"key":"fstJ7v4PyM"},{"type":"code","lang":"bash","value":"gcloud ai custom-jobs list \\\n    --region=${REGION} \\\n    --project=${PROJECT_ID}","key":"pxyIhkAnrK"},{"type":"paragraph","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"children":[{"type":"text","value":"Stream the logs in real time:","position":{"start":{"line":157,"column":1},"end":{"line":157,"column":1}},"key":"LuDDYtKZZN"}],"key":"dY1TmeQn8F"},{"type":"code","lang":"bash","value":"# Ger the Job ID using the Display Name\nJOB_ID=$(gcloud ai custom-jobs list \\     \n    --region=${REGION} \\\n    --filter=\"displayName=${JOB_NAME}\" \\\n    --format=\"value(name.scope(customJobs))\")\n\n# Stream the logs using the ID\ngcloud ai custom-jobs stream-logs ${JOB_ID} --region=${REGION}","key":"BnrozXPvQi"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"strong","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"You can also monitor the job from the GCP Console.","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"EQkZ2LT74M"}],"key":"rnXkUX9Gz0"}],"key":"NWk1pMJznu"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":172,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Go to ","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"uAe8P5ARzq"},{"type":"strong","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"children":[{"type":"text","value":"Vertex AI","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"HbcjEEuohC"}],"key":"LDX8BbzmQX"},{"type":"text","value":" page on your GCP Console","position":{"start":{"line":172,"column":1},"end":{"line":172,"column":1}},"key":"SDm5zYV2ax"}],"key":"t1WSrqk1LE"}],"key":"CfjhYNblxE"},{"type":"listItem","spread":true,"position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Navigate to the ","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"WKzHnOTMbp"},{"type":"strong","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"children":[{"type":"text","value":"Custom Jobs","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"YNs8ev02Xt"}],"key":"zIarKuSvdA"},{"type":"text","value":" tab. Ensure the region you used when submitting the job is selected.","position":{"start":{"line":173,"column":1},"end":{"line":173,"column":1}},"key":"ZdNwwaDSzM"}],"key":"Jl1VRnprKf"}],"key":"os42G96Lpo"},{"type":"listItem","spread":true,"position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Click on the job you want to monitor","position":{"start":{"line":174,"column":1},"end":{"line":174,"column":1}},"key":"jKwIutf9Mq"}],"key":"v8ff8JLJ9g"}],"key":"FM9zPFWpU7"},{"type":"listItem","spread":true,"position":{"start":{"line":175,"column":1},"end":{"line":176,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Click on ","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"ku70yhyPcQ"},{"type":"strong","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"children":[{"type":"text","value":"View logs","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"jOpTSRM0tw"}],"key":"b1jdCQpaFy"},{"type":"text","value":" to view the logs for the training job.","position":{"start":{"line":175,"column":1},"end":{"line":175,"column":1}},"key":"d7TRQV3TcI"}],"key":"hyvB7uxXcw"}],"key":"ve6VanOFvX"}],"key":"qSWpm4PlsA"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/gcp-console-vertexai-6719bcc48bc6a6a031eb3d741dda8d99.png","alt":"GCP Console showing the custom jobs list with job status","align":"center","key":"csyFCBFKjh","urlSource":"./images/gcp-console-vertexai-custom-jobs-list-finished-status.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"children":[{"type":"text","value":"Screenshot: GCP Console showing the custom jobs list with job status","position":{"start":{"line":181,"column":1},"end":{"line":181,"column":1}},"key":"jOJQ24GiND"}],"key":"rmDHkRZTLH"}],"key":"WmA47J7pWh"}],"enumerator":"2","key":"afEGJjq8sf"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/gcp-console-vertex-a-942c9ccf1f93082195f26a6a77af222b.png","alt":"GCP Console showing details for a custom training job","align":"center","key":"S8vCY3UlNT","urlSource":"./images/gcp-console-vertex-ai-custom-training-job.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"children":[{"type":"text","value":"Screenshot: GCP Console showing details for a custom training job with the ‚ÄúView logs‚Äù link","position":{"start":{"line":188,"column":1},"end":{"line":188,"column":1}},"key":"mA1vU2wv9B"}],"key":"sB6N4ycmgL"}],"key":"QAEwyg86D3"}],"enumerator":"3","key":"I94HHdpUKa"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/gcp-console-vertexai-2cec0ce24fbcb2cab755c2dec5f87d1d.png","alt":"GCP Console showing the custom training job logs streaming in real time","align":"center","key":"y87Ai9Da0m","urlSource":"./images/gcp-console-vertexai-training-job-logs.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"children":[{"type":"text","value":"Screenshot: GCP Console showing the custom training job logs streaming in real time","position":{"start":{"line":195,"column":1},"end":{"line":195,"column":1}},"key":"wDHpPMyXY8"}],"key":"XIRo4Ov3QF"}],"key":"p3PXIQvlCa"}],"enumerator":"4","key":"Ab0UiqsCa8"},{"type":"paragraph","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"As with the VM-based run, you can also monitor training metrics in real time from your WandB dashboard at ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"fLhbIalsWn"},{"type":"link","url":"http://wandb.ai","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"wandb.ai","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"Hlg1S06fAQ"}],"urlSource":"http://wandb.ai","key":"ltOKBTK24I"},{"type":"text","value":". You will see. ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"SP06QfsPm1"},{"type":"inlineCode","value":"train/loss","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"Cmei6Ap2v5"},{"type":"text","value":", ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"la11O7mx7b"},{"type":"inlineCode","value":"eval/loss","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"eqnVRuFxph"},{"type":"text","value":", ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"gb85DOM12A"},{"type":"inlineCode","value":"train/grad_norm","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"m2gj8nklOu"},{"type":"text","value":", ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"EJYNhEWgox"},{"type":"inlineCode","value":"train/learning_rate","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"wAgnqqlpyq"},{"type":"text","value":", etc., updating every 10 steps.","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"S5gTsB9hsg"}],"key":"mv7QKkoV1A"},{"type":"heading","depth":2,"position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"text","value":"Step 6: Verify the Outputs in GCS","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"qdvqM4gB0p"}],"identifier":"step-6-verify-the-outputs-in-gcs","label":"Step 6: Verify the Outputs in GCS","html_id":"step-6-verify-the-outputs-in-gcs","implicit":true,"key":"qEwNN2hLY3"},{"type":"paragraph","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"children":[{"type":"text","value":"Once the job status changes to ","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"B6nmdKjm57"},{"type":"inlineCode","value":"FINISHED","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"QLSXIfzVXj"},{"type":"text","value":", we can verify that the outputs were synced to your GCS bucket successfully using the GCP Console.","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"lQCcJMRyW8"}],"key":"aKErO8hmuv"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/gcp-console-vertexai-6f70776a0d8bebed1c098026bc9bb2d4.png","alt":"GCS Bucket in GCP Console showing output folder","align":"center","key":"diU6VCqdzz","urlSource":"./images/gcp-console-vertexai-custom-training-job-output-gcs-bucket.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"Screenshot: GCS Bucket in GCP Console showing synced output folder","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"gpqBuTVScc"}],"key":"Y9yacKQtyz"}],"key":"RBfBxHKdbJ"}],"enumerator":"5","key":"ipNkH48lgD"},{"type":"heading","depth":2,"position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"text","value":"Step 7: Resource Cleanup","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"IK1hwF2KVl"}],"identifier":"step-7-resource-cleanup","label":"Step 7: Resource Cleanup","html_id":"step-7-resource-cleanup","implicit":true,"key":"dxuycJj5p1"},{"type":"paragraph","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"text","value":"Vertex AI Custom Training Jobs terminate automatically when the job completes, so there is no VM delete. The only resource to clean up is the GCS bucket if you no longer need the outputs:","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"sLpGAOurmd"}],"key":"mkbx4UKI11"},{"type":"admonition","kind":"danger","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Danger","key":"E9qnJclxS2"}],"key":"cZD7sUOszF"},{"type":"paragraph","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"children":[{"type":"text","value":"Only delete the bucket if you no longer need the checkpoints. If you want to keep your trained model, skip this step or download the outputs locally first.","position":{"start":{"line":216,"column":1},"end":{"line":216,"column":1}},"key":"E4SV9JHCne"}],"key":"SoHCV3s0tF"}],"key":"NXH47YJoNb"},{"type":"code","lang":"bash","value":"gcloud storage rm --recursive gs://<YOUR_GCS_BUCKET_NAME>","key":"WqnPzbZg8e"},{"type":"thematicBreak","position":{"start":{"line":223,"column":1},"end":{"line":223,"column":1}},"key":"Clq8BSW56o"},{"type":"heading","depth":2,"position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"children":[{"type":"text","value":"üîë Key Takeaways","position":{"start":{"line":225,"column":1},"end":{"line":225,"column":1}},"key":"brSUG7vQqY"}],"identifier":"id-key-takeaways","label":"üîë Key Takeaways","html_id":"id-key-takeaways","implicit":true,"key":"IiJUDpnRIV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":226,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Vertex AI Custom Training Jobs eliminate all infrastructure management. You submit a job spec, Vertex AI provisions the hardware, runs the job, and terminates everything automatically when done.","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"mziWKfvJaY"}],"key":"ddIPg53YU5"}],"key":"mJzblIyc6L"},{"type":"listItem","spread":true,"position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You pay only for the duration of the job. There are no idle costs unlike a raw VM that keeps running until you manually delete it.","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"KZHefRxPwl"}],"key":"onll8fy8p4"}],"key":"Yech8YBEHV"},{"type":"listItem","spread":true,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The training code itself does not change at all. The only difference from the VM-based approach is how you submit and monitor the job.","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"CjxWMYvXxv"}],"key":"fc9EFLZdqk"}],"key":"jWpyhuGegz"},{"type":"listItem","spread":true,"position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Using a pre-built container image with PyTorch already installed significantly speeds up job startup time by avoiding large dependency downloads.","position":{"start":{"line":229,"column":1},"end":{"line":229,"column":1}},"key":"q2SqhynoJN"}],"key":"titkiBzcF9"}],"key":"PJHGH7DOrh"},{"type":"listItem","spread":true,"position":{"start":{"line":230,"column":1},"end":{"line":231,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Always sync outputs to GCS explicitly at the end of the job since HuggingFace Trainer saves checkpoints locally inside the ephemeral container.","position":{"start":{"line":230,"column":1},"end":{"line":230,"column":1}},"key":"jOUej6axSo"}],"key":"trEDjK6uKF"}],"key":"nveUtVA6P4"}],"key":"Ou9nN8vi9x"},{"type":"heading","depth":2,"position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"üöÄ What‚Äôs Next","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"LRmQ7gF3By"}],"identifier":"id-whats-next","label":"üöÄ What‚Äôs Next","html_id":"id-whats-next","implicit":true,"key":"DGA0jzdllF"},{"type":"paragraph","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"In the next hands-on session, we will run the same experiment interactively using ","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"JmcrtzT5Z4"},{"type":"strong","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"children":[{"type":"text","value":"Vertex AI Colab Enterprise","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"HmeWMvHsWl"}],"key":"u9IECS8aEy"},{"type":"text","value":", a managed notebook environment accessible directly from your browser with no SSH or infrastructure setup required.","position":{"start":{"line":234,"column":1},"end":{"line":234,"column":1}},"key":"KWPfMDsGgj"}],"key":"fP87AmByct"}],"key":"mvffnCZAN8"}],"key":"gLwPF7rHdu"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Introduction","url":"/part3-vertex-ai","group":"Part 3 - Vertex AI"},"next":{"title":"Hands-On 02: Vertex AI Notebooks (Colab Enterprise)","url":"/part3-vertex-ai/hands-on-vertex-ai-notebook-colab-enterprise","group":"Part 3 - Vertex AI"}}},"domain":"http://localhost:3000"}