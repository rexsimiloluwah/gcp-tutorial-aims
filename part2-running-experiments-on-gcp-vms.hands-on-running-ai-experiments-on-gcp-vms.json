{"version":3,"kind":"Article","sha256":"db9e022703798eb6d0481453799badb9d8ee3004395b845fb31e9b5012091e6d","slug":"part2-running-experiments-on-gcp-vms.hands-on-running-ai-experiments-on-gcp-vms","location":"/part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md","dependencies":[],"frontmatter":{"title":"Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM","content_includes_title":false,"authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/blob/main/part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md","edit_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/edit/main/part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md","thumbnail":"/build/create_new_project_w-7441e525afc12dee9f2e21d9c8c7bcaf.png","exports":[{"format":"md","filename":"01-hands-on-running-ai-experiments-on-gcp-vms.md","url":"/build/01-hands-on-running--d399e9220f280cf3042a7efa722a3255.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this hands-on session, we will fine-tune ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cV4ydPhYnT"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Gemma 3 1B","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pByoOZ2MKC"}],"key":"i3w6ksTFxN"},{"type":"text","value":" (a small language model with 1 billion parameters) on the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"APJsvFZsbQ"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dolly-15k","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jUioRmFUME"}],"key":"Bm0Pm7IxiQ"},{"type":"text","value":" instruction dataset using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BLbAMerct2"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"LoRA (Low-Rank Adaptation)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DcLd4awE77"}],"key":"woLShY5Sm2"},{"type":"text","value":", track our experiments with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tPhR1KnZoV"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Weights & Biases","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Jq4Lw1MRPZ"}],"key":"JHL03L7Pp4"},{"type":"text","value":", and persist outputs and model artifacts to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AsGP4pJQKi"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Google Cloud Storage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OqJlNVCwyj"}],"key":"ffG5ZMnhJB"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rEu0G2khOS"}],"key":"L6Zw4Yx4wh"},{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"r7H7Q2q7bG"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"ogyQFA7yPa"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"By the end of this hands-on session, you will have:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"tfC5IG062O"}],"key":"TUK72ZRrje"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Provisioned an L4 GPU VM using the Compute Engine service via ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"MxX3yKbgPY"},{"type":"inlineCode","value":"gcloud","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"uqju5VlMH0"},{"type":"text","value":" CLI","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"m6Qah3afUv"}],"key":"N5fPEChPo7"}],"key":"BiwBEUI5m9"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Set up a Python environment using ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"DSbZXWdwuV"},{"type":"inlineCode","value":"uv","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"NDs2w1E5qf"}],"key":"BYVjGzPHas"}],"key":"GSAboitDHf"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Cloned the experiment repository from GitHub","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"i5Ij23mVip"}],"key":"VdkjjOmhw3"}],"key":"dMwz1cXxhb"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Run the scripts to fine-tune Gemma 3 1B using LoRA on the Dolly 15k dataset","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"hy1GHiz3Ka"}],"key":"HCXgN32aCW"}],"key":"vv3cat0gtb"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Created persistent SSH sessions using ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xzMcOPc7PB"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"hJwPEQUxCp"}],"key":"V9MgIa4HqO"}],"key":"T9zz8gqDsE"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Learnt how to monitor training in real-time using Weights & Biases","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"h4GQeBLuAu"}],"key":"EvYARmAFeo"}],"key":"DfhghbbgNk"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Persisted outputs and model artifacts to Google Cloud Storage (GCS)","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"qEuzegTpA1"}],"key":"xTPbbAXZFl"}],"key":"UwMMWS9YT2"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Cleaned up all resources to avoid unnecessary charges","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"ZKJpjjGkKf"}],"key":"CNv7qpVwMb"}],"key":"VQzoOXjySb"}],"key":"Sx9hahGSiK"},{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Background","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"l8hngR7gk4"}],"identifier":"background","label":"Background","html_id":"background","implicit":true,"key":"yLEWkAV9vR"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Click here for more background information about this hands-on session.","key":"jA68FoofKU"}],"key":"s99hYobwIi"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why This Experiment?","key":"AwCxBHSG5W"}],"identifier":"why-this-experiment","label":"Why This Experiment?","html_id":"why-this-experiment","implicit":true,"key":"ay0hWQm8tD"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Fine-tuning takes an already capable model and adapts it to a specific task at a fraction of the cost of training from scratch, which is how most real-world LLM applications are built.","key":"RyCqc5nAGl"}],"key":"eMhvHmDear"}],"key":"Zo0xYXXZLT"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"We use Gemma 3 1B because fine-tuning a model at this scale of one billion parameters introduces you to the practical realities of running large model training on cloud infrastructure, including GPU memory constraints, checkpoint management, and experiment tracking.","key":"hNVprBnOvr"}],"key":"DZCXEM6f6m"}],"key":"dhknT1rPxn"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"At 1B parameters, Gemma is large enough to produce meaningful, coherent responses and representative of the models used in real applications, but small enough to fine-tune on a single L4 GPU in under 30 minutes, making it a practical starting point.","key":"WxTga4pdzp"}],"key":"R9wwsCu3PF"}],"key":"AgknVTHaAO"}],"key":"xJao6Sp6b5"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why LoRA?","key":"lXuAxaqSxB"}],"identifier":"why-lora","label":"Why LoRA?","html_id":"why-lora","implicit":true,"key":"z8czsnswkI"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Even at 1 Billion parameters, fully fine-tuning Gemma 1B would require updating every weight in the model on every training step, which is memory-intensive and slow on a single GPU.","key":"mezJDlsafn"}],"key":"MJuwHaCFF0"}],"key":"nHEzrcsfKk"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"LoRA solves this by freezing the original model weights and injecting small trainable matrices into specific layers, training less than the full parameters while still achieving meaningful adaptation.","key":"l5PbId7d6c"}],"key":"UJsKq50pkJ"}],"key":"DWs1pVNpfI"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The key hyperparameter is the rank (","key":"e9DwHAGIgk"},{"type":"inlineCode","value":"r","key":"w9CvZq9LiB"},{"type":"text","value":"), which controls the size of these trainable matrices. A higher rank means more expressive power but more memory and compute.","key":"PMnmhgiWEj"}],"key":"PYJIhV0R8h"}],"key":"VNvmcswXlz"}],"key":"FUHw38Eqdy"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why Dolly-15k?","key":"K0R9XvLiRs"}],"identifier":"why-dolly-15k","label":"Why Dolly-15k?","html_id":"why-dolly-15k","implicit":true,"key":"Dh5pHdxN18"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Dolly-15k is an open-source instruction-following dataset created by Databricks, containing 15,000 human-generated prompt-response pairs.","key":"V9l8DJLxeC"}],"key":"KMfZEpy9WL"}],"key":"WIp7jbBHBv"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It covers a wide range of tasks including question answering, summarization, classification, and creative writing.","key":"KcIgUCkJfU"}],"key":"AbqjysLaUQ"}],"key":"Cbi7aFnqn9"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"We use it because it is freely available, well-structured, and a standard dataset for instruction fine-tuning, making results easy to compare and reproduce.","key":"UxWjFI3rtJ"}],"key":"sQFitjkmuk"}],"key":"GvLiimfc1e"}],"key":"F0NSqEJqqG"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why ","key":"lwYqxnkBjC"},{"type":"inlineCode","value":"tmux","key":"igaJ3EGG0R"},{"type":"text","value":"?","key":"GULQ1lxRiG"}],"identifier":"why-tmux","label":"Why tmux?","html_id":"why-tmux","implicit":true,"key":"Fuo8SWLjik"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Training a 1 Billion parameter model takes time. Keeping an SSH connection open for the entire duration is fragile and impractical.","key":"EB02ZsJk7U"}],"key":"HcxakXEmAc"}],"key":"qNCyUSYBlr"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If your SSH session disconnects, any process running in that terminal is killed, meaning your training run is lost and you have to start over.","key":"bKva134q3p"}],"key":"dXwKcEoiRV"}],"key":"b0kvWp3N2G"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"tmux","key":"Q4eiQFTA44"},{"type":"text","value":" keeps your training process running on the VM independently of your SSH connection, so a dropped connection does not affect the job.","key":"q5cwnO5EnA"}],"key":"OusXH95250"}],"key":"kVbf0ar7Re"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It also means you can disconnect intentionally, close your laptop, and reconnect later to check progress without interrupting anything.","key":"VqbU2a2Wws"}],"key":"vjeyLS1cqQ"}],"key":"lMDonjn32z"}],"key":"j75hrRJOlF"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why Weights & Biases?","key":"pWOA0kn1sb"}],"identifier":"why-weights-biases","label":"Why Weights & Biases?","html_id":"why-weights-biases","implicit":true,"key":"zpLvppYBS8"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Training runs on a remote VM, so you need a way to monitor progress without staying connected via SSH.","key":"yWJMh0pAdz"}],"key":"M5Mr65BtgD"}],"key":"zubr74KtyX"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"WandB logs metrics like loss, learning rate, and gradient norms in real time and makes them accessible from any browser, meaning you can close your laptop and check the dashboard later.","key":"aws0hm9at0"}],"key":"QWJXL27t7R"}],"key":"nr5OBfk8r3"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It also keeps a history of every run, making it easy to compare experiments and share results with others.","key":"M0ABXqiXlK"}],"key":"m3R31Ee0Dy"}],"key":"JATLAGeoUD"}],"key":"elEfBpyvMF"}],"key":"anlbkiNwzM"},{"type":"heading","depth":2,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Step 1: Create the VM","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"nZwK7vst9p"}],"identifier":"step-1-create-the-vm","label":"Step 1: Create the VM","html_id":"step-1-create-the-vm","implicit":true,"key":"psKdUtUJVj"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"Create a new shell script file called ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"r7BCCjb6yb"},{"type":"inlineCode","value":"create_vm.sh","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"Ac6IjXYSls"},{"type":"text","value":" and copy the script below into it. Before running the script, update the ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"UuNlRwFKpz"},{"type":"inlineCode","value":"AIMSUSERNAME","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"LlM5xSdoh2"},{"type":"text","value":" variable at the top to your username:","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"eIz0Tj3Mag"}],"key":"FV76OD0cHX"},{"type":"code","lang":"bash","value":"nano create_vm.sh","key":"ZDzL75p3Yu"},{"type":"paragraph","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"Paste the following script:","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"lXE9hy3XvD"}],"key":"iMs0ZuJ4tI"},{"type":"code","lang":"bash","value":"#!/bin/bash\n\nexport AIMSUSERNAME=\"<your_aims_username>\" # Change this to your own username\nexport REGION=\"europe-west4\"\nexport ZONE=\"europe-west4-a\"\n\n# Create VPC if it doesn't exist\nif ! gcloud compute networks describe ${AIMSUSERNAME}-vpc &>/dev/null; then\n    gcloud compute networks create ${AIMSUSERNAME}-vpc --subnet-mode=auto\nelse\n    echo \"VPC ${AIMSUSERNAME}-vpc already exists, skipping.\"\nfi\n\n# Create firewall rule if it doesn't exist\nif ! gcloud compute firewall-rules describe ${AIMSUSERNAME}-fw-ssh &>/dev/null; then\n    gcloud compute firewall-rules create ${AIMSUSERNAME}-fw-ssh \\\n        --network=${AIMSUSERNAME}-vpc \\\n        --allow=tcp:22\nelse\n    echo \"Firewall rule ${AIMSUSERNAME}-fw-ssh already exists, skipping.\"\nfi\n\n# Create Cloud Router if it doesn't exist\nif ! gcloud compute routers describe ${AIMSUSERNAME}-router-${REGION} --region=${REGION} &>/dev/null; then\n    gcloud compute routers create ${AIMSUSERNAME}-router-${REGION} \\\n        --network=${AIMSUSERNAME}-vpc \\\n        --region=${REGION}\nelse\n    echo \"Router ${AIMSUSERNAME}-router-${REGION} already exists, skipping.\"\nfi\n\n# Create NAT if it doesn't exist\nif ! gcloud compute routers nats describe ${AIMSUSERNAME}-nat-config \\\n    --router=${AIMSUSERNAME}-router-${REGION} \\\n    --region=${REGION} &>/dev/null; then\n    gcloud compute routers nats create ${AIMSUSERNAME}-nat-config \\\n        --router-region=${REGION} \\\n        --router=${AIMSUSERNAME}-router-${REGION} \\\n        --nat-all-subnet-ip-ranges \\\n        --auto-allocate-nat-external-ips\nelse\n    echo \"NAT ${AIMSUSERNAME}-nat-config already exists, skipping.\"\nfi\n\nexport VM_NAME=\"${AIMSUSERNAME}-l4-vm\"\n\ngcloud compute instances create ${VM_NAME} \\\n    --zone=${ZONE} \\\n    --machine-type=g2-standard-4 \\\n    --accelerator=\"type=nvidia-l4,count=1\" \\\n    --image-family=common-cu128-ubuntu-2204-nvidia-570 \\\n    --image-project=deeplearning-platform-release \\\n    --maintenance-policy=TERMINATE \\\n    --network=${AIMSUSERNAME}-vpc \\\n    --scopes=storage-full,cloud-platform","key":"X1lXAbpHS3"},{"type":"paragraph","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"Then save and run the script:","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"WccZVMGxyq"}],"key":"Qzx7sfjTUn"},{"type":"code","lang":"bash","value":"chmod +x create_vm.sh\n./create_vm.sh","key":"ZfylDHP31i"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"The script creates all necessary networking infrastructure (VPC, firewall, router, NAT) and provisions a VM with an NVIDIA L4 GPU.","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"UQA52Gtjtv"}],"key":"VM06n8d3W3"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"h1z03R0aKu"}],"key":"apt6bxuwJl"},{"type":"paragraph","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"text","value":"Notice the ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"x4GpZVoeJk"},{"type":"inlineCode","value":"--scopes=storage-full,cloud-platform","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"dhobQ2S1CL"},{"type":"text","value":" flag in the ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"Mzwu6n2lqF"},{"type":"inlineCode","value":"gcloud compute instances create","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"ZlR1boNScP"},{"type":"text","value":" command for creating the VM. This gives the VM permission to read from and write to GCS, which we will need later when uploading the dataset and syncing experiment outputs and model artifacts.","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"wXb8Zs0UKM"}],"key":"pLe38eWw6G"}],"key":"WUNXqVmWaM"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"VxikbmPgRH"}],"key":"Amm17ODdba"},{"type":"paragraph","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"text","value":"If you see an error like ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"rnpbhkj8Ef"},{"type":"inlineCode","value":"The zone does not have enough resources available","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"JHkj6wKXCd"},{"type":"text","value":", the NVIDIA L4 GPU is out of stock in that zone. Try changing ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"f2WwQMPgWp"},{"type":"inlineCode","value":"ZONE","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"FictsY3nym"},{"type":"text","value":" in the script to a nearby zone like europe-west4-b or europe-west4-c or changing the region ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"LUTJ98UWmA"},{"type":"inlineCode","value":"REGION","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"NFcorGzm5x"},{"type":"text","value":" in the script to another region e.g. ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"GENqry9Ar4"},{"type":"inlineCode","value":"us-central1","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"x449tCPBWK"},{"type":"text","value":".","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"FFrdr0LQh2"}],"key":"QeZUn6oRCj"}],"key":"qah1Wd1lkH"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"Then verify the VM is running:","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"X0fw691oDR"}],"key":"BvTk2JXj6E"},{"type":"code","lang":"bash","value":"gcloud compute instances list","key":"Z9ykHdLCSs"},{"type":"heading","depth":2,"position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"text","value":"Step 2: SSH into the VM","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"i7YMbFyML3"}],"identifier":"step-2-ssh-into-the-vm","label":"Step 2: SSH into the VM","html_id":"step-2-ssh-into-the-vm","implicit":true,"key":"KKNziWaU0i"},{"type":"code","lang":"bash","value":"gcloud compute ssh <YOUR_AIMS_USERNAME>-l4-vm --zone=europe-west4-a --tunnel-through-iap","key":"qrGolkSHbc"},{"type":"paragraph","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"Replace ","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"qCifoHa3WF"},{"type":"inlineCode","value":"<YOUR_AIMS_USERNAME>","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"zwtzMF1XbB"},{"type":"text","value":" and the ","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"Sdu8vAR5DX"},{"type":"inlineCode","value":"--zone","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"eTqfACadvm"},{"type":"text","value":" flag with the values you used when running the script.","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"HIDt8gXAjI"}],"key":"XdOgtDXhRP"},{"type":"paragraph","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"When you have successfully “SSH-ed” into your server, verify the GPU is available.","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"nvWPmXzyuo"}],"key":"V52MOCIx5G"},{"type":"code","lang":"bash","value":"nvidia-smi","key":"SBxYbs5CZA"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"You should see the NVIDIA L4 with 24GB VRAM listed. All subsequent commands are run inside this SSH session.","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"m8gmDBL0oE"}],"key":"a8RR9JoioP"},{"type":"heading","depth":2,"position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"Step 3: Install ","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"mvHNiw28aX"},{"type":"inlineCode","value":"uv","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"zXEYUk1i8n"}],"identifier":"step-3-install-uv","label":"Step 3: Install uv","html_id":"step-3-install-uv","implicit":true,"key":"asR2XCXOf9"},{"type":"paragraph","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"children":[{"type":"inlineCode","value":"uv","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"HV8Q1z0w3h"},{"type":"text","value":" is a fast Python package and project manager that handles creating virtual environments, installing dependencies, and locking package versions. We use it because it guarantees the exact same environment can be recreated on any machine with a single command.","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"e1yNgtTiUv"}],"key":"g5OTtdVquZ"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"Rf85cEOfwi"}],"key":"GdlIClf7rg"},{"type":"paragraph","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"children":[{"type":"text","value":"The VM image we provisioned already comes with Python pre-installed, so we do not need to set up Python manually. ","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"J99pyV03rs"},{"type":"inlineCode","value":"uv","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"uSR2zFdKaT"},{"type":"text","value":" will use the existing Python installation and manage everything else for us.","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"oVVW0Ulzix"}],"key":"xSzf3UTlVs"}],"key":"xZF5PbCIKV"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"strong","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"Install ","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"WRzdek3Dc6"},{"type":"inlineCode","value":"uv","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"ymddIRYEpD"},{"type":"text","value":":","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"TPejr4KZkl"}],"key":"QjPbLk6vGn"}],"key":"jYNMJ7VfGQ"},{"type":"code","lang":"bash","value":"curl -LsSf https://astral.sh/uv/install.sh | sh\nsource $HOME/.local/bin/env","key":"krFoh97PNo"},{"type":"paragraph","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"strong","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"text","value":"Verify ","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"zPUvCq6FYM"},{"type":"inlineCode","value":"uv","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"RYIhXv46uk"},{"type":"text","value":" installation:","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"DUTVU38OkT"}],"key":"rePrwyrJvF"}],"key":"xdYaSP0m88"},{"type":"code","lang":"bash","value":"uv --version","key":"WNIC2l23rd"},{"type":"heading","depth":2,"position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"text","value":"Step 4: Clone the GitHub Repository","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"Q6olHMxWsV"}],"identifier":"step-4-clone-the-github-repository","label":"Step 4: Clone the GitHub Repository","html_id":"step-4-clone-the-github-repository","implicit":true,"key":"xSjsIHJStu"},{"type":"paragraph","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"Clone the GitHub repository containing the ","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"frEZqPdL4d"},{"type":"link","url":"https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"code","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"R1HZVUbEiK"}],"urlSource":"https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git","error":true,"key":"pKnfclhr1p"},{"type":"text","value":" for this hands-on session into your VM:","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"AmHxcIXPkb"}],"key":"FAqlLsKwm6"},{"type":"code","lang":"bash","value":"git clone https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git\ncd finetuning-gemma-1b-aims-gcp-tutorial","key":"Fxa72wXzFu"},{"type":"heading","depth":2,"position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"Step 5: Set Up the Python Environment","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"WwiiCgGWgz"}],"identifier":"step-5-set-up-the-python-environment","label":"Step 5: Set Up the Python Environment","html_id":"step-5-set-up-the-python-environment","implicit":true,"key":"KOSz0eXlHK"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"To setup the Python virtual environment using ","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"d9LORPMcJS"},{"type":"inlineCode","value":"uv","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"zFdUA3Ydbi"},{"type":"text","value":":","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"AWrJ2OCGGi"}],"key":"AcPmc1uJ4A"},{"type":"code","lang":"bash","value":"uv venv --python 3.12\nuv sync","key":"GP3JRh01yw"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"inlineCode","value":"uv sync","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"h373h7Gmah"},{"type":"text","value":" reads the ","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"YV54OtiVd2"},{"type":"inlineCode","value":"uv.lock","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"ScUm6XfuMb"},{"type":"text","value":" file and installs all dependencies at the exact versions used during development, ensuring the environment on the VM is identical to what was used locally.","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"qGZB4gg4Ui"}],"key":"GW0xkCbgRY"},{"type":"heading","depth":2,"position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"Step 6: Configure Environment Variables","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"FtaCQba0Ff"}],"identifier":"step-6-configure-environment-variables","label":"Step 6: Configure Environment Variables","html_id":"step-6-configure-environment-variables","implicit":true,"key":"WLRPpyVXUX"},{"type":"paragraph","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"You need two API keys before running anything in this hands-on session: a ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"CTyXjZXTBT"},{"type":"strong","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"HuggingFace API token","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"K9B2U1eTAc"}],"key":"Svhco6YFl0"},{"type":"text","value":" to access the Gemma model and a ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"eIYimzgnWa"},{"type":"strong","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"Weights & Biases API key","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"mpeD3SkMlO"}],"key":"nkvG91Y073"},{"type":"text","value":" to access the WandB platform for experiment tracking.","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"YUjbK0qBji"}],"key":"tzuAGqfQmF"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Getting your WandB API key:","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"rPs0Huc6iZ"}],"key":"pd6S0RP8qK"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":210,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Go to ","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"vlUMynCBHt"},{"type":"link","url":"http://wandb.ai","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"text","value":"wandb.ai","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"ecspaHVqUQ"}],"urlSource":"http://wandb.ai","key":"Gr9wbrXMa5"},{"type":"text","value":" and create a free account if you don’t have one","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"ny1kV6EbOK"}],"key":"osJ41eFK28"}],"key":"RJmaVnBjLU"},{"type":"listItem","spread":true,"position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Once logged in, click Create a new project and give it a name, for example ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"Qamgk9qiB8"},{"type":"inlineCode","value":"gemma-finetuning-gcp","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"tTJpxxC9W1"},{"type":"text","value":". This is where all your training runs and metrics will be logged.","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"PHp4m4a4Pc"}],"key":"Y6CeKyL90Q"}],"key":"DI06NZoNll"},{"type":"listItem","spread":true,"position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Navigate to ","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"PoHojXvnez"},{"type":"link","url":"http://wandb.ai/authorize","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"wandb.ai/authorize","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"VzzgKpeo7Y"}],"urlSource":"http://wandb.ai/authorize","key":"xILfgniB1K"}],"key":"NlT1SHzeFF"}],"key":"pHSqPuF9Bm"},{"type":"listItem","spread":true,"position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Copy your API key","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"AfteOm4hYL"}],"key":"fftw9SV58n"}],"key":"PSlZWOPQWK"}],"key":"G4eaw7Fcll"}],"key":"rzj3qTZIiO"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/create_new_project_w-7441e525afc12dee9f2e21d9c8c7bcaf.png","alt":"Create new project in WandB","align":"center","key":"uQxYqohOdy","urlSource":"./images/create_new_project_wandb.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"Screenshot of “Create a new project” step in WandB","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"s9gNKzWgyd"}],"key":"UsRaA1b7DZ"}],"key":"E3xc5xeTxq"}],"enumerator":"1","key":"pnmKibdXPB"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Getting your HuggingFace token","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"aHcYICdUCk"}],"key":"Vxx8kHhxZT"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":226,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Go to ","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"GFmWNfj4VV"},{"type":"link","url":"https://huggingface.co","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"text","value":"huggingface.co","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"ZDsHRcIeFl"}],"urlSource":"https://huggingface.co","key":"w4tcq8K9QZ"},{"type":"text","value":" and create a free account if you don’t have one","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"f38x77hftL"}],"key":"VZXJT6tOPx"}],"key":"TWClVs3OXw"},{"type":"listItem","spread":true,"position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Navigate to ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"MEjz3xVOAN"},{"type":"link","url":"https://huggingface.co/settings/tokens","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"text","value":"huggingface​.co​/settings​/tokens","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"Ra9ILfJNN0"}],"urlSource":"https://huggingface.co/settings/tokens","key":"I6tuBpW00p"}],"key":"LaY4DxZ3rj"}],"key":"GMprkHEIBC"},{"type":"listItem","spread":true,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a new token with read permissions and copy it","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"WvANdXPUnZ"}],"key":"SVLL5zv5he"}],"key":"Bn5Zqv83MN"}],"key":"DdD5HAfppr"}],"key":"k0jXC2Hc32"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"YafRRWj5Rz"}],"key":"ptkgRnzX99"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"Gemma 3 is a gated model on HuggingFace. Before your token will work, you must visit ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"juIGgbwUMo"},{"type":"link","url":"http://huggingface.co/google/gemma-3-1b-it","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"huggingface​.co​/google​/gemma​-3​-1b​-it","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"gB1XbJSsMI"}],"urlSource":"http://huggingface.co/google/gemma-3-1b-it","key":"yzpp0qBNQW"},{"type":"text","value":" and accept the license agreement. Without this step, the training script will fail with a 401 error.","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"hvjBsif7RO"}],"key":"VhhvkIqOFU"}],"key":"tF2YU9FyvS"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/huggingface_gemma3_1-10a0d6695359ee7930b373e6b3b61064.png","alt":"Accept Gemma 3 1B License Agreement on HuggingFace","align":"center","key":"J5VNPTm3GF","urlSource":"./images/huggingface_gemma3_1b_license_agreement.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"Screenshot of “Accept Gemma 3 1B License Agreement on HuggingFace” step","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"Cx8vt5BHUY"}],"key":"C5IVe5SVhf"}],"key":"xqqIISI4re"}],"enumerator":"2","key":"wGfuDjGoZl"},{"type":"paragraph","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"children":[{"type":"text","value":"Now copy the example env file ","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"sChrDEsFhw"},{"type":"inlineCode","value":".env.example","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"DYpYk6Tylu"},{"type":"text","value":" to create your ","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"fyaoZEDncW"},{"type":"inlineCode","value":".env","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"CF9p7frXZ7"},{"type":"text","value":" file and fill in your credentials:","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"BdxsLiK9ow"}],"key":"a10IgslMCi"},{"type":"code","lang":"bash","value":"cp .env.example .env\nnano .env","key":"n8OcL1ttKm"},{"type":"paragraph","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"Fill in your values:","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"uJQhnwxgkm"}],"key":"jdxF7qGTRe"},{"type":"code","lang":"bash","value":"HF_TOKEN=your_huggingface_token\nWANDB_API_KEY=your_wandb_api_key\nWANDB_PROJECT=your_wandb_project_name","key":"fxyvVQnYDM"},{"type":"paragraph","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"To exit the ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"HgdVlynC64"},{"type":"inlineCode","value":"nano","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"XM9a1STMMK"},{"type":"text","value":" editor: press ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"ADmhOI7zMT"},{"type":"inlineCode","value":"Ctrl+O","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"J0CnjxAFTx"},{"type":"text","value":" then ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"mEbDv5yjDq"},{"type":"inlineCode","value":"Enter","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"OqEjZjH5U5"},{"type":"text","value":" to save, then ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"b2jntlFlRf"},{"type":"inlineCode","value":"Ctrl+X","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"GWQfoQ58Ix"}],"key":"Ywd1cDJMhl"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Before moving on, please confirm the following:","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"aM2RzbEx9d"}],"key":"i48KoYNLvS"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":261,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Created a WandB account and a new project","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"TiB42MIHbQ"}],"key":"nAFrA5ZBq5"}],"checked":false,"key":"RrIYYjPllw"},{"type":"listItem","spread":true,"position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Copied your WandB API key from ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"O8OWViwrgf"},{"type":"link","url":"http://wandb.ai/authorize","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"wandb.ai/authorize","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"eho0X8bQ6t"}],"urlSource":"http://wandb.ai/authorize","key":"f52emPmymW"}],"key":"Ij5x0tDipf"}],"checked":false,"key":"Qdwt8Inq4q"},{"type":"listItem","spread":true,"position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Created a HuggingFace account and generated a read token","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"pw8QBLAYfh"}],"key":"liNErM72DV"}],"checked":false,"key":"Cqv56enTHZ"},{"type":"listItem","spread":true,"position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Accepted the Gemma 3 license agreement at ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"pPtZ5KvOiB"},{"type":"link","url":"http://huggingface.co/google/gemma-3-1b-it","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"huggingface​.co​/google​/gemma​-3​-1b​-it","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"fAI6rt3Vk1"}],"urlSource":"http://huggingface.co/google/gemma-3-1b-it","key":"FZTIzAlC0a"}],"key":"wRhwAG9eEc"}],"checked":false,"key":"hBr0QyGoOf"},{"type":"listItem","spread":true,"position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Filled in ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"ovGIXX185w"},{"type":"inlineCode","value":".env","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"IYJ1pPNUR5"},{"type":"text","value":" file with your ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"gYT1GWwMps"},{"type":"inlineCode","value":"HF_TOKEN","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"djDcx4jOoy"},{"type":"text","value":", ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"CAijN9hVui"},{"type":"inlineCode","value":"WANDB_API_KEY","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"y0Iz9PJt4j"},{"type":"text","value":", and ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"vFTjsNs0WO"},{"type":"inlineCode","value":"WANDB_PROJECT","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"b8lyrr6lWh"}],"key":"qW6MmYEJuQ"}],"checked":false,"key":"tV8tv6RXyc"}],"key":"P3Kun1fwvk"}],"key":"okVue7ARtb"},{"type":"heading","depth":2,"position":{"start":{"line":268,"column":1},"end":{"line":268,"column":1}},"children":[{"type":"text","value":"Step 7: Upload the Dataset to Google Cloud Storage (GCS) Bucket (Optional)","position":{"start":{"line":268,"column":1},"end":{"line":268,"column":1}},"key":"Z7B6KHW9F9"}],"identifier":"step-7-upload-the-dataset-to-google-cloud-storage-gcs-bucket-optional","label":"Step 7: Upload the Dataset to Google Cloud Storage (GCS) Bucket (Optional)","html_id":"step-7-upload-the-dataset-to-google-cloud-storage-gcs-bucket-optional","implicit":true,"key":"HOc17fQr0h"},{"type":"paragraph","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"children":[{"type":"text","value":"Rather than downloading the dataset from HuggingFace every time you run an experiment, we upload it once to GCS (GCP’s scalable cloud object storage service) and read from there in all subsequent runs. This is faster, avoids rate limits, and means your experiment does not depend on an external service being available. On real projects with large datasets, this pattern becomes essential.","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"key":"Q27QlbTWRO"}],"key":"VQaqllbszw"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"strong","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"Run the upload script:","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"jZ77GE0qbV"}],"key":"JdxPRvaU2G"}],"key":"TuAz1LEJqm"},{"type":"code","lang":"bash","value":"uv run bash scripts/download_and_upload_gcs.sh\n\n# You can optionally pass a custom bucket name:\nuv run bash scripts/download_and_upload_gcs.sh <BUCKET_NAME>","key":"UirnDjG2HU"},{"type":"paragraph","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"children":[{"type":"text","value":"This script downloads the Dolly-15k dataset from HuggingFace, creates a new GCS bucket, and uploads the downloaded dataset to the GCS bucket.","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"key":"U9foU7nbSd"}],"key":"buvrFyfjZA"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/upload_dataset_to_gc-6d03c65d5a9e79b1ab078234a1b60d98.png","alt":"Upload Dataset to GCS Instruction","align":"center","key":"KT36JvkAgt","urlSource":"./images/upload_dataset_to_gcs_bucket.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Screenshot of “Upload Dataset to GCS Bucket” step","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"kTfn2pXfL0"}],"key":"ofuh5OYpJW"}],"key":"nT1pPXobkl"}],"enumerator":"3","key":"gbenldOmD4"},{"type":"paragraph","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"strong","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"text","value":"Verify the data is in the GCS bucket:","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"BPaDsabB4o"}],"key":"n1hy3S8njt"}],"key":"vEkJM27iPp"},{"type":"code","lang":"bash","value":"gcloud storage ls gs://<BUCKET_NAME>/data/raw/","key":"AgOerAL1QS"},{"type":"heading","depth":2,"position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"children":[{"type":"text","value":"Step 8: Start a ","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"qLlNWbrUBr"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"CyPI7PGvJ5"},{"type":"text","value":" Session","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"H0O9U5y6eM"}],"identifier":"step-8-start-a-tmux-session","label":"Step 8: Start a tmux Session","html_id":"step-8-start-a-tmux-session","implicit":true,"key":"soCtUWbQjQ"},{"type":"paragraph","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"text","value":"Training this 1 Billion parameter model using LoRA takes about 25-40 minutes. Rather than keeping your SSH connection open the entire time, we use ","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"vlOmmzT0gk"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"SquZwbJSRF"},{"type":"text","value":" to run training in a persistent terminal session. This means if your SSH connection closes, training keeps running on the VM.","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"p1zJxVwcDW"}],"key":"zYITfUP4eI"},{"type":"paragraph","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"strong","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"text","value":"Install ","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"pReg2UyA1P"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"gZjW28RHgr"},{"type":"text","value":" and start a new session:","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"d3uxFyUwu7"}],"key":"VKoYVDmvLt"}],"key":"yav6Qj1NaB"},{"type":"code","lang":"bash","value":"sudo apt-get install -y tmux \ntmux new -s finetunegemma1b","key":"dAxs11W8mH"},{"type":"paragraph","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"text","value":"This creates a new session named “finetunegemma1b”. You should now be inside the created ","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"UzuZ80i8d5"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"bs4BOPFiAU"},{"type":"text","value":" session.","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"yWBSKWxAM0"}],"key":"qADkpzYHjT"},{"type":"paragraph","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"strong","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"text","value":"To detach the session without killing it:","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"DFgbVG5b1i"}],"key":"eJfaCyuwMY"}],"key":"BHrcwVY27j"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":311,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":311,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Press ","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"Fe0oKlyLF0"},{"type":"inlineCode","value":"Ctrl+B","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"HZ2tq3SvKN"},{"type":"text","value":" then the ","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"BIHw1GvHEb"},{"type":"inlineCode","value":"D","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"d4XcvLj0wH"},{"type":"text","value":" key","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"noEzjZXWM7"}],"key":"wVHteWEZX2"}],"key":"DHVBrgHQSC"}],"key":"Gj9Og3czCG"},{"type":"paragraph","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"text","value":"Alternatively, you can run the command from another shell for this server:","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"key":"vkxrkRWndk"}],"key":"G2MTgnEIBQ"},{"type":"code","lang":"bash","value":"tmux detach -s <session_name>","key":"qlT7hliL0K"},{"type":"paragraph","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"children":[{"type":"strong","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"children":[{"type":"text","value":"To return to a detached session layer:","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"key":"n5cnCxGd6o"}],"key":"bP5BwfF6wO"}],"key":"KMSbslTeSn"},{"type":"code","lang":"bash","value":"tmux attach -t <session_name>","key":"kAsDa0L9P4"},{"type":"heading","depth":2,"position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"children":[{"type":"text","value":"Step 9: Run the Training Script","position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"key":"coPKruY8Ln"}],"identifier":"step-9-run-the-training-script","label":"Step 9: Run the Training Script","html_id":"step-9-run-the-training-script","implicit":true,"key":"q7mEQqsEon"},{"type":"paragraph","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"text","value":"In the ","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"ErdRuPs7zZ"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"g5D1nwHnTg"},{"type":"text","value":" session shell, run the script below to start finetuning the model:","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"xc8SGP0auq"}],"key":"bAyhUf6QLK"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_train \\\n    data.source=hf \\\n    data.max_train_samples=10000 \\\n    training.num_epochs=2 \\\n    training.batch_size=8 \\\n    experiment_id=exp_lora_r8","key":"t4P7SZcDMm"},{"type":"paragraph","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"This trains on 10,000 samples for 2 epochs with LoRA rank 8, giving us ","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"XBN5b5cK3N"},{"type":"inlineCode","value":"10,000 / 8 = 1,250 steps per epoch","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"CbDuFmQaJD"},{"type":"text","value":" and ","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"pFSTF2ypMM"},{"type":"inlineCode","value":"2,500 steps total","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"txQu2yBtsG"},{"type":"text","value":". On the NVIDIA L4 GPU, this should take roughly ","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"bWqy4Z4AEU"},{"type":"strong","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"20-30 minutes","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"UbMuIWrt3Q"}],"key":"LoLcPnB1bz"},{"type":"text","value":".","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"PS8aXWHQlW"}],"key":"O7cYOr0dcc"},{"type":"paragraph","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"children":[{"type":"text","value":"You can now detach from the tmux session and monitor training progress from your WandB dashboard at ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"nh6VxjQ7jV"},{"type":"link","url":"http://wandb.ai","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"children":[{"type":"text","value":"wandb.ai","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"ulmpnAZi1W"}],"urlSource":"http://wandb.ai","key":"jH0f25cXk7"},{"type":"text","value":". You will see ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"aLhFAEwhb9"},{"type":"inlineCode","value":"train/loss","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"qt1wh5g4tJ"},{"type":"text","value":", ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"LLlxpqdowW"},{"type":"inlineCode","value":"eval/loss","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"GZEbU7bSev"},{"type":"text","value":", ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"FCvHBFUB49"},{"type":"inlineCode","value":"train/grad_norm","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"aiOJgvfOqs"},{"type":"text","value":", and ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"M2fTECmwve"},{"type":"inlineCode","value":"train/learning_rate","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"dcCCbDaX2A"},{"type":"text","value":" updating every 10 steps.","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"tIVQ3kfFQf"}],"key":"LYR3dqRQfI"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/wandb_train_run_moni-36c25894132d277f4bdcae47420d9408.png","alt":"Monitor Training Progress on WandB Dashboard","align":"center","key":"YD2S5yxeyd","urlSource":"./images/wandb_train_run_monitoring.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"children":[{"type":"text","value":"Screenshot of WandB dashboard for monitoring training progress and metrics","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"sSEZxNYVpR"}],"key":"uDtFJmQYVq"}],"key":"jD0CozXGES"}],"enumerator":"4","key":"gOkOiCb0JL"},{"type":"heading","depth":2,"position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"text","value":"Step 10: Run Evaluation","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"jTrxf3O3N1"}],"identifier":"step-10-run-evaluation","label":"Step 10: Run Evaluation","html_id":"step-10-run-evaluation","implicit":true,"key":"ItAztHL29y"},{"type":"paragraph","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"text","value":"Once training finishes, reattach to the tmux session if you detached:","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"nzubXgVRAt"}],"key":"vFj41q3wux"},{"type":"code","lang":"bash","value":"tmux attach -t <session_name>","key":"X6UYfek4a3"},{"type":"paragraph","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"children":[{"type":"text","value":"Run the evaluation script. Replace ","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"AtNCrkh0wk"},{"type":"inlineCode","value":"<experiment_id>","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"pGRuaaCiVl"},{"type":"text","value":" and ","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"vIY9i7BRKw"},{"type":"inlineCode","value":"<checkpoint_folder>","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"V3OTmrUEyD"},{"type":"text","value":" with the actual paths from your ","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"Dxo3kMzJDc"},{"type":"inlineCode","value":"outputs/","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"EdCsqjAwni"},{"type":"text","value":" directory:","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"Npp4gFexl4"}],"key":"BHdptaxpsE"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_evaluate \\\n    --model_path outputs/<experiment_id>/<checkpoint_folder> \\\n    --eval_file data/eval/eval_prompts.jsonl","key":"I4kMDWSeTl"},{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"This computes perplexity and repetition rate on the evaluation set and logs the results to WandB.","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"UdScKLvgm2"}],"key":"qjV0bBV7gZ"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/wandb-gemma-finetune-a4e0baf266413e966efe8a5cd8e39f66.png","alt":"Monitor Evaluation Results on WandB Dashboard","align":"center","key":"vKcDxnyKVh","urlSource":"./images/wandb-gemma-finetune-evaluation-dashboard.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"children":[{"type":"text","value":"Screenshot of WandB dashboard for monitoring evaluation results","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"nzC9bNazcu"}],"key":"MDm4XJ855z"}],"key":"WZ93lPjXSF"}],"enumerator":"5","key":"bwbCeCu1QT"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"KhAk6Fmw99"}],"key":"Rz3xdqOO9E"},{"type":"paragraph","position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"children":[{"type":"text","value":"Do not worry too much about the evaluation results. The goal of this tutorial is not to produce a state-of-the-art model but to walk through the complete workflow of fine-tuning a large language model on a GCP VM end to end.","position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"key":"jJ2K160pGy"}],"key":"CL3kzwhP2L"}],"key":"qlgd19mBlV"},{"type":"heading","depth":2,"position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"Step 11: Run Inference (Optional)","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"eF0PFq5Pe1"}],"identifier":"step-11-run-inference-optional","label":"Step 11: Run Inference (Optional)","html_id":"step-11-run-inference-optional","implicit":true,"key":"x6dAFMAdPe"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"Test the model on a single instruction","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"n344EcahC0"}],"key":"wovYZFxDrX"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_inference \\\n    --model_path outputs/<experiment_id>/<checkpoint_folder> \\\n    --instruction \"Explain what machine learning is in simple terms\"","key":"xUaJqs1UuK"},{"type":"paragraph","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"children":[{"type":"text","value":"You can also run in interactive mode to keep sending instructions:","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"key":"tQACzwDPXv"}],"key":"JdckvnySmE"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_inference \\\n    --model_path outputs/<experiment_id>/<checkpoint_folder>","key":"Ttm7qJrxOk"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/finetune_gemma_exper-c736abdd1d9504f15a8618a43890437d.png","alt":"Fine-tuned Gemma 3 1B Inference Result","align":"center","key":"Y0lF6QaxcN","urlSource":"./images/finetune_gemma_experiment_inference_result.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"children":[{"type":"text","value":"Screenshot of inference result using the fine-tuned Gemma 3 1B model","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"key":"bIdPyBwuqY"}],"key":"eKfwCIj9hU"}],"key":"bny7aNLrkV"}],"enumerator":"6","key":"ant0HuUMyg"},{"type":"heading","depth":2,"position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"children":[{"type":"text","value":"Step 12: Sync Outputs to GCS","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"key":"zWxlXkOl2T"}],"identifier":"step-12-sync-outputs-to-gcs","label":"Step 12: Sync Outputs to GCS","html_id":"step-12-sync-outputs-to-gcs","implicit":true,"key":"YCVSxIG6FX"},{"type":"paragraph","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"children":[{"type":"text","value":"Before deleting the VM, sync your checkpoints and logs to your GCS bucket so they persist:","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"DgJyPfUTBI"}],"key":"zQzEbUUkZj"},{"type":"code","lang":"bash","value":"gcloud storage cp -r outputs/ gs://<BUCKET_NAME>/outputs/","key":"tW5NCax2le"},{"type":"paragraph","position":{"start":{"line":409,"column":1},"end":{"line":409,"column":1}},"children":[{"type":"text","value":"Verify the GCS bucket content from the GCS dashboard or from the CLI:","position":{"start":{"line":409,"column":1},"end":{"line":409,"column":1}},"key":"CSExXfWllt"}],"key":"KvUUkW7KKP"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/build/gcp-console-gemma-fi-b0b616670f6cc98ec07f6de5581c1c88.png","alt":"GCS Bucket on GCP Console","align":"center","key":"aYQj8xRoYX","urlSource":"./images/gcp-console-gemma-finetune-experiment-bucket.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":415,"column":1},"end":{"line":415,"column":1}},"children":[{"type":"text","value":"Screenshot of GCS bucket on the GCP console showing the “data” and synced “outputs” folder.","position":{"start":{"line":415,"column":1},"end":{"line":415,"column":1}},"key":"z9AvgOdXre"}],"key":"TuroeKIA8E"}],"key":"ad8GszToxk"}],"enumerator":"7","key":"ShEEGHGL1G"},{"type":"code","lang":"bash","value":"gcloud storage ls gs://<BUCKET_NAME>/outputs/","key":"TYtXAalgL3"},{"type":"paragraph","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"children":[{"type":"text","value":"Exit the tmux session:","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"key":"oZvONV0mEC"}],"key":"ZU4mVWJlcs"},{"type":"code","value":"exit","key":"OwJRUcAXeV"},{"type":"heading","depth":2,"position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"children":[{"type":"text","value":"Step 13: Resource Cleanup","position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"key":"zwl8ZtAp1h"}],"identifier":"step-13-resource-cleanup","label":"Step 13: Resource Cleanup","html_id":"step-13-resource-cleanup","implicit":true,"key":"OuBWTpfdMC"},{"type":"admonition","kind":"danger","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Danger","key":"xE8z8ZZJrk"}],"key":"dBZllEd6rE"},{"type":"paragraph","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"children":[{"type":"text","value":"Delete the VM when you are done to avoid incurring charges. GPU VMs are billed by the second and the NVIDIA L4 GPU VM using the ","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"WhHWjvN4z2"},{"type":"inlineCode","value":"g2-standard-4","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"Xr1ZiYdSsZ"},{"type":"text","value":" machine configuration costs roughly $0.70/hour even when idle.","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"T8fwCtDkFw"}],"key":"uVOyI9Vnz8"}],"key":"ljekA2SDDc"},{"type":"paragraph","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"Run the script below and replace ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"It8GqB39Y5"},{"type":"inlineCode","value":"<YOUR_AIMSUSERNAME>","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"sTh2YnWoTS"},{"type":"text","value":" and ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"XXYwS2u9SK"},{"type":"inlineCode","value":"<ZONE>","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"vA6yJCJTLo"},{"type":"text","value":" with the values you used in the VM creation script.","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"Su0kZnjgvO"}],"key":"quVu3bEbBI"},{"type":"code","lang":"bash","value":"gcloud compute instances delete <YOUR_AIMSUSERNAME>-l4-vm --zone=<ZONE> --quiet","key":"AWRTadbw2j"},{"type":"paragraph","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"children":[{"type":"strong","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"children":[{"type":"text","value":"Verify it has been deleted:","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"key":"JAGXgjXJ6b"}],"key":"BwZd4AUENM"}],"key":"BC1mpZ5iJv"},{"type":"code","lang":"bash","value":"gcloud compute instances list","key":"X4phMinJdD"},{"type":"thematicBreak","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"key":"iV4wdtk885"},{"type":"heading","depth":2,"position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"children":[{"type":"text","value":"🔑 Key Takeways","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"key":"xpOGopJqii"}],"identifier":"id-key-takeways","label":"🔑 Key Takeways","html_id":"id-key-takeways","implicit":true,"key":"LIXTUfoVxV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":450,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Using a package manager like ","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"KS8qoa4UB0"},{"type":"inlineCode","value":"uv","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"wbzKlXiloC"},{"type":"text","value":" ensures your Python environment is reproducible across any machine. A single ","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"zwrtXEecQz"},{"type":"inlineCode","value":"uv sync","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"SLuUnBAHQS"},{"type":"text","value":" installs all dependencies at the exact versions pinned in the lock file, eliminating environment mismatch issues.","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"onsHLtCQ93"}],"key":"XxA6VdMqvT"}],"key":"bx7BO6BZYl"},{"type":"listItem","spread":true,"position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Uploading your dataset to GCS once and reading from there on every run is more reliable and faster than downloading from external sources each time.","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"cQnJ0JrV3K"}],"key":"BrhuzRkwyX"}],"key":"axNuVGco3d"},{"type":"listItem","spread":true,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"tmux","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"KPZ8s3LKVf"},{"type":"text","value":" is essential for long-running jobs on remote VMs. It keeps your process alive even if your SSH connection is destroyed.","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"KICjpHRuBU"}],"key":"xN8VGPazBr"}],"key":"ntpKDn8HOz"},{"type":"listItem","spread":true,"position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"WandB gives you full visibility into training progress and metrics from any browser, without needing to stay connected to the VM.","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"h6dHLuhbyL"}],"key":"GQV33APiC3"}],"key":"I7FUEHwbuH"},{"type":"listItem","spread":true,"position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Always sync outputs to GCS before deleting your VM. VM disks are ephemeral and deleted with the instance.","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"XLKdEDwP6T"}],"key":"CxUqA9huH9"}],"key":"alcZNnFQTq"},{"type":"listItem","spread":true,"position":{"start":{"line":455,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Always delete your VM after a session to avoid unexpected charges.","position":{"start":{"line":455,"column":1},"end":{"line":455,"column":1}},"key":"sc3TWseVjc"}],"key":"EYUamvoh23"}],"key":"SQjPHeekwH"}],"key":"IQkR4i5qXg"},{"type":"heading","depth":2,"position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"children":[{"type":"text","value":"🚀 What’s Next?","position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"key":"HZuDFwBgtJ"}],"identifier":"id-whats-next","label":"🚀 What’s Next?","html_id":"id-whats-next","implicit":true,"key":"DCC4D63qXl"},{"type":"paragraph","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"In the next session, we will look at ","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"rsKMr1JK4i"},{"type":"strong","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"Vertex AI","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"AjyQ0ykrBz"}],"key":"nHAP0g9Dxg"},{"type":"text","value":", Google Cloud’s fully managed ML platform and how it can simplify running experiments like this without provisioning or managing any infrastructure yourself.","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"R68yYPDiMt"}],"key":"EpIYSgJDh2"}],"key":"hMcNf7yawE"}],"key":"HClKcVjCqM"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Introduction","url":"/part2-running-experiments-on-gcp-vms","group":"Part 2 - Running Experiments On GCP VMs"},"next":{"title":"Introduction","url":"/part3-vertex-ai","group":"Part 3 - Vertex AI"}}},"domain":"http://localhost:3000"}