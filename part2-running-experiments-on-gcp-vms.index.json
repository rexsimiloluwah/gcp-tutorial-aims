{"version":3,"kind":"Article","sha256":"f847b5b9268f00d785c37d00d4e0546b7d8bd59e2f5d86b28f14fc852da1cc28","slug":"part2-running-experiments-on-gcp-vms.index","location":"/part2-running-experiments-on-gcp-vms/index.md","dependencies":[],"frontmatter":{"title":"Introduction","content_includes_title":false,"authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/blob/main/part2-running-experiments-on-gcp-vms/index.md","edit_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/edit/main/part2-running-experiments-on-gcp-vms/index.md","exports":[{"format":"md","filename":"index.md","url":"/gcp-tutorial-aims/build/index-8967079b3958e83efec656d503e5d324.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Running AI Experiments on GCP VMs","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"b2YiNckxyX"}],"identifier":"running-ai-experiments-on-gcp-vms","label":"Running AI Experiments on GCP VMs","html_id":"running-ai-experiments-on-gcp-vms","implicit":true,"key":"tJOBqXxXt6"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"When a machine learning experiment outgrows your laptop, because the model is too large, training takes too long, or you need a GPU, the natural next step is to move it to the cloud.\nGCP virtual machines (VMs) give you on-demand access to powerful hardware, including modern GPUs like the NVIDIA L4, without the cost of owning physical hardware.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TPCXj8Km1A"}],"key":"byPTm8DUfN"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Running experiments on a remote VM is conceptually simple: it is just a Linux machine you can SSH into and run Python code on. But there are a few things worth understanding before you get started.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"kynOQEy79G"}],"key":"vdkrLhyAcx"},{"type":"heading","depth":3,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Reproducible Environments","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"vs3MakUKIi"}],"identifier":"reproducible-environments","label":"Reproducible Environments","html_id":"reproducible-environments","implicit":true,"key":"oxALpnCuo7"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Code that works locally often fails on a VM due to different Python versions or package versions.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ZSnGm0Ljb0"}],"key":"OX3ooq8t4G"}],"key":"TmwnXBGnzM"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Hence it is important to use package managers like ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"F4zRSmq7um"},{"type":"inlineCode","value":"uv","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"RRgHlAZ48k"},{"type":"text","value":" or ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Cq2I4WfYqC"},{"type":"inlineCode","value":"poetry","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"j4USvO5COA"},{"type":"text","value":" to automate the installation, configuration, and management of software dependencies, ensuring consistency and reproducibility.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"VpaII6LX2s"}],"key":"mzDKL2dGLB"}],"key":"wuC89LAIAv"}],"key":"OuYM2RTY5R"},{"type":"heading","depth":3,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Persistent Storage","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"F4797GXJJM"}],"identifier":"persistent-storage","label":"Persistent Storage","html_id":"persistent-storage","implicit":true,"key":"n0NmhqR8Wd"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"VM disks are ephemeral. When you delete the VM, everything else is deleted.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"z7AVv4k7on"}],"key":"yaTGaUzqtX"}],"key":"f34gOMUZIF"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It is important to always write outputs, checkpoints, and logs to a persistent object storage like Google Cloud Storage (GCS) during or after training so they persist independently of the VM.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"AyhL5r7D9N"}],"key":"MFbXvNFAT3"}],"key":"r2EXAT4VvX"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Think of the VM as temporary compute and GCS as permanent storage.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"TKFzw2y05p"}],"key":"G3FKeR0BZO"}],"key":"ex4XuuDG5X"}],"key":"mr5HxRTvek"},{"type":"heading","depth":3,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Long-Running Jobs","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"tZUoWR90qo"}],"identifier":"long-running-jobs","label":"Long-Running Jobs","html_id":"long-running-jobs","implicit":true,"key":"mYe4T8dnll"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":23,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Training machine learning models can take anywhere from minutes, for small models like XGBoost, to hours or even days for models like transformers or large language models.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"m5NX5PDDTs"}],"key":"CtjOmlFcp5"}],"key":"zVZFrDN5UD"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Keeping an SSH connection open for the entire duration is fragile. A dropped connection can kill the training process.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"JohygsWfrE"}],"key":"Qgsyzcal8q"}],"key":"xHuNSumDd6"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You can use a tool like ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"fYKMbb9V88"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"XQvhVuwkGR"},{"type":"text","value":" to keep your process running on the VM even if your SSH session disconnects.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"GwclbNnuwL"}],"key":"XUD7Ia7nQa"}],"key":"ML88fOclNn"}],"key":"bcf8fJknp4"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Experiment Monitoring and Logging","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"TFadBdrHEW"}],"identifier":"experiment-monitoring-and-logging","label":"Experiment Monitoring and Logging","html_id":"experiment-monitoring-and-logging","implicit":true,"key":"HzSEvpGbwW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":29,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Experiment monitoring is the practice of logging and visualizing metrics as a model trains, giving you a live record of how your experiment is progressing.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"DkIB5ZVCpo"}],"key":"UOqwzWGxEi"}],"key":"W0k1VyJ4u1"},{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"On a remote VM, you cannot just watch your terminal, so you need a tool that logs metrics to a dashboard you can access from anywhere.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"ygdYH3jEh4"}],"key":"p9BaGMkNRM"}],"key":"HcC4G9AZK7"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Tools like ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"oNZJpn7TGE"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Weights & Biases","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"IOoeoa1tzy"}],"key":"XXQdjYQSEn"},{"type":"text","value":", ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"bNqkWO8xc0"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Tensorboard","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"IcZZanmpYD"}],"key":"dTirsG7YCC"},{"type":"text","value":", or ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"J5hkbIVBN0"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"MLFlow","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"Ho9vMhAOwF"}],"key":"V3Ty2wwLfB"},{"type":"text","value":" automatically track metrics like loss, accuracy, and learning rate, hardware utilization, and maintain a history of every experiment you run.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"iyAR0oi7SQ"}],"key":"HVUYkem8s5"}],"key":"aoXh1fPWz6"},{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This gives you a centralized record of all your experiments, making it easy to compare runs, spot regressions, and share results with others.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"nMQvdDwEaw"}],"key":"pIIS59Ra9X"}],"key":"rVWkdKEjws"}],"key":"oueUSrq1HP"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Cost Management","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"v9rGQEQaqT"}],"identifier":"cost-management","label":"Cost Management","html_id":"cost-management","implicit":true,"key":"UHoszMh4Ic"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"VMs are billed by the second. An idle VM costs the same as a busy one.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"cMS4WTnfJL"}],"key":"TIuYmYlR24"}],"key":"pjn1Gu76af"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Always stop/delete your VM when an experiment is done.","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"uF1mdulD00"}],"key":"QxaWRgSKOp"}],"key":"S0h45bz0UP"}],"key":"BY5ddEO5iI"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"x6fBUi5KVP"}],"key":"Sp9o84JzG2"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"GPU VMs are significantly more expensive than CPU VMs. An NVIDIA L4 instance costs roughly $0.70/hour. Always double-check that your VM has been deleted after a session by running gcloud compute instances list.","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"pp38GSG35z"}],"key":"Q7wL8d06vA"}],"key":"OyYUWBvcMm"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"ttkOrRGiTi"}],"key":"QwCL6mHFds"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Never store API keys or tokens directly in your code or commit them to GitHub. Use a .env file listed in .gitignore and load credentials at runtime.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"PNzsrONK8O"}],"key":"S7MzWNsR3J"}],"key":"rfiQYkMfUc"},{"type":"thematicBreak","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"t4saQtQi6Z"},{"type":"heading","depth":2,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"ðŸš€ Whatâ€™s Next?","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"Rfw2vewkIF"}],"identifier":"id-whats-next","label":"ðŸš€ Whatâ€™s Next?","html_id":"id-whats-next","implicit":true,"key":"NYbximaEQL"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"In the hands-on session that follows, you will run a complete end-to-end ML experiment on a GCP VM with an NVIDIA L4 GPU. This will involve:","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"Zy0PqDWi8O"}],"key":"y3uH81b7tQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":53,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Fine-tuning ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"qXvO74wD48"},{"type":"strong","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Gemma 3 1B","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"afLfAxS41v"}],"key":"Y7atRHdP6K"},{"type":"text","value":" on the Dolly-15k instruction dataset using LoRA.","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"kcA1Wg6UXS"}],"key":"flX0DYTkNS"}],"key":"Vty6rGl04W"},{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Tracking experiments in real time with ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"blOo9j5cyh"},{"type":"strong","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Weights & Biases","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"h6ImP7KZEN"}],"key":"NSdZZ0Smdm"}],"key":"ad0jHu2oYt"}],"key":"vor9urmLPq"},{"type":"listItem","spread":true,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Persisting checkpoints and outputs to GCS","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"i0rmDElxeq"}],"key":"IoUf02fOBP"}],"key":"LJc7oR0BSX"},{"type":"listItem","spread":true,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Running evaluation and inference on the trained model","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"auMg7zcnjR"}],"key":"s7ldhU28S6"}],"key":"aSLRkUK4YV"}],"key":"lX1hT74VEx"}],"key":"yq9bSwag4R"}],"key":"dQGZiYcUOv"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Hands-On 02: Automation with the Google Cloud CLI (gcloud)","url":"/part1-gcp-foundations/hands-on-gcloud-cli","group":"Part 1 - GCP Foundations"},"next":{"title":"Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM","url":"/part2-running-experiments-on-gcp-vms/hands-on-running-ai-experiments-on-gcp-vms","group":"Part 2 - Running Experiments On GCP VMs"}}},"domain":"http://localhost:3000"}