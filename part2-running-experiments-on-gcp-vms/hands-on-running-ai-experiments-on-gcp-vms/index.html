<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM - AIMS GCP ML Tutorial</title><meta property="og:title" content="Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM - AIMS GCP ML Tutorial"/><meta name="generator" content="mystmd"/><meta name="description" content="A no-fluff guide to using GCP for ML experiments and research"/><meta property="og:description" content="A no-fluff guide to using GCP for ML experiments and research"/><meta name="keywords" content="GCP, AI, GPU, Machine Learning, Research, Experiments, MLOps"/><meta name="image" content="/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png"/><meta property="og:image" content="/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png"/><link rel="stylesheet" href="/gcp-tutorial-aims/build/_assets/app-2K3KGISG.css"/><link rel="stylesheet" href="/gcp-tutorial-aims/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/gcp-tutorial-aims/favicon.ico"/><link rel="stylesheet" href="/gcp-tutorial-aims/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100%;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-full top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block xl:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/gcp-tutorial-aims/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">AIMS GCP ML Tutorial</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 dark:text-gray-300 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-full xl:pointer-events-none overflow-auto max-xl:w-[75vw] max-xl:max-w-[350px] max-xl:!top-0 max-xl:h-screen hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden max-xl:h-full hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity lg:hidden ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white font-medium"></div></nav><div class="my-3 border-b-2 lg:hidden"></div><nav aria-label="Table of Contents" class="myst-primary-sidebar-toc flex-grow overflow-y-hidden transition-opacity ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="myst-toc w-full px-1 dark:text-white"><a title="AIMS GCP Tutorial" class="block break-words focus:outline outline-blue-200 outline-2 rounded myst-toc-item p-2 my-1 rounded-lg hover:bg-slate-300/30 font-bold" href="/gcp-tutorial-aims/">AIMS GCP Tutorial</a><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Part 1 - GCP Foundations" class="block break-words rounded py-2 grow cursor-pointer">Part 1 - GCP Foundations</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rmpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rmpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Part 2 - Running Experiments On GCP VMs" class="block break-words rounded py-2 grow cursor-pointer">Part 2 - Running Experiments On GCP VMs</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:Rupsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:Rupsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Part 3 - Vertex AI" class="block break-words rounded py-2 grow cursor-pointer">Part 3 - Vertex AI</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R16psp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R16psp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Part 4 - Cost Management" class="block break-words rounded py-2 grow cursor-pointer">Part 4 - Cost Management</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1epsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1epsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div><div data-state="closed" class="w-full"><div class="myst-toc-item flex flex-row w-full gap-2 pl-2 my-1 text-left rounded-lg outline-none hover:bg-slate-300/30"><div title="Appendix" class="block break-words rounded py-2 grow cursor-pointer">Appendix</div><button class="self-stretch flex items-center flex-none px-1 rounded-l-md group hover:bg-slate-300/30 focus-visible:outline outline-blue-200 outline-2" aria-label="Open Folder" type="button" aria-controls="radix-:R1mpsp:" aria-expanded="false" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="transition-transform duration-300 group-data-[state=open]:rotate-90 text-text-slate-700 dark:text-slate-100" height="1.5rem" width="1.5rem"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></button></div><div data-state="closed" id="radix-:R1mpsp:" hidden="" class="pl-3 pr-[2px] collapsible-content"></div></div></div></nav></div><div class="myst-primary-sidebar-footer flex-none py-6 transition-all duration-700 translate-y-6 opacity-0 ml-3 xl:ml-0 mr-3 max-w-[350px]"><a class="myst-made-with-myst flex mx-auto text-gray-700 w-fit hover:text-blue-700 dark:text-gray-200 dark:hover:text-blue-400" href="https://mystmd.org/made-with-myst" target="_blank" rel="noreferrer"><svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" stroke="none"><g id="icon"><path fill="currentColor" d="M23.8,54.8v-3.6l4.7-0.8V17.5l-4.7-0.8V13H36l13.4,31.7h0.2l13-31.7h12.6v3.6l-4.7,0.8v32.9l4.7,0.8v3.6h-15
          v-3.6l4.9-0.8V20.8H65L51.4,53.3h-3.8l-14-32.5h-0.1l0.2,17.4v12.1l5,0.8v3.6H23.8z"></path><path fill="#F37726" d="M47,86.9c0-5.9-3.4-8.8-10.1-8.8h-8.4c-5.2,0-9.4-1.3-12.5-3.8c-3.1-2.5-5.4-6.2-6.8-11l4.8-1.6
          c1.8,5.6,6.4,8.6,13.8,8.8h9.2c6.4,0,10.8,2.5,13.1,7.5c2.3-5,6.7-7.5,13.1-7.5h8.4c7.8,0,12.7-2.9,14.6-8.7l4.8,1.6
          c-1.4,4.9-3.6,8.6-6.8,11.1c-3.1,2.5-7.3,3.7-12.4,3.8H63c-6.7,0-10,2.9-10,8.8"></path></g></svg><span class="self-center ml-2 text-sm">Made with MyST</span></a></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer" class="myst-fm-license-cc-badge opacity-50 hover:opacity-100 text-inherit hover:text-inherit myst-fm-license-content" aria-label="Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-license-cc-icon myst-fm-license-cc-icon-main inline-block mx-1"><title>Content License: Creative Commons Attribution 4.0 International (CC-BY-4.0)</title><path d="M12 2.2c2.7 0 5 1 7 2.9.9.9 1.6 2 2.1 3.1.5 1.2.7 2.4.7 3.8 0 1.3-.2 2.6-.7 3.8-.5 1.2-1.2 2.2-2.1 3.1-1 .9-2 1.7-3.2 2.2-1.2.5-2.5.7-3.7.7s-2.6-.3-3.8-.8c-1.2-.5-2.2-1.2-3.2-2.1s-1.6-2-2.1-3.2-.8-2.4-.8-3.7c0-1.3.2-2.5.7-3.7S4.2 6 5.1 5.1C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C5.6 7.1 5 8 4.6 9c-.4 1-.6 2-.6 3s.2 2.1.6 3c.4 1 1 1.8 1.8 2.6S8 19 9 19.4c1 .4 2 .6 3 .6s2.1-.2 3-.6c1-.4 1.9-1 2.7-1.8 1.5-1.5 2.3-3.3 2.3-5.6 0-1.1-.2-2.1-.6-3.1-.4-1-1-1.8-1.7-2.6C16.1 4.8 14.2 4 12 4zm-.1 6.4l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.5.3-1 .4-1.5.4-.9 0-1.6-.3-2.1-.8-.5-.6-.8-1.3-.8-2.3 0-.9.3-1.7.8-2.2.6-.6 1.3-.8 2.1-.8 1.2 0 2.1.4 2.6 1.4zm5.6 0l-1.3.7c-.1-.3-.3-.5-.5-.6-.2-.1-.4-.2-.6-.2-.9 0-1.3.6-1.3 1.7 0 .5.1.9.3 1.3.2.3.5.5 1 .5.6 0 1-.3 1.2-.8l1.2.6c-.3.5-.6.9-1.1 1.1-.4.2-.9.3-1.4.3-.9 0-1.6-.3-2.1-.8s-.8-1.3-.8-2.2c0-.9.3-1.7.8-2.2.5-.5 1.2-.8 2-.8 1.2 0 2.1.4 2.6 1.4z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-license-cc-icon myst-fm-license-cc-icon-by inline-block mr-1"><title>Credit must be given to the creator</title><path d="M12 2.2c2.7 0 5 .9 6.9 2.8 1.9 1.9 2.8 4.2 2.8 6.9s-.9 5-2.8 6.8c-2 1.9-4.3 2.9-7 2.9-2.6 0-4.9-1-6.9-2.9-1.8-1.7-2.8-4-2.8-6.7s1-5 2.9-6.9C7 3.2 9.3 2.2 12 2.2zM12 4c-2.2 0-4.1.8-5.6 2.3C4.8 8 4 9.9 4 12c0 2.2.8 4 2.4 5.6C8 19.2 9.8 20 12 20c2.2 0 4.1-.8 5.7-2.4 1.5-1.5 2.3-3.3 2.3-5.6 0-2.2-.8-4.1-2.3-5.7C16.1 4.8 14.2 4 12 4zm2.6 5.6v4h-1.1v4.7h-3v-4.7H9.4v-4c0-.2.1-.3.2-.4.1-.2.2-.2.4-.2h4c.2 0 .3.1.4.2.2.1.2.2.2.4zm-4-2.5c0-.9.5-1.4 1.4-1.4s1.4.5 1.4 1.4c0 .9-.5 1.4-1.4 1.4s-1.4-.5-1.4-1.4z"></path></svg></a><a href="https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial" title="GitHub Repository: rexsimiloluwa/aims-ai-gcp-tutorial" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/edit/main/part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM</h1><header class="myst-fm-authors-affiliations mt-4 not-prose"><div class="myst-fm-authors-list"><span class="myst-fm-author font-semibold text-sm myst-fm-author-item inline-block"><button class="myst-fm-author-popover focus:shadow-[0_0_0_2px] focus:shadow-black outline-none hover:underline" aria-label="Author Details" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R78ucp:" data-state="closed"><span class="myst-fm-author-name">AIMS TtT Team</span></button></span></div></header></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><p>In this hands-on session, we will fine-tune <strong>Gemma 3 1B</strong> (a small language model with 1 billion parameters) on the <strong>Dolly-15k</strong> instruction dataset using <strong>LoRA (Low-Rank Adaptation)</strong>, track our experiments with <strong>Weights &amp; Biases</strong>, and persist outputs and model artifacts to <strong>Google Cloud Storage</strong>.</p><h2 id="overview" class="relative group"><span class="heading-text">Overview</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#overview" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>By the end of this hands-on session, you will have:</p><ul><li><p>Provisioned an L4 GPU VM using the Compute Engine service via <code>gcloud</code> CLI</p></li><li><p>Set up a Python environment using <code>uv</code></p></li><li><p>Cloned the experiment repository from GitHub</p></li><li><p>Run the scripts to fine-tune Gemma 3 1B using LoRA on the Dolly 15k dataset</p></li><li><p>Created persistent SSH sessions using <code>tmux</code></p></li><li><p>Learnt how to monitor training in real-time using Weights &amp; Biases</p></li><li><p>Persisted outputs and model artifacts to Google Cloud Storage (GCS)</p></li><li><p>Cleaned up all resources to avoid unnecessary charges</p></li></ul><h2 id="background" class="relative group"><span class="heading-text">Background</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#background" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><details class="myst-dropdown rounded-md my-5 shadow dark:shadow-2xl dark:shadow-neutral-900 overflow-hidden bg-gray-50 dark:bg-stone-800"><summary class="myst-dropdown-header m-0 text-lg font-medium py-1 min-h-[2em] pl-3 cursor-pointer hover:shadow-[inset_0_0_0px_30px_#00000003] dark:hover:shadow-[inset_0_0_0px_30px_#FFFFFF03] bg-gray-100 dark:bg-slate-900"><span class="myst-dropdown-header-title text-neutral-900 dark:text-white"><span class="block float-right text-sm font-thin text-neutral-700 dark:text-neutral-200"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-dropdown-header-icon inline-block pl-2 mr-2 -translate-y-[1px] details-toggle transition-transform"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></span>Click here for more background information about this hands-on session.</span></summary><div class="myst-dropdown-body px-4 py-1 details-body"><h3 id="why-this-experiment" class="relative group"><span class="heading-text">Why This Experiment?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#why-this-experiment" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Fine-tuning takes an already capable model and adapts it to a specific task at a fraction of the cost of training from scratch, which is how most real-world LLM applications are built.</p></li><li><p>We use Gemma 3 1B because fine-tuning a model at this scale of one billion parameters introduces you to the practical realities of running large model training on cloud infrastructure, including GPU memory constraints, checkpoint management, and experiment tracking.</p></li><li><p>At 1B parameters, Gemma is large enough to produce meaningful, coherent responses and representative of the models used in real applications, but small enough to fine-tune on a single L4 GPU in under 30 minutes, making it a practical starting point.</p></li></ul><h3 id="why-lora" class="relative group"><span class="heading-text">Why LoRA?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#why-lora" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Even at 1 Billion parameters, fully fine-tuning Gemma 1B would require updating every weight in the model on every training step, which is memory-intensive and slow on a single GPU.</p></li><li><p>LoRA solves this by freezing the original model weights and injecting small trainable matrices into specific layers, training less than the full parameters while still achieving meaningful adaptation.</p></li><li><p>The key hyperparameter is the rank (<code>r</code>), which controls the size of these trainable matrices. A higher rank means more expressive power but more memory and compute.</p></li></ul><h3 id="why-dolly-15k" class="relative group"><span class="heading-text">Why Dolly-15k?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#why-dolly-15k" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Dolly-15k is an open-source instruction-following dataset created by Databricks, containing 15,000 human-generated prompt-response pairs.</p></li><li><p>It covers a wide range of tasks including question answering, summarization, classification, and creative writing.</p></li><li><p>We use it because it is freely available, well-structured, and a standard dataset for instruction fine-tuning, making results easy to compare and reproduce.</p></li></ul><h3 id="why-tmux" class="relative group"><span class="heading-text">Why <code>tmux</code>?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#why-tmux" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Training a 1 Billion parameter model takes time. Keeping an SSH connection open for the entire duration is fragile and impractical.</p></li><li><p>If your SSH session disconnects, any process running in that terminal is killed, meaning your training run is lost and you have to start over.</p></li><li><p><code>tmux</code> keeps your training process running on the VM independently of your SSH connection, so a dropped connection does not affect the job.</p></li><li><p>It also means you can disconnect intentionally, close your laptop, and reconnect later to check progress without interrupting anything.</p></li></ul><h3 id="why-weights-biases" class="relative group"><span class="heading-text">Why Weights &amp; Biases?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#why-weights-biases" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><ul><li><p>Training runs on a remote VM, so you need a way to monitor progress without staying connected via SSH.</p></li><li><p>WandB logs metrics like loss, learning rate, and gradient norms in real time and makes them accessible from any browser, meaning you can close your laptop and check the dashboard later.</p></li><li><p>It also keeps a history of every run, making it easy to compare experiments and share results with others.</p></li></ul></div></details><h2 id="step-1-create-the-vm" class="relative group"><span class="heading-text">Step 1: Create the VM</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-1-create-the-vm" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Create a new shell script file called <code>create_vm.sh</code> and copy the script below into it. Before running the script, update the <code>AIMSUSERNAME</code> variable at the top to your username:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">nano create_vm.sh</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Paste the following script:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">#!/bin/bash

export AIMSUSERNAME=&quot;&lt;your_aims_username&gt;&quot; # Change this to your own username
export REGION=&quot;europe-west4&quot;
export ZONE=&quot;europe-west4-a&quot;

# Create VPC if it doesn&#x27;t exist
if ! gcloud compute networks describe ${AIMSUSERNAME}-vpc &amp;&gt;/dev/null; then
    gcloud compute networks create ${AIMSUSERNAME}-vpc --subnet-mode=auto
else
    echo &quot;VPC ${AIMSUSERNAME}-vpc already exists, skipping.&quot;
fi

# Create firewall rule if it doesn&#x27;t exist
if ! gcloud compute firewall-rules describe ${AIMSUSERNAME}-fw-ssh &amp;&gt;/dev/null; then
    gcloud compute firewall-rules create ${AIMSUSERNAME}-fw-ssh \
        --network=${AIMSUSERNAME}-vpc \
        --allow=tcp:22
else
    echo &quot;Firewall rule ${AIMSUSERNAME}-fw-ssh already exists, skipping.&quot;
fi

# Create Cloud Router if it doesn&#x27;t exist
if ! gcloud compute routers describe ${AIMSUSERNAME}-router-${REGION} --region=${REGION} &amp;&gt;/dev/null; then
    gcloud compute routers create ${AIMSUSERNAME}-router-${REGION} \
        --network=${AIMSUSERNAME}-vpc \
        --region=${REGION}
else
    echo &quot;Router ${AIMSUSERNAME}-router-${REGION} already exists, skipping.&quot;
fi

# Create NAT if it doesn&#x27;t exist
if ! gcloud compute routers nats describe ${AIMSUSERNAME}-nat-config \
    --router=${AIMSUSERNAME}-router-${REGION} \
    --region=${REGION} &amp;&gt;/dev/null; then
    gcloud compute routers nats create ${AIMSUSERNAME}-nat-config \
        --router-region=${REGION} \
        --router=${AIMSUSERNAME}-router-${REGION} \
        --nat-all-subnet-ip-ranges \
        --auto-allocate-nat-external-ips
else
    echo &quot;NAT ${AIMSUSERNAME}-nat-config already exists, skipping.&quot;
fi

export VM_NAME=&quot;${AIMSUSERNAME}-l4-vm&quot;

gcloud compute instances create ${VM_NAME} \
    --zone=${ZONE} \
    --machine-type=g2-standard-4 \
    --accelerator=&quot;type=nvidia-l4,count=1&quot; \
    --image-family=common-cu128-ubuntu-2204-nvidia-570 \
    --image-project=deeplearning-platform-release \
    --maintenance-policy=TERMINATE \
    --network=${AIMSUSERNAME}-vpc \
    --scopes=storage-full,cloud-platform</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Then save and run the script:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">chmod +x create_vm.sh
./create_vm.sh</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>The script creates all necessary networking infrastructure (VPC, firewall, router, NAT) and provisions a VM with an NVIDIA L4 GPU.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>Notice the <code>--scopes=storage-full,cloud-platform</code> flag in the <code>gcloud compute instances create</code> command for creating the VM. This gives the VM permission to read from and write to GCS, which we will need later when uploading the dataset and syncing experiment outputs and model artifacts.</p></div></aside><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>If you see an error like <code>The zone does not have enough resources available</code>, the NVIDIA L4 GPU is out of stock in that zone. Try changing <code>ZONE</code> in the script to a nearby zone like europe-west4-b or europe-west4-c or changing the region <code>REGION</code> in the script to another region e.g. <code>us-central1</code>.</p></div></aside><p>Then verify the VM is running:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">gcloud compute instances list</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="step-2-ssh-into-the-vm" class="relative group"><span class="heading-text">Step 2: SSH into the VM</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-2-ssh-into-the-vm" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">gcloud compute ssh &lt;YOUR_AIMS_USERNAME&gt;-l4-vm --zone=europe-west4-a --tunnel-through-iap</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Replace <code>&lt;YOUR_AIMS_USERNAME&gt;</code> and the <code>--zone</code> flag with the values you used when running the script.</p><p>When you have successfully “SSH-ed” into your server, verify the GPU is available.</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">nvidia-smi</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>You should see the NVIDIA L4 with 24GB VRAM listed. All subsequent commands are run inside this SSH session.</p><h2 id="step-3-install-uv" class="relative group"><span class="heading-text">Step 3: Install <code>uv</code></span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-3-install-uv" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p><code>uv</code> is a fast Python package and project manager that handles creating virtual environments, installing dependencies, and locking package versions. We use it because it guarantees the exact same environment can be recreated on any machine with a single command.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>The VM image we provisioned already comes with Python pre-installed, so we do not need to set up Python manually. <code>uv</code> will use the existing Python installation and manage everything else for us.</p></div></aside><p><strong>Install <code>uv</code>:</strong></p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">curl -LsSf https://astral.sh/uv/install.sh | sh
source $HOME/.local/bin/env</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p><strong>Verify <code>uv</code> installation:</strong></p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">uv --version</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="step-4-clone-the-github-repository" class="relative group"><span class="heading-text">Step 4: Clone the GitHub Repository</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-4-clone-the-github-repository" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Clone the GitHub repository containing the <a target="_blank" rel="noreferrer" href="https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git" class="link whitespace-nowrap"><span class="link-text whitespace-normal">code</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> for this hands-on session into your VM:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">git clone https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git
cd finetuning-gemma-1b-aims-gcp-tutorial</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="step-5-set-up-the-python-environment" class="relative group"><span class="heading-text">Step 5: Set Up the Python Environment</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-5-set-up-the-python-environment" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>To setup the Python virtual environment using <code>uv</code>:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">uv venv --python 3.12
uv sync</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p><code>uv sync</code> reads the <code>uv.lock</code> file and installs all dependencies at the exact versions used during development, ensuring the environment on the VM is identical to what was used locally.</p><h2 id="step-6-configure-environment-variables" class="relative group"><span class="heading-text">Step 6: Configure Environment Variables</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-6-configure-environment-variables" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>You need two API keys before running anything in this hands-on session: a <strong>HuggingFace API token</strong> to access the Gemma model and a <strong>Weights &amp; Biases API key</strong> to access the WandB platform for experiment tracking.</p><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Getting your WandB API key:</div></div><div class="myst-admonition-body px-4 py-1"><ol start="1"><li><p>Go to <a target="_blank" rel="noreferrer" href="http://wandb.ai" class="link whitespace-nowrap"><span class="link-text whitespace-normal">wandb.ai</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> and create a free account if you don’t have one</p></li><li><p>Once logged in, click Create a new project and give it a name, for example <code>gemma-finetuning-gcp</code>. This is where all your training runs and metrics will be logged.</p></li><li><p>Navigate to <a target="_blank" rel="noreferrer" href="http://wandb.ai/authorize" class="link whitespace-nowrap"><span class="link-text whitespace-normal">wandb.ai/authorize</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p></li><li><p>Copy your API key</p></li></ol></div></aside><figure id="rpMP4kfjzj" class="fig-figure"><img id="NTUuwIga1n" style="margin-left:auto;margin-right:auto" src="/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png" alt="Create new project in WandB" data-canonical-url="./images/create_new_project_wandb.png" class=""/><figcaption class="group"><p>Screenshot of “Create a new project” step in WandB</p></figcaption></figure><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Getting your HuggingFace token</div></div><div class="myst-admonition-body px-4 py-1"><ol start="1"><li><p>Go to <a target="_blank" rel="noreferrer" href="https://huggingface.co" class="link whitespace-nowrap"><span class="link-text whitespace-normal">huggingface.co</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> and create a free account if you don’t have one</p></li><li><p>Navigate to <a target="_blank" rel="noreferrer" href="https://huggingface.co/settings/tokens" class="link whitespace-nowrap"><span class="link-text whitespace-normal">huggingface<wbr/>.co<wbr/>/settings<wbr/>/tokens</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p></li><li><p>Create a new token with read permissions and copy it</p></li></ol></div></aside><aside class="myst-admonition myst-admonition-warning my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-amber-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-amber-600 bg-amber-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-amber-600"><path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Warning</div></div><div class="myst-admonition-body px-4 py-1"><p>Gemma 3 is a gated model on HuggingFace. Before your token will work, you must visit <a target="_blank" rel="noreferrer" href="http://huggingface.co/google/gemma-3-1b-it" class="link whitespace-nowrap"><span class="link-text whitespace-normal">huggingface<wbr/>.co<wbr/>/google<wbr/>/gemma<wbr/>-3<wbr/>-1b<wbr/>-it</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a> and accept the license agreement. Without this step, the training script will fail with a 401 error.</p></div></aside><figure id="LWbhV0AENt" class="fig-figure"><img id="znQC2BLZBf" style="margin-left:auto;margin-right:auto" src="/gcp-tutorial-aims/build/huggingface_gemma3_1-8b857569b87d65d649ed3af687158832.png" alt="Accept Gemma 3 1B License Agreement on HuggingFace" data-canonical-url="./images/huggingface_gemma3_1b_license_agreement.png" class=""/><figcaption class="group"><p>Screenshot of “Accept Gemma 3 1B License Agreement on HuggingFace” step</p></figcaption></figure><p>Now copy the example env file <code>.env.example</code> to create your <code>.env</code> file and fill in your credentials:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">cp .env.example .env
nano .env</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Fill in your values:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">HF_TOKEN=your_huggingface_token
WANDB_API_KEY=your_wandb_api_key
WANDB_PROJECT=your_wandb_project_name</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>To exit the <code>nano</code> editor: press <code>Ctrl+O</code> then <code>Enter</code> to save, then <code>Ctrl+X</code></p><aside class="myst-admonition myst-admonition-important my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path fill-rule="evenodd" d="M14.615 1.595a.75.75 0 0 1 .359.852L12.982 9.75h7.268a.75.75 0 0 1 .548 1.262l-10.5 11.25a.75.75 0 0 1-1.272-.71l1.992-7.302H3.75a.75.75 0 0 1-.548-1.262l10.5-11.25a.75.75 0 0 1 .913-.143Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Before moving on, please confirm the following:</div></div><div class="myst-admonition-body px-4 py-1"><ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"/><p>Created a WandB account and a new project</p></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"/><p>Copied your WandB API key from <a target="_blank" rel="noreferrer" href="http://wandb.ai/authorize" class="link whitespace-nowrap"><span class="link-text whitespace-normal">wandb.ai/authorize</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"/><p>Created a HuggingFace account and generated a read token</p></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"/><p>Accepted the Gemma 3 license agreement at <a target="_blank" rel="noreferrer" href="http://huggingface.co/google/gemma-3-1b-it" class="link whitespace-nowrap"><span class="link-text whitespace-normal">huggingface<wbr/>.co<wbr/>/google<wbr/>/gemma<wbr/>-3<wbr/>-1b<wbr/>-it</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></p></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox"/><p>Filled in <code>.env</code> file with your <code>HF_TOKEN</code>, <code>WANDB_API_KEY</code>, and <code>WANDB_PROJECT</code></p></li></ul></div></aside><h2 id="step-7-upload-the-dataset-to-google-cloud-storage-gcs-bucket-optional" class="relative group"><span class="heading-text">Step 7: Upload the Dataset to Google Cloud Storage (GCS) Bucket (Optional)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-7-upload-the-dataset-to-google-cloud-storage-gcs-bucket-optional" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Rather than downloading the dataset from HuggingFace every time you run an experiment, we upload it once to GCS (GCP’s scalable cloud object storage service) and read from there in all subsequent runs. This is faster, avoids rate limits, and means your experiment does not depend on an external service being available. On real projects with large datasets, this pattern becomes essential.</p><p><strong>Run the upload script:</strong></p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">uv run bash scripts/download_and_upload_gcs.sh

# You can optionally pass a custom bucket name:
uv run bash scripts/download_and_upload_gcs.sh &lt;BUCKET_NAME&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>This script downloads the Dolly-15k dataset from HuggingFace, creates a new GCS bucket, and uploads the downloaded dataset to the GCS bucket.</p><figure id="ffn6ch9QrQ" class="fig-figure"><img id="FYJKSc3TG0" style="margin-left:auto;margin-right:auto" src="/gcp-tutorial-aims/build/upload_dataset_to_gc-2c54cc9b748935ed7e9a594d73485fab.png" alt="Upload Dataset to GCS Instruction" data-canonical-url="./images/upload_dataset_to_gcs_bucket.png" class=""/><figcaption class="group"><p>Screenshot of “Upload Dataset to GCS Bucket” step</p></figcaption></figure><p><strong>Verify the data is in the GCS bucket:</strong></p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">gcloud storage ls gs://&lt;BUCKET_NAME&gt;/data/raw/</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="step-8-start-a-tmux-session" class="relative group"><span class="heading-text">Step 8: Start a <code>tmux</code> Session</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-8-start-a-tmux-session" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Training this 1 Billion parameter model using LoRA takes about 25-40 minutes. Rather than keeping your SSH connection open the entire time, we use <code>tmux</code> to run training in a persistent terminal session. This means if your SSH connection closes, training keeps running on the VM.</p><p><strong>Install <code>tmux</code> and start a new session:</strong></p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">sudo apt-get install -y tmux 
tmux new -s finetunegemma1b</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>This creates a new session named “finetunegemma1b”. You should now be inside the created <code>tmux</code> session.</p><p><strong>To detach the session without killing it:</strong></p><ul><li><p>Press <code>Ctrl+B</code> then the <code>D</code> key</p></li></ul><p>Alternatively, you can run the command from another shell for this server:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">tmux detach -s &lt;session_name&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p><strong>To return to a detached session layer:</strong></p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">tmux attach -t &lt;session_name&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="step-9-run-the-training-script" class="relative group"><span class="heading-text">Step 9: Run the Training Script</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-9-run-the-training-script" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In the <code>tmux</code> session shell, run the script below to start finetuning the model:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">uv run python -m scripts.run_train \
    data.source=hf \
    data.max_train_samples=10000 \
    training.num_epochs=2 \
    training.batch_size=8 \
    experiment_id=exp_lora_r8</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>This trains on 10,000 samples for 2 epochs with LoRA rank 8, giving us <code>10,000 / 8 = 1,250 steps per epoch</code> and <code>2,500 steps total</code>. On the NVIDIA L4 GPU, this should take roughly <strong>20-30 minutes</strong>.</p><p>You can now detach from the tmux session and monitor training progress from your WandB dashboard at <a target="_blank" rel="noreferrer" href="http://wandb.ai" class="link whitespace-nowrap"><span class="link-text whitespace-normal">wandb.ai</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="link-icon"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a>. You will see <code>train/loss</code>, <code>eval/loss</code>, <code>train/grad_norm</code>, and <code>train/learning_rate</code> updating every 10 steps.</p><figure id="MHkM0cTJfH" class="fig-figure"><img id="FVCarTiLPW" style="margin-left:auto;margin-right:auto" src="/gcp-tutorial-aims/build/wandb_train_run_moni-259c48ec2f8183d058e82c3570c5f170.png" alt="Monitor Training Progress on WandB Dashboard" data-canonical-url="./images/wandb_train_run_monitoring.png" class=""/><figcaption class="group"><p>Screenshot of WandB dashboard for monitoring training progress and metrics</p></figcaption></figure><h2 id="step-10-run-evaluation" class="relative group"><span class="heading-text">Step 10: Run Evaluation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-10-run-evaluation" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Once training finishes, reattach to the tmux session if you detached:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">tmux attach -t &lt;session_name&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Run the evaluation script. Replace <code>&lt;experiment_id&gt;</code> and <code>&lt;checkpoint_folder&gt;</code> with the actual paths from your <code>outputs/</code> directory:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">uv run python -m scripts.run_evaluate \
    --model_path outputs/&lt;experiment_id&gt;/&lt;checkpoint_folder&gt; \
    --eval_file data/eval/eval_prompts.jsonl</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>This computes perplexity and repetition rate on the evaluation set and logs the results to WandB.</p><figure id="II6mG4t5P8" class="fig-figure"><img id="Wfrqh8P31x" style="margin-left:auto;margin-right:auto" src="/gcp-tutorial-aims/build/wandb-gemma-finetune-6412f089e8ea9bb9f47fe13b52dd31ea.png" alt="Monitor Evaluation Results on WandB Dashboard" data-canonical-url="./images/wandb-gemma-finetune-evaluation-dashboard.png" class=""/><figcaption class="group"><p>Screenshot of WandB dashboard for monitoring evaluation results</p></figcaption></figure><aside class="myst-admonition myst-admonition-note my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-blue-500"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-blue-600 bg-blue-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-blue-600"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Note</div></div><div class="myst-admonition-body px-4 py-1"><p>Do not worry too much about the evaluation results. The goal of this tutorial is not to produce a state-of-the-art model but to walk through the complete workflow of fine-tuning a large language model on a GCP VM end to end.</p></div></aside><h2 id="step-11-run-inference-optional" class="relative group"><span class="heading-text">Step 11: Run Inference (Optional)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-11-run-inference-optional" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Test the model on a single instruction</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">uv run python -m scripts.run_inference \
    --model_path outputs/&lt;experiment_id&gt;/&lt;checkpoint_folder&gt; \
    --instruction &quot;Explain what machine learning is in simple terms&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>You can also run in interactive mode to keep sending instructions:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">uv run python -m scripts.run_inference \
    --model_path outputs/&lt;experiment_id&gt;/&lt;checkpoint_folder&gt;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><figure id="y79W7GPQ6Y" class="fig-figure"><img id="OiA8twqP3r" style="margin-left:auto;margin-right:auto" src="/gcp-tutorial-aims/build/finetune_gemma_exper-32dccd9973c0649c9c44e9ed9d5e5b0e.png" alt="Fine-tuned Gemma 3 1B Inference Result" data-canonical-url="./images/finetune_gemma_experiment_inference_result.png" class=""/><figcaption class="group"><p>Screenshot of inference result using the fine-tuned Gemma 3 1B model</p></figcaption></figure><h2 id="step-12-sync-outputs-to-gcs" class="relative group"><span class="heading-text">Step 12: Sync Outputs to GCS</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-12-sync-outputs-to-gcs" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Before deleting the VM, sync your checkpoints and logs to your GCS bucket so they persist:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">gcloud storage cp -r outputs/ gs://&lt;BUCKET_NAME&gt;/outputs/</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Verify the GCS bucket content from the GCS dashboard or from the CLI:</p><figure id="VpfQjVBjmq" class="fig-figure"><img id="saCDdExfSu" style="margin-left:auto;margin-right:auto" src="/gcp-tutorial-aims/build/gcp-console-gemma-fi-e31c4e2ed71cd0c9d64d61ebf9e797d8.png" alt="GCS Bucket on GCP Console" data-canonical-url="./images/gcp-console-gemma-finetune-experiment-bucket.png" class=""/><figcaption class="group"><p>Screenshot of GCS bucket on the GCP console showing the “data” and synced “outputs” folder.</p></figcaption></figure><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">gcloud storage ls gs://&lt;BUCKET_NAME&gt;/outputs/</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p>Exit the tmux session:</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-text" style="white-space:pre">exit</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><h2 id="step-13-resource-cleanup" class="relative group"><span class="heading-text">Step 13: Resource Cleanup</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#step-13-resource-cleanup" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><aside class="myst-admonition myst-admonition-danger my-5 shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-gray-50/10 dark:bg-stone-800 overflow-hidden myst-admonition-default rounded border-l-4 border-red-600"><div class="myst-admonition-header m-0 font-medium py-1 flex min-w-0 text-lg text-red-600 bg-red-50 dark:bg-slate-900"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="2rem" height="2rem" class="myst-admonition-header-icon inline-block pl-2 mr-2 self-center flex-none text-red-600"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path></svg><div class="myst-admonition-header-text text-neutral-900 dark:text-white grow self-center overflow-hidden break-words">Danger</div></div><div class="myst-admonition-body px-4 py-1"><p>Delete the VM when you are done to avoid incurring charges. GPU VMs are billed by the second and the NVIDIA L4 GPU VM using the <code>g2-standard-4</code> machine configuration costs roughly $0.70/hour even when idle.</p></div></aside><p>Run the script below and replace <code>&lt;YOUR_AIMSUSERNAME&gt;</code> and <code>&lt;ZONE&gt;</code> with the values you used in the VM creation script.</p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">gcloud compute instances delete &lt;YOUR_AIMSUSERNAME&gt;-l4-vm --zone=&lt;ZONE&gt; --quiet</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><p><strong>Verify it has been deleted:</strong></p><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 bg-stone-200/10"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-bash" style="white-space:pre">gcloud compute instances list</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><hr class="py-2 my-5 translate-y-2"/><h2 id="id-key-takeways" class="relative group"><span class="heading-text">🔑 Key Takeways</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-key-takeways" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><ul><li><p>Using a package manager like <code>uv</code> ensures your Python environment is reproducible across any machine. A single <code>uv sync</code> installs all dependencies at the exact versions pinned in the lock file, eliminating environment mismatch issues.</p></li><li><p>Uploading your dataset to GCS once and reading from there on every run is more reliable and faster than downloading from external sources each time.</p></li><li><p><code>tmux</code> is essential for long-running jobs on remote VMs. It keeps your process alive even if your SSH connection is destroyed.</p></li><li><p>WandB gives you full visibility into training progress and metrics from any browser, without needing to stay connected to the VM.</p></li><li><p>Always sync outputs to GCS before deleting your VM. VM disks are ephemeral and deleted with the instance.</p></li><li><p>Always delete your VM after a session to avoid unexpected charges.</p></li></ul><h2 id="id-whats-next" class="relative group"><span class="heading-text">🚀 What’s Next?</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-whats-next" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In the next session, we will look at <strong>Vertex AI</strong>, Google Cloud’s fully managed ML platform and how it can simplify running experiments like this without provisioning or managing any infrastructure yourself.</p><div class="myst-backmatter-parts"></div><div class="myst-footer-links flex pt-10 mb-10 space-x-4"><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-prev" href="/gcp-tutorial-aims/part2-running-experiments-on-gcp-vms"><div class="flex h-full align-middle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:-translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path></svg><div class="flex-grow text-right"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Part 2 - Running Experiments On GCP VMs</div>Introduction</div></div></a><a class="myst-footer-link flex-1 block p-4 font-normal text-gray-600 no-underline border border-gray-200 rounded shadow-sm group hover:border-blue-600 dark:hover:border-blue-400 hover:text-blue-600 dark:hover:text-blue-400 dark:text-gray-100 dark:border-gray-500 hover:shadow-lg dark:shadow-neutral-700 myst-footer-link-next" href="/gcp-tutorial-aims/part3-vertex-ai"><div class="flex h-full align-middle"><div class="flex-grow"><div class="myst-footer-link-group text-xs text-gray-500 dark:text-gray-400">Part 3 - Vertex AI</div>Introduction</div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem" class="myst-footer-link-icon self-center transition-transform group-hover:translate-x-1 shrink-0"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path></svg></div></a></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/gcp-tutorial-aims/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-G62B6HZR.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/root-PMP5BIHC.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/_shared/chunk-IX5KPAHP.js"/><link rel="modulepreload" href="/gcp-tutorial-aims/build/routes/$-5ZLZ2O3Y.js"/><script>window.__remixContext = {"url":"/part2-running-experiments-on-gcp-vms/hands-on-running-ai-experiments-on-gcp-vms","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.8.1","title":"AIMS GCP ML Tutorial","options":{"favicon":"/gcp-tutorial-aims/build/favicon-f7b3896533bc18e7649da390cf29f0f4.ico","logo_text":"AIMS GCP ML Tutorial","folders":true},"nav":[],"actions":[],"projects":[{"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"title":"AIMS GCP Tutorial","description":"A no-fluff guide to using GCP for ML experiments and research","authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"id":"7eddb7b1-9986-44d1-8417-fe2b2bb4b498","toc":[{"file":"index.md"},{"children":[{"file":"part1-gcp-foundations/index.md"},{"file":"part1-gcp-foundations/01-understanding-gcp.md"},{"file":"part1-gcp-foundations/02-gcp-console.md"},{"file":"part1-gcp-foundations/03-the-gcloud-cli.md"},{"file":"part1-gcp-foundations/04-hands-on-gcp-console.md"},{"file":"part1-gcp-foundations/05-hands-on-gcloud-cli.md"}],"title":"Part 1 - GCP Foundations"},{"children":[{"file":"part2-running-experiments-on-gcp-vms/index.md"},{"file":"part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md"}],"title":"Part 2 - Running Experiments On GCP VMs"},{"children":[{"file":"part3-vertex-ai/index.md"},{"file":"part3-vertex-ai/01-hands-on-vertex-ai-custom-training-job.md"},{"file":"part3-vertex-ai/02-hands-on-vertex-ai-notebook-colab-enterprise.md"}],"title":"Part 3 - Vertex AI"},{"children":[{"file":"part4-cost-management/index.md"},{"file":"part4-cost-management/01-hands-on-cost-management.md"}],"title":"Part 4 - Cost Management"},{"children":[{"file":"appendix/01-gpu-maths.md"},{"file":"append"}],"title":"Appendix"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Part 1 - GCP Foundations"},{"slug":"part1-gcp-foundations.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.understanding-gcp","title":"GCP Core Concepts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.gcp-console","title":"The GCP Console","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-overview-8e8b446f04fb688222b85418bedb2a82.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.the-gcloud-cli","title":"The Google Cloud CLI (gcloud)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.hands-on-gcp-console","title":"Hands-On 01: Create a VM via GCP Console","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/hands-on1-gcp-consol-12a3399ac5b13c81fe8057ccb402f849.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.hands-on-gcloud-cli","title":"Hands-On 02: Automation with the Google Cloud CLI (gcloud)","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/hands-on2-gcloud-vm--ec1294417a0584c93f49d7ef18dde2b3.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 2 - Running Experiments On GCP VMs"},{"slug":"part2-running-experiments-on-gcp-vms.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part2-running-experiments-on-gcp-vms.hands-on-running-ai-experiments-on-gcp-vms","title":"Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 3 - Vertex AI"},{"slug":"part3-vertex-ai.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part3-vertex-ai.hands-on-vertex-ai-custom-training-job","title":"Hands-On 01: Vertex AI Custom Training Jobs","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcloud-submit-vertex-fa224a3096b38995888e8f1bd1200cdb.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part3-vertex-ai.hands-on-vertex-ai-notebook-colab-enterprise","title":"Hands-On 02: Vertex AI Notebooks (Colab Enterprise)","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-colab-en-9c467a94a29b3dbd7b55cbe9bc42e12a.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 4 - Cost Management"},{"slug":"part4-cost-management.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part4-cost-management.hands-on-cost-management","title":"Hands-On: Setting Up Billing Alerts and Budgets","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-create-b-10c558aa82b612d79d67b2c5cc90d849.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Appendix"},{"slug":"appendix.gpu-maths","title":"Appendix A: GPU Maths - Choosing the Right GPU for Your Experiment","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/gcp-tutorial-aims"},"routes/$":{"config":{"version":3,"myst":"1.8.1","title":"AIMS GCP ML Tutorial","options":{"favicon":"/gcp-tutorial-aims/build/favicon-f7b3896533bc18e7649da390cf29f0f4.ico","logo_text":"AIMS GCP ML Tutorial","folders":true},"nav":[],"actions":[],"projects":[{"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"title":"AIMS GCP Tutorial","description":"A no-fluff guide to using GCP for ML experiments and research","authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"id":"7eddb7b1-9986-44d1-8417-fe2b2bb4b498","toc":[{"file":"index.md"},{"children":[{"file":"part1-gcp-foundations/index.md"},{"file":"part1-gcp-foundations/01-understanding-gcp.md"},{"file":"part1-gcp-foundations/02-gcp-console.md"},{"file":"part1-gcp-foundations/03-the-gcloud-cli.md"},{"file":"part1-gcp-foundations/04-hands-on-gcp-console.md"},{"file":"part1-gcp-foundations/05-hands-on-gcloud-cli.md"}],"title":"Part 1 - GCP Foundations"},{"children":[{"file":"part2-running-experiments-on-gcp-vms/index.md"},{"file":"part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md"}],"title":"Part 2 - Running Experiments On GCP VMs"},{"children":[{"file":"part3-vertex-ai/index.md"},{"file":"part3-vertex-ai/01-hands-on-vertex-ai-custom-training-job.md"},{"file":"part3-vertex-ai/02-hands-on-vertex-ai-notebook-colab-enterprise.md"}],"title":"Part 3 - Vertex AI"},{"children":[{"file":"part4-cost-management/index.md"},{"file":"part4-cost-management/01-hands-on-cost-management.md"}],"title":"Part 4 - Cost Management"},{"children":[{"file":"appendix/01-gpu-maths.md"},{"file":"append"}],"title":"Appendix"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Part 1 - GCP Foundations"},{"slug":"part1-gcp-foundations.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.understanding-gcp","title":"GCP Core Concepts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.gcp-console","title":"The GCP Console","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-overview-8e8b446f04fb688222b85418bedb2a82.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.the-gcloud-cli","title":"The Google Cloud CLI (gcloud)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.hands-on-gcp-console","title":"Hands-On 01: Create a VM via GCP Console","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/hands-on1-gcp-consol-12a3399ac5b13c81fe8057ccb402f849.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.hands-on-gcloud-cli","title":"Hands-On 02: Automation with the Google Cloud CLI (gcloud)","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/hands-on2-gcloud-vm--ec1294417a0584c93f49d7ef18dde2b3.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 2 - Running Experiments On GCP VMs"},{"slug":"part2-running-experiments-on-gcp-vms.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part2-running-experiments-on-gcp-vms.hands-on-running-ai-experiments-on-gcp-vms","title":"Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 3 - Vertex AI"},{"slug":"part3-vertex-ai.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part3-vertex-ai.hands-on-vertex-ai-custom-training-job","title":"Hands-On 01: Vertex AI Custom Training Jobs","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcloud-submit-vertex-fa224a3096b38995888e8f1bd1200cdb.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part3-vertex-ai.hands-on-vertex-ai-notebook-colab-enterprise","title":"Hands-On 02: Vertex AI Notebooks (Colab Enterprise)","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-colab-en-9c467a94a29b3dbd7b55cbe9bc42e12a.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 4 - Cost Management"},{"slug":"part4-cost-management.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part4-cost-management.hands-on-cost-management","title":"Hands-On: Setting Up Billing Alerts and Budgets","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-create-b-10c558aa82b612d79d67b2c5cc90d849.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Appendix"},{"slug":"appendix.gpu-maths","title":"Appendix A: GPU Maths - Choosing the Right GPU for Your Experiment","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":3,"kind":"Article","sha256":"db9e022703798eb6d0481453799badb9d8ee3004395b845fb31e9b5012091e6d","slug":"part2-running-experiments-on-gcp-vms.hands-on-running-ai-experiments-on-gcp-vms","location":"/part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md","dependencies":[],"frontmatter":{"title":"Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM","content_includes_title":false,"authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/blob/main/part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md","edit_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/edit/main/part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md","thumbnail":"/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png","exports":[{"format":"md","filename":"01-hands-on-running-ai-experiments-on-gcp-vms.md","url":"/gcp-tutorial-aims/build/01-hands-on-running--7c026c668a3216ac6133915aef219553.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this hands-on session, we will fine-tune ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KNIOvxi7RD"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Gemma 3 1B","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"InQHg7embb"}],"key":"kFuSYyk3H6"},{"type":"text","value":" (a small language model with 1 billion parameters) on the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zelCgkzk6w"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Dolly-15k","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zVazHZAqPN"}],"key":"NBYxSYAOpY"},{"type":"text","value":" instruction dataset using ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bbdgcsQbiF"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"LoRA (Low-Rank Adaptation)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yld5Tq1FMC"}],"key":"Sq7bX3IJIO"},{"type":"text","value":", track our experiments with ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"I2Na6jzd3L"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Weights \u0026 Biases","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dADS6lcDLP"}],"key":"cT9MSIEfIp"},{"type":"text","value":", and persist outputs and model artifacts to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R3lvdnHPla"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Google Cloud Storage","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zSzwKaz45w"}],"key":"NpacwFzKfo"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AP6kZOCe0N"}],"key":"cjQwoqenM5"},{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lPKLtE4QtJ"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"tfBBYEdfIt"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"By the end of this hands-on session, you will have:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"N6iVhxElZZ"}],"key":"vJuJ5kkaBs"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Provisioned an L4 GPU VM using the Compute Engine service via ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ttpOVOSooB"},{"type":"inlineCode","value":"gcloud","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"fRmcLzLxWq"},{"type":"text","value":" CLI","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"FCVIcXWKzP"}],"key":"KTXIXllWCJ"}],"key":"Tx8Joo0Muq"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Set up a Python environment using ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"FbEgCpaNv9"},{"type":"inlineCode","value":"uv","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lMjHr3akY7"}],"key":"vphj7nJtDV"}],"key":"t8pFMXedPo"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Cloned the experiment repository from GitHub","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ab2ueoWyCC"}],"key":"TpozyuMnMW"}],"key":"iYdCnsu0cm"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Run the scripts to fine-tune Gemma 3 1B using LoRA on the Dolly 15k dataset","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"BYsBRKlobR"}],"key":"F5Wi9t4aHL"}],"key":"AvoE0pHj7U"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Created persistent SSH sessions using ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"wwN3vqoTRH"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"XIk8Jw2R0I"}],"key":"dAJaJSmxJp"}],"key":"lqHpf4yvty"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Learnt how to monitor training in real-time using Weights \u0026 Biases","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"v03lXQTCRj"}],"key":"qOBrnm9F9O"}],"key":"JuJ5auLbHp"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Persisted outputs and model artifacts to Google Cloud Storage (GCS)","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ZWuH1AXJxJ"}],"key":"ajyZUmrcj9"}],"key":"HWbTcTbbnp"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Cleaned up all resources to avoid unnecessary charges","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"HRYoHHA9WQ"}],"key":"mMpCuVsfPg"}],"key":"dL5XGzbPU7"}],"key":"vHOV5ZU33x"},{"type":"heading","depth":2,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Background","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"CdrI9JyDIm"}],"identifier":"background","label":"Background","html_id":"background","implicit":true,"key":"VxfwdsmHxj"},{"type":"details","children":[{"type":"summary","children":[{"type":"text","value":"Click here for more background information about this hands-on session.","key":"SZ8exwMIP1"}],"key":"eZA0eFaGZt"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why This Experiment?","key":"MB3HdtUvYT"}],"identifier":"why-this-experiment","label":"Why This Experiment?","html_id":"why-this-experiment","implicit":true,"key":"dqTnjxuIHE"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Fine-tuning takes an already capable model and adapts it to a specific task at a fraction of the cost of training from scratch, which is how most real-world LLM applications are built.","key":"fy0M9xp9HW"}],"key":"kHBjikx85c"}],"key":"dSTELZDK7e"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"We use Gemma 3 1B because fine-tuning a model at this scale of one billion parameters introduces you to the practical realities of running large model training on cloud infrastructure, including GPU memory constraints, checkpoint management, and experiment tracking.","key":"F0fwkChVDK"}],"key":"dlYT1mYoow"}],"key":"KRCICHFsBN"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"At 1B parameters, Gemma is large enough to produce meaningful, coherent responses and representative of the models used in real applications, but small enough to fine-tune on a single L4 GPU in under 30 minutes, making it a practical starting point.","key":"eL4g3Utm2L"}],"key":"ogkpPQAaoz"}],"key":"xAIgCcCbWu"}],"key":"iJy5VZcwyb"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why LoRA?","key":"J6shR39v02"}],"identifier":"why-lora","label":"Why LoRA?","html_id":"why-lora","implicit":true,"key":"y3rJjaqNef"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Even at 1 Billion parameters, fully fine-tuning Gemma 1B would require updating every weight in the model on every training step, which is memory-intensive and slow on a single GPU.","key":"ZyCeSjb6CE"}],"key":"yF4uDGF22Z"}],"key":"JjnfxWLAf6"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"LoRA solves this by freezing the original model weights and injecting small trainable matrices into specific layers, training less than the full parameters while still achieving meaningful adaptation.","key":"AmuFcZiTaF"}],"key":"XsmAhHmOoQ"}],"key":"wJAksRtzoP"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The key hyperparameter is the rank (","key":"lRUDqJEInH"},{"type":"inlineCode","value":"r","key":"Kkx3AR2obQ"},{"type":"text","value":"), which controls the size of these trainable matrices. A higher rank means more expressive power but more memory and compute.","key":"OTAFZ7lq8R"}],"key":"rDtHGmxQbp"}],"key":"Dm5UokpejX"}],"key":"Bi42hd8SQI"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why Dolly-15k?","key":"VRP1pUA3Nb"}],"identifier":"why-dolly-15k","label":"Why Dolly-15k?","html_id":"why-dolly-15k","implicit":true,"key":"XV0l71Ojm4"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Dolly-15k is an open-source instruction-following dataset created by Databricks, containing 15,000 human-generated prompt-response pairs.","key":"ETw55PARHo"}],"key":"Qmvq7H8LwR"}],"key":"aCk6BUKB3s"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It covers a wide range of tasks including question answering, summarization, classification, and creative writing.","key":"bckaSePsQV"}],"key":"ZKjjpyHyKV"}],"key":"IjGTGC4AoL"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"We use it because it is freely available, well-structured, and a standard dataset for instruction fine-tuning, making results easy to compare and reproduce.","key":"bi5rN8MIeI"}],"key":"E5zwnCmz0O"}],"key":"fdqaDc19kv"}],"key":"OBc4zMZlKY"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why ","key":"WuHTH0KWA1"},{"type":"inlineCode","value":"tmux","key":"dY5iJPXy7f"},{"type":"text","value":"?","key":"FnKCCnN3cn"}],"identifier":"why-tmux","label":"Why tmux?","html_id":"why-tmux","implicit":true,"key":"SsqzhMvV0N"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Training a 1 Billion parameter model takes time. Keeping an SSH connection open for the entire duration is fragile and impractical.","key":"enKpTFtqai"}],"key":"wHiX1n63up"}],"key":"ek1MVs9MCr"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If your SSH session disconnects, any process running in that terminal is killed, meaning your training run is lost and you have to start over.","key":"QS0ank7QVc"}],"key":"zGIQMXkZjY"}],"key":"CHgx4GYA3t"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"tmux","key":"PxluEnmL6Y"},{"type":"text","value":" keeps your training process running on the VM independently of your SSH connection, so a dropped connection does not affect the job.","key":"IGRS1M0rAy"}],"key":"GebykmQ1Yv"}],"key":"rXqU9Y5NQx"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It also means you can disconnect intentionally, close your laptop, and reconnect later to check progress without interrupting anything.","key":"bBGAZQz4S3"}],"key":"r1ld4DBd5i"}],"key":"egvON6PEmp"}],"key":"WiUFfiC243"},{"type":"heading","depth":3,"children":[{"type":"text","value":"Why Weights \u0026 Biases?","key":"CRz5ytSP3k"}],"identifier":"why-weights-biases","label":"Why Weights \u0026 Biases?","html_id":"why-weights-biases","implicit":true,"key":"VqBPP2GeO2"},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Training runs on a remote VM, so you need a way to monitor progress without staying connected via SSH.","key":"d3t7z6TThA"}],"key":"RjibFC00IB"}],"key":"NYmCokiCKw"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"WandB logs metrics like loss, learning rate, and gradient norms in real time and makes them accessible from any browser, meaning you can close your laptop and check the dashboard later.","key":"Y96hndr2OX"}],"key":"SP7jHmjTxA"}],"key":"POJYiIQswO"},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It also keeps a history of every run, making it easy to compare experiments and share results with others.","key":"riBdGxoxft"}],"key":"nEDKiL3AMW"}],"key":"lbEnEqEd0p"}],"key":"W16OhjbhLu"}],"key":"NmzLYf5ret"},{"type":"heading","depth":2,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Step 1: Create the VM","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"v7htFx83sw"}],"identifier":"step-1-create-the-vm","label":"Step 1: Create the VM","html_id":"step-1-create-the-vm","implicit":true,"key":"ItRFjabfXK"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"Create a new shell script file called ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"u5hO3ryWTO"},{"type":"inlineCode","value":"create_vm.sh","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"gV1rGpCX2k"},{"type":"text","value":" and copy the script below into it. Before running the script, update the ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"QNsUDmtUcG"},{"type":"inlineCode","value":"AIMSUSERNAME","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"djnDKXSFJU"},{"type":"text","value":" variable at the top to your username:","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"leLb1pFdYY"}],"key":"Tk3RZvuTgz"},{"type":"code","lang":"bash","value":"nano create_vm.sh","key":"NzvDr2MSvw"},{"type":"paragraph","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"Paste the following script:","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"l68eQLlpuT"}],"key":"iiwLLXCSXk"},{"type":"code","lang":"bash","value":"#!/bin/bash\n\nexport AIMSUSERNAME=\"\u003cyour_aims_username\u003e\" # Change this to your own username\nexport REGION=\"europe-west4\"\nexport ZONE=\"europe-west4-a\"\n\n# Create VPC if it doesn't exist\nif ! gcloud compute networks describe ${AIMSUSERNAME}-vpc \u0026\u003e/dev/null; then\n    gcloud compute networks create ${AIMSUSERNAME}-vpc --subnet-mode=auto\nelse\n    echo \"VPC ${AIMSUSERNAME}-vpc already exists, skipping.\"\nfi\n\n# Create firewall rule if it doesn't exist\nif ! gcloud compute firewall-rules describe ${AIMSUSERNAME}-fw-ssh \u0026\u003e/dev/null; then\n    gcloud compute firewall-rules create ${AIMSUSERNAME}-fw-ssh \\\n        --network=${AIMSUSERNAME}-vpc \\\n        --allow=tcp:22\nelse\n    echo \"Firewall rule ${AIMSUSERNAME}-fw-ssh already exists, skipping.\"\nfi\n\n# Create Cloud Router if it doesn't exist\nif ! gcloud compute routers describe ${AIMSUSERNAME}-router-${REGION} --region=${REGION} \u0026\u003e/dev/null; then\n    gcloud compute routers create ${AIMSUSERNAME}-router-${REGION} \\\n        --network=${AIMSUSERNAME}-vpc \\\n        --region=${REGION}\nelse\n    echo \"Router ${AIMSUSERNAME}-router-${REGION} already exists, skipping.\"\nfi\n\n# Create NAT if it doesn't exist\nif ! gcloud compute routers nats describe ${AIMSUSERNAME}-nat-config \\\n    --router=${AIMSUSERNAME}-router-${REGION} \\\n    --region=${REGION} \u0026\u003e/dev/null; then\n    gcloud compute routers nats create ${AIMSUSERNAME}-nat-config \\\n        --router-region=${REGION} \\\n        --router=${AIMSUSERNAME}-router-${REGION} \\\n        --nat-all-subnet-ip-ranges \\\n        --auto-allocate-nat-external-ips\nelse\n    echo \"NAT ${AIMSUSERNAME}-nat-config already exists, skipping.\"\nfi\n\nexport VM_NAME=\"${AIMSUSERNAME}-l4-vm\"\n\ngcloud compute instances create ${VM_NAME} \\\n    --zone=${ZONE} \\\n    --machine-type=g2-standard-4 \\\n    --accelerator=\"type=nvidia-l4,count=1\" \\\n    --image-family=common-cu128-ubuntu-2204-nvidia-570 \\\n    --image-project=deeplearning-platform-release \\\n    --maintenance-policy=TERMINATE \\\n    --network=${AIMSUSERNAME}-vpc \\\n    --scopes=storage-full,cloud-platform","key":"ka80hxHB9H"},{"type":"paragraph","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"children":[{"type":"text","value":"Then save and run the script:","position":{"start":{"line":123,"column":1},"end":{"line":123,"column":1}},"key":"W6UCDsQIDg"}],"key":"BFNpal8OYG"},{"type":"code","lang":"bash","value":"chmod +x create_vm.sh\n./create_vm.sh","key":"QHOjLF8nPn"},{"type":"paragraph","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"children":[{"type":"text","value":"The script creates all necessary networking infrastructure (VPC, firewall, router, NAT) and provisions a VM with an NVIDIA L4 GPU.","position":{"start":{"line":130,"column":1},"end":{"line":130,"column":1}},"key":"B6hHucPbQZ"}],"key":"QnFQ8J25nc"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"JwmQVBf1yG"}],"key":"thDSlcLkUK"},{"type":"paragraph","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"children":[{"type":"text","value":"Notice the ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"zEnKUX81RK"},{"type":"inlineCode","value":"--scopes=storage-full,cloud-platform","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"D4OLAW6gk1"},{"type":"text","value":" flag in the ","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"CjLaNFQyHD"},{"type":"inlineCode","value":"gcloud compute instances create","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"osfvaseTVi"},{"type":"text","value":" command for creating the VM. This gives the VM permission to read from and write to GCS, which we will need later when uploading the dataset and syncing experiment outputs and model artifacts.","position":{"start":{"line":133,"column":1},"end":{"line":133,"column":1}},"key":"OY3h6jccBS"}],"key":"qTNGb3rSwd"}],"key":"GLJAfUV85P"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"YVplgDHTjq"}],"key":"fRUXL0gD2b"},{"type":"paragraph","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"children":[{"type":"text","value":"If you see an error like ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"bT19PITsv8"},{"type":"inlineCode","value":"The zone does not have enough resources available","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"j5k4UV4L86"},{"type":"text","value":", the NVIDIA L4 GPU is out of stock in that zone. Try changing ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"wn49XHZmSW"},{"type":"inlineCode","value":"ZONE","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"XMcEnCMm4t"},{"type":"text","value":" in the script to a nearby zone like europe-west4-b or europe-west4-c or changing the region ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"r7avakRUgr"},{"type":"inlineCode","value":"REGION","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"qs008XJ1eN"},{"type":"text","value":" in the script to another region e.g. ","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"Oq5ypVG45g"},{"type":"inlineCode","value":"us-central1","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"ZX85H8jrPQ"},{"type":"text","value":".","position":{"start":{"line":137,"column":1},"end":{"line":137,"column":1}},"key":"f67fffkHnS"}],"key":"n9CwRbanhe"}],"key":"gCe7ork6cu"},{"type":"paragraph","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"children":[{"type":"text","value":"Then verify the VM is running:","position":{"start":{"line":140,"column":1},"end":{"line":140,"column":1}},"key":"AOXH0bNzH5"}],"key":"NPx9SZPJhI"},{"type":"code","lang":"bash","value":"gcloud compute instances list","key":"z1z1LfRsVr"},{"type":"heading","depth":2,"position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"children":[{"type":"text","value":"Step 2: SSH into the VM","position":{"start":{"line":146,"column":1},"end":{"line":146,"column":1}},"key":"vR8xTDiGUf"}],"identifier":"step-2-ssh-into-the-vm","label":"Step 2: SSH into the VM","html_id":"step-2-ssh-into-the-vm","implicit":true,"key":"HJwpZRhAUt"},{"type":"code","lang":"bash","value":"gcloud compute ssh \u003cYOUR_AIMS_USERNAME\u003e-l4-vm --zone=europe-west4-a --tunnel-through-iap","key":"Jh8Ll4guXs"},{"type":"paragraph","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"Replace ","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"z6tgJ4QAqE"},{"type":"inlineCode","value":"\u003cYOUR_AIMS_USERNAME\u003e","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"PikWjLGowW"},{"type":"text","value":" and the ","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"ERfivhjhdR"},{"type":"inlineCode","value":"--zone","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"B1UPxX4qHM"},{"type":"text","value":" flag with the values you used when running the script.","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"pFCN97wVB9"}],"key":"EgINKQoPRp"},{"type":"paragraph","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"When you have successfully “SSH-ed” into your server, verify the GPU is available.","position":{"start":{"line":154,"column":1},"end":{"line":154,"column":1}},"key":"ijTP3d2Lyf"}],"key":"bdg0nqt6qy"},{"type":"code","lang":"bash","value":"nvidia-smi","key":"Y0cDqfUP0e"},{"type":"paragraph","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"children":[{"type":"text","value":"You should see the NVIDIA L4 with 24GB VRAM listed. All subsequent commands are run inside this SSH session.","position":{"start":{"line":160,"column":1},"end":{"line":160,"column":1}},"key":"xEtxKGrtkt"}],"key":"AAKOd8eb0A"},{"type":"heading","depth":2,"position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"children":[{"type":"text","value":"Step 3: Install ","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"eG6pvxg4uU"},{"type":"inlineCode","value":"uv","position":{"start":{"line":162,"column":1},"end":{"line":162,"column":1}},"key":"AEtWDyJs58"}],"identifier":"step-3-install-uv","label":"Step 3: Install uv","html_id":"step-3-install-uv","implicit":true,"key":"s6QUcFreZ1"},{"type":"paragraph","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"children":[{"type":"inlineCode","value":"uv","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"qnu4RBgolV"},{"type":"text","value":" is a fast Python package and project manager that handles creating virtual environments, installing dependencies, and locking package versions. We use it because it guarantees the exact same environment can be recreated on any machine with a single command.","position":{"start":{"line":164,"column":1},"end":{"line":164,"column":1}},"key":"r6hHajXKRR"}],"key":"xITCaALV7E"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"l5egoag71V"}],"key":"tKmeJZCZFU"},{"type":"paragraph","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"children":[{"type":"text","value":"The VM image we provisioned already comes with Python pre-installed, so we do not need to set up Python manually. ","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"a30xjcp7Fc"},{"type":"inlineCode","value":"uv","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"Ibk6YA4BcQ"},{"type":"text","value":" will use the existing Python installation and manage everything else for us.","position":{"start":{"line":167,"column":1},"end":{"line":167,"column":1}},"key":"SH9TCi8T9T"}],"key":"oQbjilGu3p"}],"key":"AkfYvoGe0L"},{"type":"paragraph","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"strong","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"children":[{"type":"text","value":"Install ","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"Axf4zBbQo8"},{"type":"inlineCode","value":"uv","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"uxMMgj4agO"},{"type":"text","value":":","position":{"start":{"line":170,"column":1},"end":{"line":170,"column":1}},"key":"qUWW8DeXae"}],"key":"AxNA5M2oM4"}],"key":"qgylZrmNZS"},{"type":"code","lang":"bash","value":"curl -LsSf https://astral.sh/uv/install.sh | sh\nsource $HOME/.local/bin/env","key":"eVkfj7K8Yo"},{"type":"paragraph","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"strong","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"children":[{"type":"text","value":"Verify ","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"dnNKtMmtqj"},{"type":"inlineCode","value":"uv","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"Gi6BE78y8t"},{"type":"text","value":" installation:","position":{"start":{"line":177,"column":1},"end":{"line":177,"column":1}},"key":"nnkhTe5dsk"}],"key":"AKngJk5oIm"}],"key":"dKQRwmKuSK"},{"type":"code","lang":"bash","value":"uv --version","key":"MTIFIffv5Q"},{"type":"heading","depth":2,"position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"children":[{"type":"text","value":"Step 4: Clone the GitHub Repository","position":{"start":{"line":183,"column":1},"end":{"line":183,"column":1}},"key":"yYIvSkQhQe"}],"identifier":"step-4-clone-the-github-repository","label":"Step 4: Clone the GitHub Repository","html_id":"step-4-clone-the-github-repository","implicit":true,"key":"BA2ZM7CmpN"},{"type":"paragraph","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"Clone the GitHub repository containing the ","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"h36DzJgYlX"},{"type":"link","url":"https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"children":[{"type":"text","value":"code","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"Rb47LjxEdG"}],"urlSource":"https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git","error":true,"key":"NwkYkIqzdE"},{"type":"text","value":" for this hands-on session into your VM:","position":{"start":{"line":185,"column":1},"end":{"line":185,"column":1}},"key":"QWF3xazO3s"}],"key":"jqivUhxDEo"},{"type":"code","lang":"bash","value":"git clone https://github.com/rexsimiloluwah/finetuning-gemma-1b-aims-gcp-tutorial.git\ncd finetuning-gemma-1b-aims-gcp-tutorial","key":"wqsciHYTdO"},{"type":"heading","depth":2,"position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"children":[{"type":"text","value":"Step 5: Set Up the Python Environment","position":{"start":{"line":192,"column":1},"end":{"line":192,"column":1}},"key":"JbvDTFJ4m9"}],"identifier":"step-5-set-up-the-python-environment","label":"Step 5: Set Up the Python Environment","html_id":"step-5-set-up-the-python-environment","implicit":true,"key":"F6uJixr6O3"},{"type":"paragraph","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"children":[{"type":"text","value":"To setup the Python virtual environment using ","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"fGoU6V9Bsg"},{"type":"inlineCode","value":"uv","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"L2iIBhHjxT"},{"type":"text","value":":","position":{"start":{"line":194,"column":1},"end":{"line":194,"column":1}},"key":"fzbMHQ2s8V"}],"key":"d3ob7e2D3Z"},{"type":"code","lang":"bash","value":"uv venv --python 3.12\nuv sync","key":"AY1nonjlDz"},{"type":"paragraph","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"children":[{"type":"inlineCode","value":"uv sync","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"R8EoiPLtxb"},{"type":"text","value":" reads the ","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"cxPwAThMEk"},{"type":"inlineCode","value":"uv.lock","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"FlitZOucBH"},{"type":"text","value":" file and installs all dependencies at the exact versions used during development, ensuring the environment on the VM is identical to what was used locally.","position":{"start":{"line":201,"column":1},"end":{"line":201,"column":1}},"key":"LZw4csbhQB"}],"key":"lMaDHh5D7Z"},{"type":"heading","depth":2,"position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"children":[{"type":"text","value":"Step 6: Configure Environment Variables","position":{"start":{"line":203,"column":1},"end":{"line":203,"column":1}},"key":"UM37SJ6SMK"}],"identifier":"step-6-configure-environment-variables","label":"Step 6: Configure Environment Variables","html_id":"step-6-configure-environment-variables","implicit":true,"key":"nINRqc6IeN"},{"type":"paragraph","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"You need two API keys before running anything in this hands-on session: a ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"L5ffHU2PZT"},{"type":"strong","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"HuggingFace API token","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"rk9kmMVGqn"}],"key":"tKsK6pS9Se"},{"type":"text","value":" to access the Gemma model and a ","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"oABSIYNMNb"},{"type":"strong","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"children":[{"type":"text","value":"Weights \u0026 Biases API key","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"CVDvlVCFsL"}],"key":"KNc5yc0mnY"},{"type":"text","value":" to access the WandB platform for experiment tracking.","position":{"start":{"line":205,"column":1},"end":{"line":205,"column":1}},"key":"rRi6r5yFi6"}],"key":"uxjbGhYtwM"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Getting your WandB API key:","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"X6P7VoSa6r"}],"key":"ODgWqplJCW"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":210,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Go to ","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"LPk6V7W9ik"},{"type":"link","url":"http://wandb.ai","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"text","value":"wandb.ai","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"YDOudZkU5C"}],"urlSource":"http://wandb.ai","key":"O4MAn7hWQz"},{"type":"text","value":" and create a free account if you don’t have one","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"AHoNLeVjCl"}],"key":"zTgRy9hoh3"}],"key":"KHe8ZjBwKb"},{"type":"listItem","spread":true,"position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Once logged in, click Create a new project and give it a name, for example ","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"kII2OlVCS1"},{"type":"inlineCode","value":"gemma-finetuning-gcp","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"wGyX2hUdYo"},{"type":"text","value":". This is where all your training runs and metrics will be logged.","position":{"start":{"line":211,"column":1},"end":{"line":211,"column":1}},"key":"Z3t7e3uJ2d"}],"key":"QsSi1Cu65l"}],"key":"A6Er0vDuFb"},{"type":"listItem","spread":true,"position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Navigate to ","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"Sd9hR7u5ad"},{"type":"link","url":"http://wandb.ai/authorize","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"wandb.ai/authorize","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"FsRRfhoLQy"}],"urlSource":"http://wandb.ai/authorize","key":"Q5YFZuP57t"}],"key":"bgmaFz1gMX"}],"key":"nG563r1CEt"},{"type":"listItem","spread":true,"position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Copy your API key","position":{"start":{"line":213,"column":1},"end":{"line":213,"column":1}},"key":"BBSmURoStG"}],"key":"J9oDd8pIDF"}],"key":"eHUQAxTeDO"}],"key":"GtIaeUh2CV"}],"key":"wwHfbzews3"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png","alt":"Create new project in WandB","align":"center","key":"NTUuwIga1n","urlSource":"./images/create_new_project_wandb.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"children":[{"type":"text","value":"Screenshot of “Create a new project” step in WandB","position":{"start":{"line":220,"column":1},"end":{"line":220,"column":1}},"key":"uPZ8IWPXU3"}],"key":"tVC6HbByfv"}],"key":"biwcI3wKkI"}],"enumerator":"1","key":"rpMP4kfjzj"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Getting your HuggingFace token","position":{"start":{"line":224,"column":1},"end":{"line":224,"column":1}},"key":"MemjNFkB8G"}],"key":"eSjssCtSJf"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":226,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Go to ","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"pObHdojqpC"},{"type":"link","url":"https://huggingface.co","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"children":[{"type":"text","value":"huggingface.co","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"hch8DHJxIe"}],"urlSource":"https://huggingface.co","key":"wOgUrQUIdA"},{"type":"text","value":" and create a free account if you don’t have one","position":{"start":{"line":226,"column":1},"end":{"line":226,"column":1}},"key":"AdSa9JIae4"}],"key":"WDVeqFQcmG"}],"key":"JQeBTTxiYf"},{"type":"listItem","spread":true,"position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Navigate to ","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"JsNOeSSXo4"},{"type":"link","url":"https://huggingface.co/settings/tokens","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"children":[{"type":"text","value":"huggingface​.co​/settings​/tokens","position":{"start":{"line":227,"column":1},"end":{"line":227,"column":1}},"key":"BWU7QqQAl0"}],"urlSource":"https://huggingface.co/settings/tokens","key":"WCa9RJZv93"}],"key":"C02jMBqmqS"}],"key":"sJaZhRELpq"},{"type":"listItem","spread":true,"position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a new token with read permissions and copy it","position":{"start":{"line":228,"column":1},"end":{"line":228,"column":1}},"key":"v9JLUofcG0"}],"key":"ha8t7NuKi6"}],"key":"pmohQ75YDC"}],"key":"bvvAMBngPR"}],"key":"XvrLPBF2ds"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"gFXWPOe0uu"}],"key":"J6uJ0PP2tk"},{"type":"paragraph","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"Gemma 3 is a gated model on HuggingFace. Before your token will work, you must visit ","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"eCB6GXLPOg"},{"type":"link","url":"http://huggingface.co/google/gemma-3-1b-it","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"children":[{"type":"text","value":"huggingface​.co​/google​/gemma​-3​-1b​-it","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"cbAxQIMWQQ"}],"urlSource":"http://huggingface.co/google/gemma-3-1b-it","key":"GYYSXaDaCj"},{"type":"text","value":" and accept the license agreement. Without this step, the training script will fail with a 401 error.","position":{"start":{"line":232,"column":1},"end":{"line":232,"column":1}},"key":"ShdC5U8yQW"}],"key":"KgqIONguv1"}],"key":"Wy3OfGwC7f"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/huggingface_gemma3_1-8b857569b87d65d649ed3af687158832.png","alt":"Accept Gemma 3 1B License Agreement on HuggingFace","align":"center","key":"znQC2BLZBf","urlSource":"./images/huggingface_gemma3_1b_license_agreement.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"children":[{"type":"text","value":"Screenshot of “Accept Gemma 3 1B License Agreement on HuggingFace” step","position":{"start":{"line":239,"column":1},"end":{"line":239,"column":1}},"key":"B5YepYcAtI"}],"key":"WNkerHuoLR"}],"key":"oa2M4MtBMf"}],"enumerator":"2","key":"LWbhV0AENt"},{"type":"paragraph","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"children":[{"type":"text","value":"Now copy the example env file ","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"ZBecJN89x6"},{"type":"inlineCode","value":".env.example","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"uGuqEIBxt7"},{"type":"text","value":" to create your ","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"n4zwK6RLg7"},{"type":"inlineCode","value":".env","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"GVJXzip1pA"},{"type":"text","value":" file and fill in your credentials:","position":{"start":{"line":242,"column":1},"end":{"line":242,"column":1}},"key":"sewmCwurij"}],"key":"piACvj7s7l"},{"type":"code","lang":"bash","value":"cp .env.example .env\nnano .env","key":"Y26kL0dzzv"},{"type":"paragraph","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"children":[{"type":"text","value":"Fill in your values:","position":{"start":{"line":249,"column":1},"end":{"line":249,"column":1}},"key":"EsZWkdULkl"}],"key":"sxzwkh6lmX"},{"type":"code","lang":"bash","value":"HF_TOKEN=your_huggingface_token\nWANDB_API_KEY=your_wandb_api_key\nWANDB_PROJECT=your_wandb_project_name","key":"wk9v9jCV6g"},{"type":"paragraph","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"children":[{"type":"text","value":"To exit the ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"RlPzmytnWW"},{"type":"inlineCode","value":"nano","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"aP9dzvc5C7"},{"type":"text","value":" editor: press ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"VGtqbOn1wC"},{"type":"inlineCode","value":"Ctrl+O","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"uIykCFtV1V"},{"type":"text","value":" then ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"XdVxRPRqy0"},{"type":"inlineCode","value":"Enter","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"bm9gSLtXEq"},{"type":"text","value":" to save, then ","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"Vm0zdxiaEo"},{"type":"inlineCode","value":"Ctrl+X","position":{"start":{"line":257,"column":1},"end":{"line":257,"column":1}},"key":"WjGzHviCgX"}],"key":"RnWbfDzBHW"},{"type":"admonition","kind":"important","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Before moving on, please confirm the following:","position":{"start":{"line":259,"column":1},"end":{"line":259,"column":1}},"key":"gG8rPINoAh"}],"key":"URCgEkuKUK"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":261,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Created a WandB account and a new project","position":{"start":{"line":261,"column":1},"end":{"line":261,"column":1}},"key":"dZiUdOs0R0"}],"key":"b6APm7whot"}],"checked":false,"key":"G7pY6WNNRF"},{"type":"listItem","spread":true,"position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Copied your WandB API key from ","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"ddj62xxclE"},{"type":"link","url":"http://wandb.ai/authorize","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"children":[{"type":"text","value":"wandb.ai/authorize","position":{"start":{"line":262,"column":1},"end":{"line":262,"column":1}},"key":"z90kuNx0JN"}],"urlSource":"http://wandb.ai/authorize","key":"gwHwm0ZPPq"}],"key":"ZKxHe13WmQ"}],"checked":false,"key":"uywnxm9xem"},{"type":"listItem","spread":true,"position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Created a HuggingFace account and generated a read token","position":{"start":{"line":263,"column":1},"end":{"line":263,"column":1}},"key":"V5U9i1UbGy"}],"key":"cm5TJ8ZkMq"}],"checked":false,"key":"Be1LLtZ0Td"},{"type":"listItem","spread":true,"position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Accepted the Gemma 3 license agreement at ","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"RQmXZDIVr7"},{"type":"link","url":"http://huggingface.co/google/gemma-3-1b-it","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"children":[{"type":"text","value":"huggingface​.co​/google​/gemma​-3​-1b​-it","position":{"start":{"line":264,"column":1},"end":{"line":264,"column":1}},"key":"Z3kcbFbmBz"}],"urlSource":"http://huggingface.co/google/gemma-3-1b-it","key":"vPrtPYQdHK"}],"key":"MtBWk0fj7U"}],"checked":false,"key":"xAZR3E8Hlj"},{"type":"listItem","spread":true,"position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Filled in ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"OC1Zl0U5Pv"},{"type":"inlineCode","value":".env","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"uzwvk1LXxB"},{"type":"text","value":" file with your ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"XVwzsIIlzC"},{"type":"inlineCode","value":"HF_TOKEN","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"bueZ7Hhi1F"},{"type":"text","value":", ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"MMLc6WJAbJ"},{"type":"inlineCode","value":"WANDB_API_KEY","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"kT6CGJLJgt"},{"type":"text","value":", and ","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"InxgMDiLFq"},{"type":"inlineCode","value":"WANDB_PROJECT","position":{"start":{"line":265,"column":1},"end":{"line":265,"column":1}},"key":"EAslaoOI7A"}],"key":"itzzgP8iWA"}],"checked":false,"key":"u1ZUSydW95"}],"key":"WUFvCrbB0I"}],"key":"UpIlcqoOi3"},{"type":"heading","depth":2,"position":{"start":{"line":268,"column":1},"end":{"line":268,"column":1}},"children":[{"type":"text","value":"Step 7: Upload the Dataset to Google Cloud Storage (GCS) Bucket (Optional)","position":{"start":{"line":268,"column":1},"end":{"line":268,"column":1}},"key":"UmVJ64xXz6"}],"identifier":"step-7-upload-the-dataset-to-google-cloud-storage-gcs-bucket-optional","label":"Step 7: Upload the Dataset to Google Cloud Storage (GCS) Bucket (Optional)","html_id":"step-7-upload-the-dataset-to-google-cloud-storage-gcs-bucket-optional","implicit":true,"key":"IbZ4x5CyNF"},{"type":"paragraph","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"children":[{"type":"text","value":"Rather than downloading the dataset from HuggingFace every time you run an experiment, we upload it once to GCS (GCP’s scalable cloud object storage service) and read from there in all subsequent runs. This is faster, avoids rate limits, and means your experiment does not depend on an external service being available. On real projects with large datasets, this pattern becomes essential.","position":{"start":{"line":270,"column":1},"end":{"line":270,"column":1}},"key":"P2a9kwGvTB"}],"key":"fDljNMXxvz"},{"type":"paragraph","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"strong","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"children":[{"type":"text","value":"Run the upload script:","position":{"start":{"line":272,"column":1},"end":{"line":272,"column":1}},"key":"TqnNAPQFdD"}],"key":"FJ04t7FVvR"}],"key":"soYgdWkjRQ"},{"type":"code","lang":"bash","value":"uv run bash scripts/download_and_upload_gcs.sh\n\n# You can optionally pass a custom bucket name:\nuv run bash scripts/download_and_upload_gcs.sh \u003cBUCKET_NAME\u003e","key":"qg524xNEqw"},{"type":"paragraph","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"children":[{"type":"text","value":"This script downloads the Dolly-15k dataset from HuggingFace, creates a new GCS bucket, and uploads the downloaded dataset to the GCS bucket.","position":{"start":{"line":281,"column":1},"end":{"line":281,"column":1}},"key":"hLBX1LCWLo"}],"key":"wWH9LqVKOo"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/upload_dataset_to_gc-2c54cc9b748935ed7e9a594d73485fab.png","alt":"Upload Dataset to GCS Instruction","align":"center","key":"FYJKSc3TG0","urlSource":"./images/upload_dataset_to_gcs_bucket.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"children":[{"type":"text","value":"Screenshot of “Upload Dataset to GCS Bucket” step","position":{"start":{"line":287,"column":1},"end":{"line":287,"column":1}},"key":"B54DyZVuIx"}],"key":"vMPERdYx8T"}],"key":"adbH3MKc80"}],"enumerator":"3","key":"ffn6ch9QrQ"},{"type":"paragraph","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"strong","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"children":[{"type":"text","value":"Verify the data is in the GCS bucket:","position":{"start":{"line":290,"column":1},"end":{"line":290,"column":1}},"key":"pygR3KwK4s"}],"key":"nFBqONvDOB"}],"key":"ZZZZWzrcFf"},{"type":"code","lang":"bash","value":"gcloud storage ls gs://\u003cBUCKET_NAME\u003e/data/raw/","key":"tP9C2NyE4f"},{"type":"heading","depth":2,"position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"children":[{"type":"text","value":"Step 8: Start a ","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"AKqXbO5H3t"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"bZqV8u797x"},{"type":"text","value":" Session","position":{"start":{"line":296,"column":1},"end":{"line":296,"column":1}},"key":"QjuVH4eXq0"}],"identifier":"step-8-start-a-tmux-session","label":"Step 8: Start a tmux Session","html_id":"step-8-start-a-tmux-session","implicit":true,"key":"WspISMu827"},{"type":"paragraph","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"children":[{"type":"text","value":"Training this 1 Billion parameter model using LoRA takes about 25-40 minutes. Rather than keeping your SSH connection open the entire time, we use ","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"lyduhb1FAp"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"WcGYsouHZg"},{"type":"text","value":" to run training in a persistent terminal session. This means if your SSH connection closes, training keeps running on the VM.","position":{"start":{"line":298,"column":1},"end":{"line":298,"column":1}},"key":"KNwA0IDBJC"}],"key":"yYaHE8k1CY"},{"type":"paragraph","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"strong","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"children":[{"type":"text","value":"Install ","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"IzUIZoJHsF"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"QuXRRYLlEh"},{"type":"text","value":" and start a new session:","position":{"start":{"line":300,"column":1},"end":{"line":300,"column":1}},"key":"IuIgCyAawE"}],"key":"IA64tbOkho"}],"key":"dYWDJoOQ9O"},{"type":"code","lang":"bash","value":"sudo apt-get install -y tmux \ntmux new -s finetunegemma1b","key":"AG4ix0fxwi"},{"type":"paragraph","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"children":[{"type":"text","value":"This creates a new session named “finetunegemma1b”. You should now be inside the created ","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"puX6ddxxe3"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"oNiYn5IUr3"},{"type":"text","value":" session.","position":{"start":{"line":307,"column":1},"end":{"line":307,"column":1}},"key":"pMVkar0L8h"}],"key":"RT6Nlxdg0N"},{"type":"paragraph","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"strong","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"children":[{"type":"text","value":"To detach the session without killing it:","position":{"start":{"line":309,"column":1},"end":{"line":309,"column":1}},"key":"fVbj4H9YwI"}],"key":"lToEHkfkzT"}],"key":"U93M5g5fK0"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":311,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":311,"column":1},"end":{"line":312,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Press ","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"exO63hajs8"},{"type":"inlineCode","value":"Ctrl+B","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"wVGqTEnggC"},{"type":"text","value":" then the ","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"HLbbejfGZb"},{"type":"inlineCode","value":"D","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"oX46rc2cdb"},{"type":"text","value":" key","position":{"start":{"line":311,"column":1},"end":{"line":311,"column":1}},"key":"IKnG2ibN7w"}],"key":"MUIRV2LyEn"}],"key":"lYrlYhvYrj"}],"key":"buyQYDcJXW"},{"type":"paragraph","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"children":[{"type":"text","value":"Alternatively, you can run the command from another shell for this server:","position":{"start":{"line":313,"column":1},"end":{"line":313,"column":1}},"key":"CATSGv7WoK"}],"key":"ncmZOoeB4W"},{"type":"code","lang":"bash","value":"tmux detach -s \u003csession_name\u003e","key":"QT5dDuSVPv"},{"type":"paragraph","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"children":[{"type":"strong","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"children":[{"type":"text","value":"To return to a detached session layer:","position":{"start":{"line":319,"column":1},"end":{"line":319,"column":1}},"key":"fI1X9AMIDk"}],"key":"l3tPoBJaGT"}],"key":"ej4QIgQEq1"},{"type":"code","lang":"bash","value":"tmux attach -t \u003csession_name\u003e","key":"C1PNMoHhDG"},{"type":"heading","depth":2,"position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"children":[{"type":"text","value":"Step 9: Run the Training Script","position":{"start":{"line":325,"column":1},"end":{"line":325,"column":1}},"key":"skW1wlUfau"}],"identifier":"step-9-run-the-training-script","label":"Step 9: Run the Training Script","html_id":"step-9-run-the-training-script","implicit":true,"key":"KO6sa4W99E"},{"type":"paragraph","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"children":[{"type":"text","value":"In the ","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"SH8xIlqEnv"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"HsMtDkXfbv"},{"type":"text","value":" session shell, run the script below to start finetuning the model:","position":{"start":{"line":327,"column":1},"end":{"line":327,"column":1}},"key":"qHdImO02tO"}],"key":"BUvg67763u"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_train \\\n    data.source=hf \\\n    data.max_train_samples=10000 \\\n    training.num_epochs=2 \\\n    training.batch_size=8 \\\n    experiment_id=exp_lora_r8","key":"h8P2xW9Qge"},{"type":"paragraph","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"This trains on 10,000 samples for 2 epochs with LoRA rank 8, giving us ","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"MFqbKsRuyl"},{"type":"inlineCode","value":"10,000 / 8 = 1,250 steps per epoch","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"zgifss9AbT"},{"type":"text","value":" and ","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"VmYomsaokd"},{"type":"inlineCode","value":"2,500 steps total","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"bkEUnhHHQo"},{"type":"text","value":". On the NVIDIA L4 GPU, this should take roughly ","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"qRpbnOAZd4"},{"type":"strong","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"20-30 minutes","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"FQkcqajoyf"}],"key":"fU8roy2e07"},{"type":"text","value":".","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"RuV1cURPNo"}],"key":"mtadgygTjQ"},{"type":"paragraph","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"children":[{"type":"text","value":"You can now detach from the tmux session and monitor training progress from your WandB dashboard at ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"UQYOGuEObt"},{"type":"link","url":"http://wandb.ai","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"children":[{"type":"text","value":"wandb.ai","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"Ffs6wBzkbu"}],"urlSource":"http://wandb.ai","key":"nt7lTmZE6W"},{"type":"text","value":". You will see ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"aXjFgppjVn"},{"type":"inlineCode","value":"train/loss","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"jhfE0OO7zX"},{"type":"text","value":", ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"xVRfTZKPaa"},{"type":"inlineCode","value":"eval/loss","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"CeFAuuVYYa"},{"type":"text","value":", ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"SRPsGekqa2"},{"type":"inlineCode","value":"train/grad_norm","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"dLYZHnmkLe"},{"type":"text","value":", and ","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"POxkY4xV6Q"},{"type":"inlineCode","value":"train/learning_rate","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"B70eg94c3V"},{"type":"text","value":" updating every 10 steps.","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"key":"GzkUNA0Wy0"}],"key":"I0qewDT9KH"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/wandb_train_run_moni-259c48ec2f8183d058e82c3570c5f170.png","alt":"Monitor Training Progress on WandB Dashboard","align":"center","key":"FVCarTiLPW","urlSource":"./images/wandb_train_run_monitoring.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"children":[{"type":"text","value":"Screenshot of WandB dashboard for monitoring training progress and metrics","position":{"start":{"line":346,"column":1},"end":{"line":346,"column":1}},"key":"pKA32AQc2N"}],"key":"JEwrg80NeR"}],"key":"EhYXNlp0Q8"}],"enumerator":"4","key":"MHkM0cTJfH"},{"type":"heading","depth":2,"position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"children":[{"type":"text","value":"Step 10: Run Evaluation","position":{"start":{"line":349,"column":1},"end":{"line":349,"column":1}},"key":"ifXWGgyQPb"}],"identifier":"step-10-run-evaluation","label":"Step 10: Run Evaluation","html_id":"step-10-run-evaluation","implicit":true,"key":"ZBK9EEjeGO"},{"type":"paragraph","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"text","value":"Once training finishes, reattach to the tmux session if you detached:","position":{"start":{"line":351,"column":1},"end":{"line":351,"column":1}},"key":"xzvWreOivZ"}],"key":"Ciuxo4JN3v"},{"type":"code","lang":"bash","value":"tmux attach -t \u003csession_name\u003e","key":"p7ppINzLIJ"},{"type":"paragraph","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"children":[{"type":"text","value":"Run the evaluation script. Replace ","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"b9pzyNQvua"},{"type":"inlineCode","value":"\u003cexperiment_id\u003e","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"kSr0BKoFDh"},{"type":"text","value":" and ","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"sHYGnrtO9s"},{"type":"inlineCode","value":"\u003ccheckpoint_folder\u003e","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"zQbBkGSqNy"},{"type":"text","value":" with the actual paths from your ","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"fIDIn1YpP8"},{"type":"inlineCode","value":"outputs/","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"KbFN5fspeP"},{"type":"text","value":" directory:","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"YAeVynzHCi"}],"key":"OoPYAbv6aI"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_evaluate \\\n    --model_path outputs/\u003cexperiment_id\u003e/\u003ccheckpoint_folder\u003e \\\n    --eval_file data/eval/eval_prompts.jsonl","key":"NKvMlIL48D"},{"type":"paragraph","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"children":[{"type":"text","value":"This computes perplexity and repetition rate on the evaluation set and logs the results to WandB.","position":{"start":{"line":365,"column":1},"end":{"line":365,"column":1}},"key":"SJUF9PJGvQ"}],"key":"caC3AyaSQV"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/wandb-gemma-finetune-6412f089e8ea9bb9f47fe13b52dd31ea.png","alt":"Monitor Evaluation Results on WandB Dashboard","align":"center","key":"Wfrqh8P31x","urlSource":"./images/wandb-gemma-finetune-evaluation-dashboard.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"children":[{"type":"text","value":"Screenshot of WandB dashboard for monitoring evaluation results","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"nXwho9RARN"}],"key":"pgrrqB79wg"}],"key":"Wv9qNnJrfe"}],"enumerator":"5","key":"II6mG4t5P8"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"IL31L8eAtZ"}],"key":"rmU8T5VPMW"},{"type":"paragraph","position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"children":[{"type":"text","value":"Do not worry too much about the evaluation results. The goal of this tutorial is not to produce a state-of-the-art model but to walk through the complete workflow of fine-tuning a large language model on a GCP VM end to end.","position":{"start":{"line":375,"column":1},"end":{"line":375,"column":1}},"key":"Ht3J8T4aZO"}],"key":"kh5bvmiK0X"}],"key":"WttMZtKako"},{"type":"heading","depth":2,"position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"children":[{"type":"text","value":"Step 11: Run Inference (Optional)","position":{"start":{"line":378,"column":1},"end":{"line":378,"column":1}},"key":"eYhbEezvEB"}],"identifier":"step-11-run-inference-optional","label":"Step 11: Run Inference (Optional)","html_id":"step-11-run-inference-optional","implicit":true,"key":"Y0K7Pif0xf"},{"type":"paragraph","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"children":[{"type":"text","value":"Test the model on a single instruction","position":{"start":{"line":380,"column":1},"end":{"line":380,"column":1}},"key":"nNFZvmIeiu"}],"key":"NqIUAK6GNl"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_inference \\\n    --model_path outputs/\u003cexperiment_id\u003e/\u003ccheckpoint_folder\u003e \\\n    --instruction \"Explain what machine learning is in simple terms\"","key":"poBTaTbfHv"},{"type":"paragraph","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"children":[{"type":"text","value":"You can also run in interactive mode to keep sending instructions:","position":{"start":{"line":388,"column":1},"end":{"line":388,"column":1}},"key":"pVykKRwypp"}],"key":"Oy3iYFArUk"},{"type":"code","lang":"bash","value":"uv run python -m scripts.run_inference \\\n    --model_path outputs/\u003cexperiment_id\u003e/\u003ccheckpoint_folder\u003e","key":"u1ewLoEOlN"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/finetune_gemma_exper-32dccd9973c0649c9c44e9ed9d5e5b0e.png","alt":"Fine-tuned Gemma 3 1B Inference Result","align":"center","key":"OiA8twqP3r","urlSource":"./images/finetune_gemma_experiment_inference_result.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"children":[{"type":"text","value":"Screenshot of inference result using the fine-tuned Gemma 3 1B model","position":{"start":{"line":398,"column":1},"end":{"line":398,"column":1}},"key":"bNGcixralX"}],"key":"JE5xGEpX8A"}],"key":"hMHbo4yKXY"}],"enumerator":"6","key":"y79W7GPQ6Y"},{"type":"heading","depth":2,"position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"children":[{"type":"text","value":"Step 12: Sync Outputs to GCS","position":{"start":{"line":401,"column":1},"end":{"line":401,"column":1}},"key":"lkC1U3p0q7"}],"identifier":"step-12-sync-outputs-to-gcs","label":"Step 12: Sync Outputs to GCS","html_id":"step-12-sync-outputs-to-gcs","implicit":true,"key":"gyR5joVt3u"},{"type":"paragraph","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"children":[{"type":"text","value":"Before deleting the VM, sync your checkpoints and logs to your GCS bucket so they persist:","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"KQln6BRBDV"}],"key":"EFN2E73XoD"},{"type":"code","lang":"bash","value":"gcloud storage cp -r outputs/ gs://\u003cBUCKET_NAME\u003e/outputs/","key":"n9OKDdrwhg"},{"type":"paragraph","position":{"start":{"line":409,"column":1},"end":{"line":409,"column":1}},"children":[{"type":"text","value":"Verify the GCS bucket content from the GCS dashboard or from the CLI:","position":{"start":{"line":409,"column":1},"end":{"line":409,"column":1}},"key":"Y9rf2IjP2R"}],"key":"HuWJiRPaPj"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/gcp-tutorial-aims/build/gcp-console-gemma-fi-e31c4e2ed71cd0c9d64d61ebf9e797d8.png","alt":"GCS Bucket on GCP Console","align":"center","key":"saCDdExfSu","urlSource":"./images/gcp-console-gemma-finetune-experiment-bucket.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":415,"column":1},"end":{"line":415,"column":1}},"children":[{"type":"text","value":"Screenshot of GCS bucket on the GCP console showing the “data” and synced “outputs” folder.","position":{"start":{"line":415,"column":1},"end":{"line":415,"column":1}},"key":"hfnh8cILuR"}],"key":"QcZlNgzGQb"}],"key":"M8gC7LianI"}],"enumerator":"7","key":"VpfQjVBjmq"},{"type":"code","lang":"bash","value":"gcloud storage ls gs://\u003cBUCKET_NAME\u003e/outputs/","key":"eQe46rrHdg"},{"type":"paragraph","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"children":[{"type":"text","value":"Exit the tmux session:","position":{"start":{"line":422,"column":1},"end":{"line":422,"column":1}},"key":"AKzu02yDsX"}],"key":"kGMWNSgi8x"},{"type":"code","value":"exit","key":"TWxQsVlMCN"},{"type":"heading","depth":2,"position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"children":[{"type":"text","value":"Step 13: Resource Cleanup","position":{"start":{"line":428,"column":1},"end":{"line":428,"column":1}},"key":"InA1ZfXtHI"}],"identifier":"step-13-resource-cleanup","label":"Step 13: Resource Cleanup","html_id":"step-13-resource-cleanup","implicit":true,"key":"KxWU3FRxny"},{"type":"admonition","kind":"danger","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Danger","key":"HQldb8hsaw"}],"key":"FoMxpo1ihG"},{"type":"paragraph","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"children":[{"type":"text","value":"Delete the VM when you are done to avoid incurring charges. GPU VMs are billed by the second and the NVIDIA L4 GPU VM using the ","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"AVpFFyXvP3"},{"type":"inlineCode","value":"g2-standard-4","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"gKseIvSwqc"},{"type":"text","value":" machine configuration costs roughly $0.70/hour even when idle.","position":{"start":{"line":431,"column":1},"end":{"line":431,"column":1}},"key":"GcIM1uekye"}],"key":"YnSwNbntpj"}],"key":"CJq2Utx1NK"},{"type":"paragraph","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"children":[{"type":"text","value":"Run the script below and replace ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"v9wtIzUldw"},{"type":"inlineCode","value":"\u003cYOUR_AIMSUSERNAME\u003e","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"GdppIWmALZ"},{"type":"text","value":" and ","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"h6hyxVq3qU"},{"type":"inlineCode","value":"\u003cZONE\u003e","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"ApxODfURKL"},{"type":"text","value":" with the values you used in the VM creation script.","position":{"start":{"line":434,"column":1},"end":{"line":434,"column":1}},"key":"woNcZhrE3M"}],"key":"n3DmTBmvxH"},{"type":"code","lang":"bash","value":"gcloud compute instances delete \u003cYOUR_AIMSUSERNAME\u003e-l4-vm --zone=\u003cZONE\u003e --quiet","key":"QQSUNuOuYo"},{"type":"paragraph","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"children":[{"type":"strong","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"children":[{"type":"text","value":"Verify it has been deleted:","position":{"start":{"line":440,"column":1},"end":{"line":440,"column":1}},"key":"VJzpmFupiz"}],"key":"jNfypk3ftz"}],"key":"hW3rkeNjYE"},{"type":"code","lang":"bash","value":"gcloud compute instances list","key":"DYNapmCet0"},{"type":"thematicBreak","position":{"start":{"line":446,"column":1},"end":{"line":446,"column":1}},"key":"Ki7thWFLDj"},{"type":"heading","depth":2,"position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"children":[{"type":"text","value":"🔑 Key Takeways","position":{"start":{"line":448,"column":1},"end":{"line":448,"column":1}},"key":"jo3s08VyzF"}],"identifier":"id-key-takeways","label":"🔑 Key Takeways","html_id":"id-key-takeways","implicit":true,"key":"WBLNDpxrxf"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":450,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Using a package manager like ","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"JvNbghMg26"},{"type":"inlineCode","value":"uv","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"AiCaB2cpqK"},{"type":"text","value":" ensures your Python environment is reproducible across any machine. A single ","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"DpPtxHxvB8"},{"type":"inlineCode","value":"uv sync","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"w0jqUSWOYk"},{"type":"text","value":" installs all dependencies at the exact versions pinned in the lock file, eliminating environment mismatch issues.","position":{"start":{"line":450,"column":1},"end":{"line":450,"column":1}},"key":"qRYGIzWAC8"}],"key":"SPHoQqTn9E"}],"key":"x4Jw6oYIYy"},{"type":"listItem","spread":true,"position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Uploading your dataset to GCS once and reading from there on every run is more reliable and faster than downloading from external sources each time.","position":{"start":{"line":451,"column":1},"end":{"line":451,"column":1}},"key":"IdQn3bS2Yi"}],"key":"tnLWcqKjcy"}],"key":"OdF0vgRBXE"},{"type":"listItem","spread":true,"position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"tmux","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"FQImnRI6dA"},{"type":"text","value":" is essential for long-running jobs on remote VMs. It keeps your process alive even if your SSH connection is destroyed.","position":{"start":{"line":452,"column":1},"end":{"line":452,"column":1}},"key":"SmJCwWSCjD"}],"key":"vV1V5ohtnj"}],"key":"FHzkXGEQeM"},{"type":"listItem","spread":true,"position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"WandB gives you full visibility into training progress and metrics from any browser, without needing to stay connected to the VM.","position":{"start":{"line":453,"column":1},"end":{"line":453,"column":1}},"key":"Ga8sQocRYU"}],"key":"aPJkLzDQKe"}],"key":"kYOhlDS8W9"},{"type":"listItem","spread":true,"position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Always sync outputs to GCS before deleting your VM. VM disks are ephemeral and deleted with the instance.","position":{"start":{"line":454,"column":1},"end":{"line":454,"column":1}},"key":"fAHLKjbcoO"}],"key":"XG56a1e2HU"}],"key":"uJW2mzscQM"},{"type":"listItem","spread":true,"position":{"start":{"line":455,"column":1},"end":{"line":456,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Always delete your VM after a session to avoid unexpected charges.","position":{"start":{"line":455,"column":1},"end":{"line":455,"column":1}},"key":"KmUptHGuw3"}],"key":"SbDbK3jGbb"}],"key":"Upvnv9vznw"}],"key":"cou0JTI7p1"},{"type":"heading","depth":2,"position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"children":[{"type":"text","value":"🚀 What’s Next?","position":{"start":{"line":457,"column":1},"end":{"line":457,"column":1}},"key":"yXcWkgRX2N"}],"identifier":"id-whats-next","label":"🚀 What’s Next?","html_id":"id-whats-next","implicit":true,"key":"q94YA2np55"},{"type":"paragraph","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"In the next session, we will look at ","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"Qa3RRe9XqN"},{"type":"strong","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"children":[{"type":"text","value":"Vertex AI","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"PkwNedTFGZ"}],"key":"B6t10bAZK2"},{"type":"text","value":", Google Cloud’s fully managed ML platform and how it can simplify running experiments like this without provisioning or managing any infrastructure yourself.","position":{"start":{"line":459,"column":1},"end":{"line":459,"column":1}},"key":"kraAXVZDh6"}],"key":"DMCbvzoY5x"}],"key":"IVJHchZTEz"}],"key":"Cut0IohnoP"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Introduction","url":"/part2-running-experiments-on-gcp-vms","group":"Part 2 - Running Experiments On GCP VMs"},"next":{"title":"Introduction","url":"/part3-vertex-ai","group":"Part 3 - Vertex AI"}}},"domain":"http://localhost:3000"},"project":{"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"title":"AIMS GCP Tutorial","description":"A no-fluff guide to using GCP for ML experiments and research","authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"id":"7eddb7b1-9986-44d1-8417-fe2b2bb4b498","toc":[{"file":"index.md"},{"children":[{"file":"part1-gcp-foundations/index.md"},{"file":"part1-gcp-foundations/01-understanding-gcp.md"},{"file":"part1-gcp-foundations/02-gcp-console.md"},{"file":"part1-gcp-foundations/03-the-gcloud-cli.md"},{"file":"part1-gcp-foundations/04-hands-on-gcp-console.md"},{"file":"part1-gcp-foundations/05-hands-on-gcloud-cli.md"}],"title":"Part 1 - GCP Foundations"},{"children":[{"file":"part2-running-experiments-on-gcp-vms/index.md"},{"file":"part2-running-experiments-on-gcp-vms/01-hands-on-running-ai-experiments-on-gcp-vms.md"}],"title":"Part 2 - Running Experiments On GCP VMs"},{"children":[{"file":"part3-vertex-ai/index.md"},{"file":"part3-vertex-ai/01-hands-on-vertex-ai-custom-training-job.md"},{"file":"part3-vertex-ai/02-hands-on-vertex-ai-notebook-colab-enterprise.md"}],"title":"Part 3 - Vertex AI"},{"children":[{"file":"part4-cost-management/index.md"},{"file":"part4-cost-management/01-hands-on-cost-management.md"}],"title":"Part 4 - Cost Management"},{"children":[{"file":"appendix/01-gpu-maths.md"},{"file":"append"}],"title":"Appendix"}],"exports":[],"bibliography":[],"index":"index","pages":[{"level":1,"title":"Part 1 - GCP Foundations"},{"slug":"part1-gcp-foundations.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.understanding-gcp","title":"GCP Core Concepts","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.gcp-console","title":"The GCP Console","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-overview-8e8b446f04fb688222b85418bedb2a82.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.the-gcloud-cli","title":"The Google Cloud CLI (gcloud)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.hands-on-gcp-console","title":"Hands-On 01: Create a VM via GCP Console","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/hands-on1-gcp-consol-12a3399ac5b13c81fe8057ccb402f849.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part1-gcp-foundations.hands-on-gcloud-cli","title":"Hands-On 02: Automation with the Google Cloud CLI (gcloud)","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/hands-on2-gcloud-vm--ec1294417a0584c93f49d7ef18dde2b3.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 2 - Running Experiments On GCP VMs"},{"slug":"part2-running-experiments-on-gcp-vms.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part2-running-experiments-on-gcp-vms.hands-on-running-ai-experiments-on-gcp-vms","title":"Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/create_new_project_w-2eb6f68628f9ac15adde26ff153e7212.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 3 - Vertex AI"},{"slug":"part3-vertex-ai.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part3-vertex-ai.hands-on-vertex-ai-custom-training-job","title":"Hands-On 01: Vertex AI Custom Training Jobs","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcloud-submit-vertex-fa224a3096b38995888e8f1bd1200cdb.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part3-vertex-ai.hands-on-vertex-ai-notebook-colab-enterprise","title":"Hands-On 02: Vertex AI Notebooks (Colab Enterprise)","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-colab-en-9c467a94a29b3dbd7b55cbe9bc42e12a.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Part 4 - Cost Management"},{"slug":"part4-cost-management.index","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"part4-cost-management.hands-on-cost-management","title":"Hands-On: Setting Up Billing Alerts and Budgets","description":"","date":"","thumbnail":"/gcp-tutorial-aims/build/gcp-console-create-b-10c558aa82b612d79d67b2c5cc90d849.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"level":1,"title":"Appendix"},{"slug":"appendix.gpu-maths","title":"Appendix A: GPU Maths - Choosing the Right GPU for Your Experiment","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/gcp-tutorial-aims/build/manifest-54BD5942.js";
import * as route0 from "/gcp-tutorial-aims/build/root-PMP5BIHC.js";
import * as route1 from "/gcp-tutorial-aims/build/routes/$-5ZLZ2O3Y.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/gcp-tutorial-aims/build/entry.client-PCJPW7TK.js");</script></body></html>