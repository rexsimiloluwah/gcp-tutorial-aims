{"version":3,"kind":"Article","sha256":"f847b5b9268f00d785c37d00d4e0546b7d8bd59e2f5d86b28f14fc852da1cc28","slug":"part2-running-experiments-on-gcp-vms.index","location":"/part2-running-experiments-on-gcp-vms/index.md","dependencies":[],"frontmatter":{"title":"Introduction","content_includes_title":false,"authors":[{"id":"AIMS TtT Team","name":"AIMS TtT Team"}],"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true}},"github":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial","keywords":["GCP","AI","GPU","Machine Learning","Research","Experiments","MLOps"],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/blob/main/part2-running-experiments-on-gcp-vms/index.md","edit_url":"https://github.com/rexsimiloluwa/aims-ai-gcp-tutorial/edit/main/part2-running-experiments-on-gcp-vms/index.md","exports":[{"format":"md","filename":"index.md","url":"/build/index-c28a0c4da5c6e7cec61e41fa2a2c8249.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Running AI Experiments on GCP VMs","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gVxn9ZYayL"}],"identifier":"running-ai-experiments-on-gcp-vms","label":"Running AI Experiments on GCP VMs","html_id":"running-ai-experiments-on-gcp-vms","implicit":true,"key":"W92DorjRfo"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"When a machine learning experiment outgrows your laptop, because the model is too large, training takes too long, or you need a GPU, the natural next step is to move it to the cloud.\nGCP virtual machines (VMs) give you on-demand access to powerful hardware, including modern GPUs like the NVIDIA L4, without the cost of owning physical hardware.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oiyWe39osk"}],"key":"AvbqTtkQjr"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Running experiments on a remote VM is conceptually simple: it is just a Linux machine you can SSH into and run Python code on. But there are a few things worth understanding before you get started.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"lxLXH3LKoH"}],"key":"YSzcFpTueg"},{"type":"heading","depth":3,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Reproducible Environments","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"sSSMjj9ncc"}],"identifier":"reproducible-environments","label":"Reproducible Environments","html_id":"reproducible-environments","implicit":true,"key":"AKRwA91BFk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Code that works locally often fails on a VM due to different Python versions or package versions.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"N1AAWitjYS"}],"key":"Pw7wVWl0zr"}],"key":"fA5uP0kBLc"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Hence it is important to use package managers like ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xHKMaVrOFs"},{"type":"inlineCode","value":"uv","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"vGkIk6huIT"},{"type":"text","value":" or ","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"xVCCkym1AF"},{"type":"inlineCode","value":"poetry","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"XgG9lz4DWH"},{"type":"text","value":" to automate the installation, configuration, and management of software dependencies, ensuring consistency and reproducibility.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"LKoLQj3KE0"}],"key":"IGBj6xU6ni"}],"key":"UxrOVNBFCi"}],"key":"XJkVIxzBUD"},{"type":"heading","depth":3,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Persistent Storage","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"rSL4AqAVV3"}],"identifier":"persistent-storage","label":"Persistent Storage","html_id":"persistent-storage","implicit":true,"key":"IM1nCNWenG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"VM disks are ephemeral. When you delete the VM, everything else is deleted.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"MmhQPXwAbx"}],"key":"XDXxX2xF90"}],"key":"zQgtQjtSe7"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It is important to always write outputs, checkpoints, and logs to a persistent object storage like Google Cloud Storage (GCS) during or after training so they persist independently of the VM.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"u3KfSZEabG"}],"key":"wDX3JUAEVX"}],"key":"LzQncfPNFS"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Think of the VM as temporary compute and GCS as permanent storage.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"MyqYEfuDe7"}],"key":"YtqSnvEzvT"}],"key":"fDDC8IOhbe"}],"key":"AbeUkVIH0d"},{"type":"heading","depth":3,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Long-Running Jobs","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Zi5ZMe1U0P"}],"identifier":"long-running-jobs","label":"Long-Running Jobs","html_id":"long-running-jobs","implicit":true,"key":"bhDO5ao17p"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":23,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Training machine learning models can take anywhere from minutes, for small models like XGBoost, to hours or even days for models like transformers or large language models.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"XAKXWq8sJi"}],"key":"jXuNAY4DSz"}],"key":"qunRMgCWY5"},{"type":"listItem","spread":true,"position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Keeping an SSH connection open for the entire duration is fragile. A dropped connection can kill the training process.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"qu9YGJYOJa"}],"key":"zozpauN7sO"}],"key":"MR0MFBVKm6"},{"type":"listItem","spread":true,"position":{"start":{"line":25,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You can use a tool like ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"SE6E6EE2sO"},{"type":"inlineCode","value":"tmux","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"b89x2gd2NU"},{"type":"text","value":" to keep your process running on the VM even if your SSH session disconnects.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"B2f4V4MVEV"}],"key":"ZZUrvatCyj"}],"key":"UfYPYA7STL"}],"key":"skXdYPZS2E"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Experiment Monitoring and Logging","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"p8OewidPZK"}],"identifier":"experiment-monitoring-and-logging","label":"Experiment Monitoring and Logging","html_id":"experiment-monitoring-and-logging","implicit":true,"key":"zmSXAvLjjh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":29,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Experiment monitoring is the practice of logging and visualizing metrics as a model trains, giving you a live record of how your experiment is progressing.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"T82MHvTx23"}],"key":"FXI6fT0KZn"}],"key":"vIhpI3THir"},{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"On a remote VM, you cannot just watch your terminal, so you need a tool that logs metrics to a dashboard you can access from anywhere.","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"Jre7RhKcTI"}],"key":"TI8XPFbLRb"}],"key":"r7IgQ1K94q"},{"type":"listItem","spread":true,"position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Tools like ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"C7hPl8oHcy"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Weights & Biases","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"KFgOMOYypf"}],"key":"Ota3iabjsy"},{"type":"text","value":", ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"imRvkconBf"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"Tensorboard","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"JjQtb79Q4U"}],"key":"bCd0bU0n0G"},{"type":"text","value":", or ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"Ox7uah3TkK"},{"type":"strong","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"MLFlow","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"WEdBDfI1Au"}],"key":"HVmeYoMKJ1"},{"type":"text","value":" automatically track metrics like loss, accuracy, and learning rate, hardware utilization, and maintain a history of every experiment you run.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"fEcmI4oRq9"}],"key":"waxIz98kEj"}],"key":"ilh2qigrDO"},{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"This gives you a centralized record of all your experiments, making it easy to compare runs, spot regressions, and share results with others.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"ju5M0wfU7k"}],"key":"PLaqgQwMiN"}],"key":"DpVvsNaGwV"}],"key":"sgA1ZC43cB"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Cost Management","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"BbaWDKDNNf"}],"identifier":"cost-management","label":"Cost Management","html_id":"cost-management","implicit":true,"key":"AjwNqr9mgA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":36,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"VMs are billed by the second. An idle VM costs the same as a busy one.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"DWAPDE6H8l"}],"key":"X9xTCxw8Lf"}],"key":"YHDqhrlFNC"},{"type":"listItem","spread":true,"position":{"start":{"line":37,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Always stop/delete your VM when an experiment is done.","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"efI4re4PYo"}],"key":"UXW8IPHq9y"}],"key":"eZ5o6mjaaH"}],"key":"El7YaYBQcu"},{"type":"admonition","kind":"note","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"Y8sOwErCP7"}],"key":"gjhMZJ0LSb"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"GPU VMs are significantly more expensive than CPU VMs. An NVIDIA L4 instance costs roughly $0.70/hour. Always double-check that your VM has been deleted after a session by running gcloud compute instances list.","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"cPYmCtT8AM"}],"key":"EBYMA9Qm7h"}],"key":"Sv4FqKDqgs"},{"type":"admonition","kind":"warning","children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Warning","key":"Dzmk8EEhWT"}],"key":"AKGIuK8qTp"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Never store API keys or tokens directly in your code or commit them to GitHub. Use a .env file listed in .gitignore and load credentials at runtime.","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"BLndQhkOJH"}],"key":"baiO5li80U"}],"key":"eh04WjgVev"},{"type":"thematicBreak","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"Hreo41E8UA"},{"type":"heading","depth":2,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"text","value":"ðŸš€ Whatâ€™s Next?","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"JT04xz4Lfl"}],"identifier":"id-whats-next","label":"ðŸš€ Whatâ€™s Next?","html_id":"id-whats-next","implicit":true,"key":"FMxO4VjFLY"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"In the hands-on session that follows, you will run a complete end-to-end ML experiment on a GCP VM with an NVIDIA L4 GPU. This will involve:","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"ysZie4lfKC"}],"key":"YeOihshj3m"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":53,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Fine-tuning ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"Np9jjpO1Le"},{"type":"strong","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Gemma 3 1B","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"yAK1DnZJdc"}],"key":"OekhXlEXJa"},{"type":"text","value":" on the Dolly-15k instruction dataset using LoRA.","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"ajHSlCYRkZ"}],"key":"BiR5zcjhaS"}],"key":"dbZAhA4izc"},{"type":"listItem","spread":true,"position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Tracking experiments in real time with ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"PGs8tPfeSt"},{"type":"strong","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"Weights & Biases","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"l44Uwy1g99"}],"key":"BG0gpR5m8d"}],"key":"LjsHpFnAhO"}],"key":"zKf5oUohnr"},{"type":"listItem","spread":true,"position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Persisting checkpoints and outputs to GCS","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"Eo5i0QStAH"}],"key":"mLIsDzehum"}],"key":"Akb6cpd1AN"},{"type":"listItem","spread":true,"position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Running evaluation and inference on the trained model","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"XTHbxLUGWk"}],"key":"yOd63ZQ7Xy"}],"key":"GA62N6m4cw"}],"key":"ClTxnXHs6L"}],"key":"iz0OB9iT5b"}],"key":"TDGX6TGBs7"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Hands-On 02: Automation with the Google Cloud CLI (gcloud)","url":"/part1-gcp-foundations/hands-on-gcloud-cli","group":"Part 1 - GCP Foundations"},"next":{"title":"Hands-On 01: Fine-tuning a Small Language Model (Gemma 3 1B) on a GCP VM","url":"/part2-running-experiments-on-gcp-vms/hands-on-running-ai-experiments-on-gcp-vms","group":"Part 2 - Running Experiments On GCP VMs"}}},"domain":"http://localhost:3000"}